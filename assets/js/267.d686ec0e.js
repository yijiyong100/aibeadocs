(window.webpackJsonp=window.webpackJsonp||[]).push([[267],{782:function(t,s,a){"use strict";a.r(s);var n=a(53),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("本文主要是介绍 Spark-新闻实时分析案例 。")])]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#基于spark2-x新闻网大数据实时分析可视化系统项目"}},[t._v("基于Spark2.x新闻网大数据实时分析可视化系统项目")])]),a("li",[a("a",{attrs:{href:"#一、业务需求分析"}},[t._v("一、业务需求分析")])]),a("li",[a("a",{attrs:{href:"#二、系统架构图设计"}},[t._v("二、系统架构图设计")])]),a("li",[a("a",{attrs:{href:"#三、系统数据流程设计"}},[t._v("三、系统数据流程设计")])]),a("li",[a("a",{attrs:{href:"#四、集群资源规划设计"}},[t._v("四、集群资源规划设计")])]),a("li",[a("a",{attrs:{href:"#五、步骤详解"}},[t._v("五、步骤详解")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-zookeeper分布式集群部署"}},[t._v("1. Zookeeper分布式集群部署")])]),a("li",[a("a",{attrs:{href:"#_2-hadoop2-x-ha架构与部署"}},[t._v("2. Hadoop2.X HA架构与部署")])]),a("li",[a("a",{attrs:{href:"#_3-hbase分布式集群部署与设计"}},[t._v("3. HBase分布式集群部署与设计")])]),a("li",[a("a",{attrs:{href:"#_4-kafka分布式集群部署"}},[t._v("4. Kafka分布式集群部署")])]),a("li",[a("a",{attrs:{href:"#_5-flume部署及数据采集准备"}},[t._v("5. Flume部署及数据采集准备")])]),a("li",[a("a",{attrs:{href:"#_6-flume-hbase-kafka集成与开发"}},[t._v("6. Flume+HBase+Kafka集成与开发")])]),a("li",[a("a",{attrs:{href:"#_7-数据采集-存储-分发完整流程测试"}},[t._v("7. 数据采集/存储/分发完整流程测试")])]),a("li",[a("a",{attrs:{href:"#_8-mysql安装"}},[t._v("8. MySQL安装")])]),a("li",[a("a",{attrs:{href:"#_9-hive与hbase集成进行数据分析"}},[t._v("9. Hive与HBase集成进行数据分析")])]),a("li",[a("a",{attrs:{href:"#_10-cloudera-hue大数据可视化分析"}},[t._v("10. Cloudera HUE大数据可视化分析")])]),a("li",[a("a",{attrs:{href:"#_11-spark2-x环境准备、编译部署及运行"}},[t._v("11. Spark2.X环境准备、编译部署及运行")])]),a("li",[a("a",{attrs:{href:"#_12-spark-sql快速离线数据分析"}},[t._v("12. Spark SQL快速离线数据分析")])]),a("li",[a("a",{attrs:{href:"#_13-structured-streaming业务数据实时分析"}},[t._v("13. Structured Streaming业务数据实时分析")])]),a("li",[a("a",{attrs:{href:"#_14-大数据web可视化分析系统开发"}},[t._v("14. 大数据Web可视化分析系统开发")])])])]),a("li",[a("a",{attrs:{href:"#参考文章"}},[t._v("参考文章")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"基于spark2-x新闻网大数据实时分析可视化系统项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于spark2-x新闻网大数据实时分析可视化系统项目"}},[t._v("#")]),t._v(" 基于Spark2.x新闻网大数据实时分析可视化系统项目")]),t._v(" "),a("p",[t._v("本次项目是基于企业大数据经典案例项目（大数据日志分析），全方位、全流程讲解 大数据项目的业务分析、技术选型、架构设计、集群规划、安装部署、整合继承与开发和web可视化交互设计。")]),t._v(" "),a("p",[a("strong",[t._v("项目代码")]),t._v("托管于github，大家可以自行"),a("a",{attrs:{href:"https://github.com/ZzXxL1994/News_Spark",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"一、业务需求分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、业务需求分析"}},[t._v("#")]),t._v(" 一、业务需求分析")]),t._v(" "),a("ol",[a("li",[t._v("捕获用户浏览日志信息")]),t._v(" "),a("li",[t._v("实时分析前20名流量最高的新闻话题")]),t._v(" "),a("li",[t._v("实时统计当前线上已曝光的新闻话题")]),t._v(" "),a("li",[t._v("统计哪个时段用户浏览量最高")])]),t._v(" "),a("h2",{attrs:{id:"二、系统架构图设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、系统架构图设计"}},[t._v("#")]),t._v(" 二、系统架构图设计")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-1.png"),alt:"wxmp"}}),t._v(" "),a("h2",{attrs:{id:"三、系统数据流程设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、系统数据流程设计"}},[t._v("#")]),t._v(" 三、系统数据流程设计")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-2.png"),alt:"wxmp"}}),t._v(" "),a("h2",{attrs:{id:"四、集群资源规划设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、集群资源规划设计"}},[t._v("#")]),t._v(" 四、集群资源规划设计")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-3.png"),alt:"wxmp"}}),t._v(" "),a("h2",{attrs:{id:"五、步骤详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、步骤详解"}},[t._v("#")]),t._v(" 五、步骤详解")]),t._v(" "),a("p",[t._v("考虑到实际情况，本人集群配置共三个节点（node5、node6、node7）。")]),t._v(" "),a("h3",{attrs:{id:"_1-zookeeper分布式集群部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-zookeeper分布式集群部署"}},[t._v("#")]),t._v(" 1. Zookeeper分布式集群部署")]),t._v(" "),a("p",[t._v("参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/79480234",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"_2-hadoop2-x-ha架构与部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-hadoop2-x-ha架构与部署"}},[t._v("#")]),t._v(" 2. Hadoop2.X HA架构与部署")]),t._v(" "),a("p",[t._v("参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/77922331",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"_3-hbase分布式集群部署与设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-hbase分布式集群部署与设计"}},[t._v("#")]),t._v(" 3. HBase分布式集群部署与设计")]),t._v(" "),a("p",[t._v("参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/80171500",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"_4-kafka分布式集群部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-kafka分布式集群部署"}},[t._v("#")]),t._v(" 4. Kafka分布式集群部署")]),t._v(" "),a("p",[t._v("参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/79481088",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"_5-flume部署及数据采集准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-flume部署及数据采集准备"}},[t._v("#")]),t._v(" 5. Flume部署及数据采集准备")]),t._v(" "),a("p",[t._v("参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/80000763",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1),t._v("，node6与node7中flume数据采集到node5中，而且node6和node7的flume配置文件大致相同，node7中将a2改为a3，如下")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.sources")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" r1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.sinks")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" k1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.channels")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" c1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.sources.r1.type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" exec")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.sources.r1.command")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" tail -F /opt/data/weblog-flume.log")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.sources.r1.channels")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" c1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.channels.c1.type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" memory")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.channels.c1.capacity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 1000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.channels.c1.transactionCapacity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 1000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.channels.c1.keep-alive")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 5")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.sinks.k1.type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" avro")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.sinks.k1.channel")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" c1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.sinks.k1.hostname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" node5")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a2.sinks.k1.port")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 5555")]),t._v("\n")])])]),a("h3",{attrs:{id:"_6-flume-hbase-kafka集成与开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-flume-hbase-kafka集成与开发"}},[t._v("#")]),t._v(" 6. Flume+HBase+Kafka集成与开发")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("下载Flume源码并导入Idea开发工具")])]),t._v(" "),a("p",[t._v("1）将apache-flume-1.7.0-src.tar.gz源码下载到本地解压")]),t._v(" "),a("p",[t._v("2）通过idea导入flume源码")]),t._v(" "),a("p",[t._v("打开idea开发工具，选择File——》Open")])])]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-4.png"),alt:"wxmp"}}),t._v(" "),a("p",[t._v("然后找到flume源码解压文件，选中flume-ng-hbase-sink，点击ok加载相应模块的源码。")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-5.png"),alt:"wxmp"}}),t._v(" "),a("ul",[a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("官方flume与hbase集成的参数介绍")])])])]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-6.png"),alt:"wxmp"}}),t._v(" "),a("ul",[a("li",[a("ol",{attrs:{start:"3"}},[a("li",[t._v("下载日志数据并分析")])])])]),t._v(" "),a("p",[t._v("到搜狗实验室 "),a("a",{attrs:{href:"http://www.sogou.com/labs/resource/q.php",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),a("OutboundLink")],1),t._v("用户查询日志")]),t._v(" "),a("p",[t._v("1）介绍")]),t._v(" "),a("p",[t._v("搜索引擎查询日志库设计为包括约1个月(2008年6月)Sogou搜索引擎部分网页查询需求及用户点击情况的网页查询日志数据集合。为进行中文搜索引擎用户行为分析的研究者提供基准研究语料。")]),t._v(" "),a("p",[t._v("2）格式说明")]),t._v(" "),a("p",[t._v("数据格式为:访问时间\\t用户ID\\t[查询词]\\t该URL在返回结果中的排名\\t用户点击的顺序号\\t用户点击的URL")]),t._v(" "),a("p",[t._v("其中，用户ID是根据用户使用浏览器访问搜索引擎时的Cookie信息自动赋值，即同一次使用浏览器输入的不同查询对应同一个用户ID")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-7.png"),alt:"wxmp"}}),t._v(" "),a("ul",[a("li",[a("ol",{attrs:{start:"4"}},[a("li",[t._v("node5聚合节点与HBase和Kafka的集成配置")])]),t._v(" "),a("p",[t._v("node5通过flume接收node6与node7中flume传来的数据，并将其分别发送至hbase与kafka中，配置内容如下")])])]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sources")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" r1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.channels")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" kafkaC hbaseC")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" kafkaSink hbaseSink")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sources.r1.type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" avro       ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sources.r1.channels")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" hbaseC kafkaC")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sources.r1.bind")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" node5")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sources.r1.port")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 5555 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sources.r1.threads")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 5 ")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#****************************flume + hbase****************************** ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.channels.hbaseC.type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" memory")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.channels.hbaseC.capacity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 10000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.channels.hbaseC.transactionCapacity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 10000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.channels.hbaseC.keep-alive")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 20")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.hbaseSink.type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" asynchbase")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.hbaseSink.table")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" weblogs")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.hbaseSink.columnFamily")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" info")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.hbaseSink.serializer")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" org.apache.flume.sink.hbase.KfkAsyncHbaseEventSerializer")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.hbaseSink.channel")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" hbaseC")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.hbaseSink.serializer.payloadColumn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" datetime,userid,searchname,retorder,cliorder,cliurl")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#****************************flume + kafka******************************")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.channels.kafkaC.type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" memory")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.channels.kafkaC.capacity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 10000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.channels.kafkaC.transactionCapacity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 10000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.channels.kafkaC.keep-alive")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 20")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.kafkaSink.channel")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" kafkaC")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.kafkaSink.type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" org.apache.flume.sink.kafka.KafkaSink")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.kafkaSink.brokerList")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" node5:9092,node6:9092,node7:9092")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.kafkaSink.topic")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" weblogs")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.kafkaSink.zookeeperConnect")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" node5:2181,node6:2181,node7:2181")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.kafkaSink.requiredAcks")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.kafkaSink.batchSize")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("a1.sinks.kafkaSink.serializer.class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" kafka.serializer.StringEncoder")]),t._v("\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"5"}},[a("li",[t._v("对日志数据进行格式处理")])]),t._v(" "),a("p",[t._v("1）将文件中的tab更换成逗号")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" weblog.log"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tr")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('","')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" weblog.log\n")])])]),a("p",[t._v("2）将文件中的空格更换成逗号")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" weblog2.log"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tr")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('","')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" weblog.log\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"6"}},[a("li",[t._v("自定义SinkHBase程序设计与开发")])]),t._v(" "),a("p",[t._v("1）模仿SimpleAsyncHbaseEventSerializer自定义KfkAsyncHbaseEventSerializer实现类，修改一下代码即可。")])])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PutRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getActions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PutRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" actions "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PutRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payloadColumn "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" rowKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*---------------------------代码修改开始---------------------------------*/")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 解析列字段")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" columns "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("payloadColumn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('","')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 解析flume采集过来的每行的值")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" values "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("payload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('","')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" columns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" colColumn "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" columns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" colValue "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Charsets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UTF_8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据校验：字段和值是否对应")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("colColumn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" colValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 时间")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" datetime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用户id")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" userid "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据业务自定义Rowkey")]),t._v("\n                rowKey "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleRowKeyGenerator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getKfkRowKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("datetime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 插入数据")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PutRequest")]),t._v(" putRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PutRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rowKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            colColumn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                actions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("putRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*---------------------------代码修改结束---------------------------------*/")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FlumeException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Could not get row key!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" actions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("2）在SimpleRowKeyGenerator类中，根据具体业务自定义Rowkey生成方法")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getKfkRowKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" userid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" datetime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnsupportedEncodingException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userid "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" datetime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("valueOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentTimeMillis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"7"}},[a("li",[t._v("自定义编译程序打jar包")])])])]),t._v(" "),a("p",[t._v("1）在idea工具中，选择File——》ProjectStructrue")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-8.png"),alt:"wxmp"}}),t._v(" "),a("p",[t._v("2）左侧选中Artifacts，然后点击右侧的+号，最后选择JAR——》From modules with dependencies")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-9.png"),alt:"wxmp"}}),t._v(" "),a("p",[t._v("3）然后直接点击ok")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-10.png"),alt:"wxmp"}}),t._v(" "),a("p",[t._v("4）删除其他依赖包，只把flume-ng-hbase-sink打成jar包就可以了。")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-11.png"),alt:"wxmp"}}),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-12.png"),alt:"wxmp"}}),t._v(" "),a("p",[t._v("5）然后依次点击apply，ok")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-13.png"),alt:"wxmp"}}),t._v(" "),a("p",[t._v("6）点击build进行编译，会自动打成jar包")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-14.png"),alt:"wxmp"}}),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-15.png"),alt:"wxmp"}}),t._v(" "),a("p",[t._v("7）到项目的apache-flume-1.7.0-src\\flume-ng-sinks\\flume-ng-hbase-sink\\classes\\artifacts\\flume_ng_hbase_sink_jar目录下找到刚刚打的jar包")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-16.png"),alt:"wxmp"}}),t._v(" "),a("p",[t._v("8）将打包名字替换为flume自带的包名flume-ng-hbase-sink-1.7.0.jar ，然后上传至flume/lib目录下，覆盖原有的jar包即可。")]),t._v(" "),a("h3",{attrs:{id:"_7-数据采集-存储-分发完整流程测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-数据采集-存储-分发完整流程测试"}},[t._v("#")]),t._v(" 7. 数据采集/存储/分发完整流程测试")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("在idea开发工具中构建weblogs项目，编写数据生成模拟程序。")])])])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("java")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReadWrite")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" readFileName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" writeFileName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        readFileName "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        writeFileName "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// readInput();")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileByLines")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("readFileName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileByLines")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" fileName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileInputStream")]),t._v(" fis "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InputStreamReader")]),t._v(" isr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedReader")]),t._v(" br "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" tempString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"以行为单位读取文件内容，一次读一整行："')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            fis "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileInputStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fileName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// FileInputStream")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 从文件系统中的某个文件中获取字节")]),t._v("\n            isr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InputStreamReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GBK"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            br "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tempString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" br"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 显示行号")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" str "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tempString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GBK"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"row:"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('">>>>>>>>"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("tempString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("method1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("writeFileName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("tempString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//appendMethodA(writeFileName,tempString);")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            isr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    isr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" e1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("method1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" conent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedWriter")]),t._v(" out "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            out "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedWriter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OutputStreamWriter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileOutputStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("conent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("参照前面idea工具项目打包方式，将该项目打成weblogs.jar包，然后上传至bigdata-pro01.kfk.com节点的/opt/jars目录下（目录需要提前创建）")])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"3"}},[a("li",[t._v("将weblogs.jar分发到另外两个节点（node6和node7）")])]),t._v(" "),a("p",[t._v("1）在另外两个节点上分别创建/opt/jars目录")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /opt/jars\n")])])]),a("p",[t._v("2）将weblogs.jar分发到另外两个节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" weblogs.jar node6:/opt/jars/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" weblogs.jar node7:/opt/jars/\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"4"}},[a("li",[t._v("编写运行模拟程序的shell脚本")])]),t._v(" "),a("p",[t._v("在node6和node7节点的/opt/datas目录下，创建weblog-shell.sh脚本。内容为")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#/bin/bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"start log......"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#第一个参数是原日志文件，第二个参数是日志生成输出文件")]),t._v("\njava -jar /opt/jars/weblogs.jar /opt/datas/weblog.log /opt/datas/weblog-flume.log\n")])])]),a("p",[t._v("修改weblog-shell.sh可执行权限")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("chmod "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("777")]),t._v(" weblog"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"5"}},[a("li",[t._v("编写启动flume服务程序的shell脚本")])]),t._v(" "),a("p",[t._v("在各节点的flume安装目录下编写flume启动脚本flume-kfk-start.sh。")]),t._v(" "),a("p",[t._v("下面是node5中的配置写法，node6与node7中将a1分别改为a2和a3。")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#/bin/bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"flume-1 start ......"')]),t._v("\nbin/flume-ng agent --conf conf -f conf/flume-conf.properties -n a1 -Dflume.root.logger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("INFO,console\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"6"}},[a("li",[t._v("编写Kafka Consumer执行脚本kfk-test-consumer.sh。")])])])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("#"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bash\necho "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kfk-kafka-consumer.sh start......"')]),t._v("\nbin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("kafka"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("console"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("zookeeper node5"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("node6"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("node7"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("beginning "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("topic weblogs\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"7"}},[a("li",[t._v("将kfk-test-consumer.sh脚本分发另外两个节点")])])])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("scp kfk"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh node6"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("modules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("kakfa_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".2")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\nscp kfk"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh node7"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("modules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("kakfa_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".2")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"8"}},[a("li",[t._v("启动模拟程序并测试")])]),t._v(" "),a("p",[t._v("在node6节点启动日志产生脚本，模拟产生日志是否正常。")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("/opt/datas/weblog-shell.sh\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"9"}},[a("li",[t._v("启动数据采集所有服务")])]),t._v(" "),a("p",[t._v("1）启动Zookeeper服务")]),t._v(" "),a("p",[t._v("2）启动hdfs服务")]),t._v(" "),a("p",[t._v("3）启动HBase服务")]),t._v(" "),a("p",[t._v("创建hbase业务表")])])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'weblogs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'info'")]),t._v("\n")])])]),a("p",[t._v("4）启动Kafka服务，并创建业务数据topic")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("kafka"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("properties "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\n\nbin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("kafka"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("topics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("create "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("zookeeper node5"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("node6"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("node7"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("topic weblogs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("partitions "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("replication"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("factor "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"10"}},[a("li",[t._v("完成数据采集全流程测试")])]),t._v(" "),a("p",[t._v("1）在node5节点上启动flume聚合脚本，将采集的数据分发到Kafka集群和hbase集群。")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("./flume-kfk-start.sh\n")])])]),a("p",[t._v("2）在node6和node7节点上完成数据采集。")]),t._v(" "),a("p",[t._v("（1）使用shell脚本模拟日志产生")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt/datas/\n./weblog-shell.sh\n")])])]),a("p",[t._v("（2）启动flume采集日志数据发送给聚合节点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("./flume-kfk-start.sh\n")])])]),a("p",[t._v("3）启动Kafka Consumer查看flume日志采集情况")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic weblogs --from-beginning\n")])])]),a("p",[t._v("4）查看hbase数据写入情况")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("./hbase-shell\ncount "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'weblogs'")]),t._v("\n")])])]),a("h3",{attrs:{id:"_8-mysql安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-mysql安装"}},[t._v("#")]),t._v(" 8. MySQL安装")]),t._v(" "),a("p",[t._v("参考"),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/77893585",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"_9-hive与hbase集成进行数据分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-hive与hbase集成进行数据分析"}},[t._v("#")]),t._v(" 9. Hive与HBase集成进行数据分析")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("Hive安装（本地mysql模式），参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/78068897",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("Hive与HBase集成")])]),t._v(" "),a("p",[t._v("1）在hive-site.xml文件中配置Zookeeper，hive通过这个参数去连接HBase集群。")])])]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("hbase.zookeeper.quorum"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("   \n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("node5,node6,node7"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("2）将hbase的9个包拷贝到hive/lib目录下。如果是CDH版本，已经集成好不需要导包。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("HBASE_HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/modules/hbase-0.98.6-cdh5.3.0\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("HIVE_HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/modules/hive-0.13.1/lib\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HBASE_HOME")]),t._v("/lib/hbase-server-0.98.6-cdh5.3.0.jar "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HIVE_HOME")]),t._v("/lib/hbase-server-0.98.6-cdh5.3.0.jar\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HBASE_HOME")]),t._v("/lib/hbase-client-0.98.6-cdh5.3.0.jar "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HIVE_HOME")]),t._v("/lib/hbase-client-0.98.6-cdh5.3.0.jar\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HBASE_HOME")]),t._v("/lib/hbase-protocol-0.98.6-cdh5.3.0.jar "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HIVE_HOME")]),t._v("/lib/hbase-protocol-0.98.6-cdh5.3.0.jar \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HBASE_HOME")]),t._v("/lib/hbase-it-0.98.6-cdh5.3.0.jar "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HIVE_HOME")]),t._v("/lib/hbase-it-0.98.6-cdh5.3.0.jar \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HBASE_HOME")]),t._v("/lib/htrace-core-2.04.jar"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HIVE_HOME")]),t._v("/lib/htrace-core-2.04.jar\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HBASE_HOME")]),t._v("/lib/hbase-hadoop2-compact-0.98.6-cdh5.3.0.jar "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HIVE_HOME")]),t._v("/lib/hbase-hadoop2-compact-0.98.6-cdh5.3.0.jar \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HBASE_HOME")]),t._v("/lib/hbase-hadoop-compact-0.98.6-cdh5.3.0.jar "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HIVE_HOME")]),t._v("/lib/hbase-hadoop-compact-0.98.6-cdh5.3.0.jar \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HBASE_HOME")]),t._v("/lib/high-scale-lib-1.1.1.jar "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HIVE_HOME")]),t._v("/lib/high-scale-lib-1.1.1.jar \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HBASE_HOME")]),t._v("/lib/hbase-common-0.98.6-cdh5.3.0.jar "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HIVE_HOME")]),t._v("/lib/hbase-common-0.98.6-cdh5.3.0.jar \n")])])]),a("p",[t._v("3）在hive中创建与hbase集成的外部表")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" EXTERNAL "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" weblogs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\nid string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nuserid string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nsearchname string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nretorder string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\ncliorder string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\ncliurl string\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nSTORED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.apache.hadoop.hive.hbase.HBaseStorageHandler'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" SERDEPROPERTIES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hbase.columns.mapping"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('":key,info:datetime,info:userid,info:searchname,info:retorder,info:cliorder,info:cliurl"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTBLPROPERTIES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hbase.table.name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"weblogs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看hbase数据记录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" weblogs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("4）hive中beeline和hiveserver2的使用")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 启动hiveserver2")]),t._v("\nbin/hiveserver2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 启动beeline")]),t._v("\nbin/beeline\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 连接hive2服务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("connect jdbc:hive2//node7.kfk.com:10000\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 查看表")]),t._v("\nshow tables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 查看前10条数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" * from weblogs limit "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_10-cloudera-hue大数据可视化分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-cloudera-hue大数据可视化分析"}},[t._v("#")]),t._v(" 10. Cloudera HUE大数据可视化分析")]),t._v(" "),a("p",[t._v("参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/80178771",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"_11-spark2-x环境准备、编译部署及运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-spark2-x环境准备、编译部署及运行"}},[t._v("#")]),t._v(" 11. Spark2.X环境准备、编译部署及运行")]),t._v(" "),a("p",[t._v("参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/80179911",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1),t._v("，搭建spark集群参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/79381172",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"_12-spark-sql快速离线数据分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-spark-sql快速离线数据分析"}},[t._v("#")]),t._v(" 12. Spark SQL快速离线数据分析")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("Spark SQL 与Hive集成（spark-shell），参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/79395227",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("Spark SQL 与Hive集成（spark-sql），参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/79395227",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"3"}},[a("li",[t._v("Spark SQL之ThriftServer和beeline使用，参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/79395227",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"4"}},[a("li",[t._v("Spark SQL与MySQL集成，参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/79395227",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"5"}},[a("li",[t._v("Spark SQL与HBase集成，参考 "),a("a",{attrs:{href:"https://blog.csdn.net/u011254180/article/details/79395227",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),a("OutboundLink")],1)])])])]),t._v(" "),a("h3",{attrs:{id:"_13-structured-streaming业务数据实时分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-structured-streaming业务数据实时分析"}},[t._v("#")]),t._v(" 13. Structured Streaming业务数据实时分析")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("Structured Streaming与kafka集成")])]),t._v(" "),a("p",[t._v("1）Structured Streaming是Spark2.2.0新推出的，要求kafka的版本0.10.0及以上。集成时需将如下的包拷贝到Spark的jar包目录下。")])])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("kafka_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.10")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar\nkafka"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("clients"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.10")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar\nspark"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("sql"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("kafka"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10_2.11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.2")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar\nspark"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("streaming"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("kafka"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10_2.11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar\n")])])]),a("p",[t._v("2）与kafka集成代码")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("val df "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" spark\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readStream\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kafka"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("option")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kafka.bootstrap.servers"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node5:9092"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("option")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"subscribe"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"weblogs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("load")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("spark"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("implicits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("_\nval lines "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" df"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("selectExpr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CAST(value AS STRING)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("as"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("Structured Streaming与MySQL集成")])]),t._v(" "),a("p",[t._v("1）mysql创建相应的数据库和数据表，用于接收数据")])])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("database")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("webCount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("titleName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("2）与mysql集成代码")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("val url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jdbc:mysql://node5:3306/test"')]),t._v("\n    val username"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root"')]),t._v("\n    val password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1234"')]),t._v("\n\n    val writer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JDBCSink")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    val query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" titleCount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("writeStream\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("foreach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("writer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("      \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("outputMode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"update"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("trigger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProcessingTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5 seconds"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[a("ol",{attrs:{start:"3"}},[a("li",[t._v("Structured Streaming向mysql数据库写入中文乱码解决")])]),t._v(" "),a("p",[t._v("修改数据库文件my.cnf（linux下）")])])]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[client]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("socket")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/var/lib/mysql/mysql.sock    //添加")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("default-character-set")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("utf8          //添加")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[mysqld]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("character-set-server")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("utf8           //添加")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("datadir")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/var/lib/mysql")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("socket")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/var/lib/mysql/mysql.sock")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("user")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("mysql")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Disabling symbolic-links is recommended to prevent assorted security risks")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("symbolic-links")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[mysqld_safe]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("log-error")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/var/log/mysqld.log")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("pid-file")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/var/run/mysqld/mysqld.pid")]),t._v("\n")])])]),a("h3",{attrs:{id:"_14-大数据web可视化分析系统开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-大数据web可视化分析系统开发"}},[t._v("#")]),t._v(" 14. 大数据Web可视化分析系统开发")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("基于业务需求的WEB系统设计（具体参照代码）")])]),t._v(" "),a("li",[a("p",[t._v("基于Echart框架的页面展示层开发")])])]),t._v(" "),a("p",[t._v("1）echart、JQuery下载")]),t._v(" "),a("p",[t._v("2）页面效果图选取及代码实现")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-17.png"),alt:"wxmp"}}),t._v(" "),a("ol",[a("li",[t._v("工程编译并打包发布")])]),t._v(" "),a("p",[t._v("参照之前将的idea打包方式，将spark web项目打包发布。")]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("启动各个服务")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("）启动zookeeper： zkServer.sh start\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("）启动hadoop： start-all.sh\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("）启动hbase： start-hbase\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("）启动mysql： "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" mysqld start\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("）node6（node7）启动flume： flume-kfk-start.sh，将数据发送到node5中\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("）node5启动flume： flume-kfk-start.sh，将数据分别传到hbase和kafka中\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("）启动kafka-0.10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("最好三台都启动，不然易出错"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("：\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("bin/kafka-server-start.sh config/server.properties "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" kafka.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" \n")])])]),a("p",[t._v("8）启动node6(node7)中的脚本：weblog-shell.sh")]),t._v(" "),a("p",[t._v("9）启动 StructuredStreamingKafka来从kafka中取得数据，处理后存到mysql中")]),t._v(" "),a("p",[t._v("10）启动web项目（sparkStu），该项目会从mysql数据库中读取数据展示到页面")]),t._v(" "),a("ol",[a("li",[t._v("最终项目运行效果")])]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:t.$withBase("/assets/img/da/rtaspark/newscase-18.png"),alt:"wxmp"}}),t._v(" "),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),a("ul",[a("li",[t._v("https://blog.csdn.net/u011254180/article/details/80172452")])])])}),[],!1,null,null,null);s.default=e.exports}}]);