(window.webpackJsonp=window.webpackJsonp||[]).push([[290],{805:function(s,t,a){"use strict";a.r(t);var n=a(53),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("本文主要是介绍 MySQL-存储引擎 。")])]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#一-存储引擎简介"}},[s._v("一.存储引擎简介")])]),a("li",[a("a",{attrs:{href:"#二-mysql自带的存储引擎类型"}},[s._v("二.MySQL自带的存储引擎类型")])]),a("li",[a("a",{attrs:{href:"#三-真实企业案例"}},[s._v("三.真实企业案例")])]),a("li",[a("a",{attrs:{href:"#四-innodb存储引擎-表空间介绍"}},[s._v("四.Innodb存储引擎——表空间介绍")])]),a("li",[a("a",{attrs:{href:"#五-innodb核心特性-事务"}},[s._v("五.Innodb核心特性——事务")])]),a("li",[a("a",{attrs:{href:"#参考文章"}},[s._v("参考文章")])])])]),a("p"),s._v(" "),a("p",[s._v("MySQL的存储引擎")]),s._v(" "),a("h2",{attrs:{id:"一-存储引擎简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-存储引擎简介"}},[s._v("#")]),s._v(" 一.存储引擎简介")]),s._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/db/mysqlbasic/storage-1.png"),alt:"wxmp"}}),s._v(" "),a("p",[s._v("1、文件系统：")]),s._v(" "),a("p",[s._v("1.1 操作系统组织和存取数据的一种机制。")]),s._v(" "),a("p",[s._v("1.2 文件系统是一种软件。")]),s._v(" "),a("p",[s._v("2、文件系统类型：ext2 3 4 ，xfs 数据")]),s._v(" "),a("p",[s._v("2.1 不管使用什么文件系统，数据内容不会变化")]),s._v(" "),a("p",[s._v("2.2 不同的是，存储空间、大小、速度。")]),s._v(" "),a("p",[s._v("3、MySQL引擎：")]),s._v(" "),a("p",[s._v("3.1 可以理解为，MySQL的“文件系统”，只不过功能更加强大。")]),s._v(" "),a("p",[s._v("4、MySQL引擎功能：")]),s._v(" "),a("p",[s._v("4.1 除了可以提供基本的存取功能，还有更多功能事务功能、锁定、备份和恢复、优化以及特殊功能")]),s._v(" "),a("p",[a("strong",[s._v("总之，存储引擎的各项特性就是为了保障数据库的安全和性能设计结构。")])]),s._v(" "),a("h2",{attrs:{id:"二-mysql自带的存储引擎类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-mysql自带的存储引擎类型"}},[s._v("#")]),s._v(" 二.MySQL自带的存储引擎类型")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("MySQL 提供以下存储引擎:")]),s._v(" "),a("strong",[s._v("01）InnoDB")])]),s._v(" "),a("p",[a("strong",[s._v("02）MyISAM")]),s._v("\n03）MEMORY\n04）ARCHIVE\n05）FEDERATED\n06）EXAMPLE\n07）BLACKHOLE\n08）MERGE\n09）NDBCLUSTER\n10）CSV")])]),s._v(" "),a("hr"),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("还可以使用第三方存储引擎:")]),s._v("\n01）MySQL当中插件式的存储引擎类型\n02）MySQL的两个分支\n03）perconaDB\n04）mariaDB")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看当前MySQL支持的存储引擎类型")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show engines\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看innodb的表有哪些")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" table_schema,table_name,engine from information_schema.tables where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'innodb'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看myisam的表有哪些")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" table_schema,table_name,engine from information_schema.tables where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'myisam'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[a("strong",[s._v("1、innodb和myisam的区别")])]),s._v(" "),a("p",[a("em",[s._v("物理上的区别：")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# myisam")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入mysql目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01~l"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /application/mysql/data/mysql")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有user的文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll user.*")]),s._v("\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10684")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v(" user.frm\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("960")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" 01:15 user.MYD\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" 01:15 user.MYI\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# innodb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入word目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /application/mysql/data/world/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有city的文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll city.*")]),s._v("\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8710")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":23 city.frm\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("688128")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":23 city.ibd\n")])])]),a("p",[a("strong",[s._v("2.innodb存储引擎的简介")])]),s._v(" "),a("p",[a("strong",[s._v("在MySQL5.5版本之后，默认的存储引擎，提供高可靠性和高性能。")])]),s._v(" "),a("blockquote",[a("p",[s._v("优点:\n01）事务安全（遵从 ACID）\n02）MVCC（Multi-Versioning Concurrency Control，多版本并发控制）\n03）InnoDB 行级别锁定\n04）Oracle 样式一致非锁定读取\n05）表数据进行整理来优化基于主键的查询\n06）支持外键引用完整性约束\n07）大型数据卷上的最大性能\n08）将对表的查询与不同存储引擎混合\n09）出现故障后快速自动恢复\n10）用于在内存中缓存数据和索引的缓冲区池")])]),s._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/db/mysqlbasic/storage-2.png"),alt:"wxmp"}}),s._v(" "),a("p",[a("strong",[s._v("innodb核心特性")])]),s._v(" "),a("blockquote",[a("p",[s._v("重点:\nMVCC\n事务\n行级锁\n热备份\nCrash Safe Recovery（自动故障恢复）")])]),s._v(" "),a("p",[a("strong",[s._v("3.查看存储引擎")])]),s._v(" "),a("p",[s._v("1）使用 SELECT 确认会话存储引擎")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询默认存储引擎")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@default_storage_engine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@default_storage_engine")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------------+")]),s._v("\n")])])]),a("p",[s._v("2）使用 SHOW 确认每个表的存储引擎")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看表的存储引擎")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" city\\G\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("countrylanguage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("3）使用 INFORMATION_SCHEMA 确认每个表的存储引擎")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看表的存储引擎")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" table_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" information_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" table_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'city'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" table_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'world'")]),s._v("\\G\n")])])]),a("p",[a("strong",[s._v("4.存储引擎的设置")])]),s._v(" "),a("p",[s._v("1）在启动配置文件中设置服务器存储引擎")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在配置文件的[mysqld]标签下添加")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndefault-storage-engine"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Storage Engine"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndefault-storage-engine"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("innodb\n")])])]),a("p",[s._v("2）使用 SET 命令为当前客户机会话设置")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在MySQL命令行中临时设置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@storage_engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Storage "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@storage_engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myisam"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" warning "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("（3）在 create table 语句指定")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#建表的时候指定存储引擎")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Storage "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("￼\n")])])]),a("h2",{attrs:{id:"三-真实企业案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-真实企业案例"}},[s._v("#")]),s._v(" 三.真实企业案例")]),s._v(" "),a("p",[a("strong",[s._v("项目背景：")])]),s._v(" "),a("p",[s._v("公司原有的架构：一个展示型的网站，LAMT，MySQL5.1.77版本（MYISAM），50M数据量。")]),s._v(" "),a("p",[a("strong",[s._v("小问题不断：")])]),s._v(" "),a("ul",[a("li",[s._v("1、表级锁：对表中任意一行数据修改类操作时，整个表都会锁定，对其他行的操作都不能同时进行。")]),s._v(" "),a("li",[s._v("2、不支持故障自动恢复（CSR）：当断电时有可能会出现数据损坏或丢失的问题。")])]),s._v(" "),a("p",[a("strong",[s._v("如何解决：")])]),s._v(" "),a("ul",[a("li",[s._v("1、提建议将现有的MYISAM引擎替换为Innodb，将版本替换为5.6.38\n"),a("ul",[a("li",[s._v("1）如果使用MYISAM会产生”小问题”，性能安全不能得到保证，使用innodb可以解决这个问题。")]),s._v(" "),a("li",[s._v("2）5.1.77版本对于innodb引擎支持不够完善，5.6.38版本对innodb支持非常完善了。")])])]),s._v(" "),a("li",[s._v("2、实施过程和注意要素")])]),s._v(" "),a("p",[s._v("1）备份生产库数据（mysqldump）")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql -uroot -p1")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use test1\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建程序业务库")]),s._v("\ncreate table test1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myisam"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncreate table test2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myisam"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncreate table test3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myisam"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysqldump -uroot -p1 -B test1 > /tmp/full.sql")]),s._v("\n")])])]),a("p",[s._v("2）准备一个新的MySQL环境 5.6.44 版本")]),s._v(" "),a("p",[s._v("3）更改数据，将myisam替换成innodb")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sed -i 's#ENGINE=MyISAM#ENGINE=InnoDB#g' /tmp/full.sql")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /tmp/full.sql ")]),s._v("\n:%s"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#MyISAM#InnoDB#g")]),s._v("\n")])])]),a("p",[s._v("4）将修改后的sql文件恢复到新库里")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@db01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scp /tmp/full.sql root@172.16.1.52:/tmp/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@db02")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql -uroot -p123 < /tmp/full.sql ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@db01")]),s._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql -uroot -p123 -h 10.0.0.52 < /tmp/full.sql ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@db02")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql -uroot -p123")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("databases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Database")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" information_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" performance_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test1              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" table_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("table_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" information_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'innodb'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------+----------------------+--------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" table_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" table_name           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------+----------------------+--------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" innodb_index_stats   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" innodb_table_stats   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slave_master_info    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slave_relay_log_info "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slave_worker_info    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test1        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test1                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test1        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test2                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test1        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test3                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------+----------------------+--------+")]),s._v("\n")])])]),a("p",[s._v("5）应用测试环境连接新库，测试所有功能")]),s._v(" "),a("p",[s._v("6）停应用，将备份之后的生产库发生的新变化，补偿到新库")]),s._v(" "),a("p",[s._v("7）应用割接到新数据库")]),s._v(" "),a("p",[a("strong",[s._v("项目结果：")])]),s._v(" "),a("p",[s._v("*解决了”小问题” *")]),s._v(" "),a("h2",{attrs:{id:"四-innodb存储引擎-表空间介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-innodb存储引擎-表空间介绍"}},[s._v("#")]),s._v(" 四.Innodb存储引擎——表空间介绍")]),s._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/db/mysqlbasic/storage-3.png"),alt:"wxmp"}}),s._v(" "),a("p",[a("strong",[s._v("5.5版本以后出现共享表空间概念")])]),s._v(" "),a("p",[s._v("表空间的管理模式的出现是为了数据库的存储更容易扩展")]),s._v(" "),a("p",[a("strong",[s._v("5.6版本中默认的是独立表空间")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("1、共享表空间")])])]),s._v(" "),a("p",[s._v("1）查看共享表空间")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#物理查看")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /application/mysql/data/")]),s._v("\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79691776")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":23 ibdata1\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令行查看")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%path%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+-----------------------+------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------------+------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" innodb_data_file_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ibdata1:12M:autoextend "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------------+------------------------+\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看共享表空间大小")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# du -sh ibdata1")]),s._v("\n76M\tibdata1\n")])])]),a("blockquote",[a("p",[s._v("5.6版本中默认存储:\n1.系统数据\n2.undo\n3.临时表")])]),s._v(" "),a("p",[a("strong",[s._v("5.7版本中默认会将undo和临时表独立出来，5.6版本也可以独立，只不过需要在初始化的时候进行配置")])]),s._v(" "),a("p",[s._v("2）设置方法")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编辑配置文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/my.cnf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("innodb_data_file_path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ibdata1:50M"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("ibdata2:50M:autoextend\n")])])]),a("ul",[a("li",[a("strong",[s._v("2、独立表空间")])])]),s._v(" "),a("p",[s._v("对于用户自主创建的表，会采用此种模式，每个表由一个独立的表空间进行管理")]),s._v(" "),a("p",[s._v("1）查看独立表空间")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#物理查看")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /application/mysql/data/world/")]),s._v("\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("688128")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":23 city.ibd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令行查看")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%per_table%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("innodb_file_per_table")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON\n")])])]),a("hr"),s._v(" "),a("p",[a("strong",[s._v("企业案例")])]),s._v(" "),a("p",[s._v("在没有备份数据的情况下，突然断电导致表损坏，打不开数据库。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#模拟环境拷贝库目录到新库中")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar czf world.tgz world")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scp world.tgz 172.16.1.52:/application/mysql/data/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db02 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /application/mysql/data/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db02 data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf world.tgz ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登陆数据库查看")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db02 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql -uroot -p123")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show databases"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Database           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" information_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" performance_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test1              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" world              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use world\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show tables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+-----------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Tables_in_world "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" city            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" country         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" countrylanguage "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------+\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询表中数据")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nERROR "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1146")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("42S02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": Table "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'world.city'")]),s._v(" doesn't exist\n")])])]),a("p",[s._v("1.在企业中管开发要建表语句")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建新表city1")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("city1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("CountryCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("District"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("Population"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("CountryCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("CountryCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("idx_pop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("Population"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除外键创建语句")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CONSTRAINT `city_ibfk_1` FOREIGN KEY (`CountryCode`) REFERENCES `country` (`Code`)")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4080")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("latin1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Tables_in_world "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" city            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" city1           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" country         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" countrylanguage "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+")]),s._v("\n")])])]),a("p",[s._v("2.删除新表的，独立表空间")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除表空间文件")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" alter table world.city1 discard tablespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db02 world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1092")]),s._v("\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8710")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 01:52 city1.frm\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-rw-rw---- 1 mysql mysql 131072 Nov  7 21:11 city1.ibd（已删除）")]),s._v("\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8710")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":17 city.frm\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("671744")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":17 city.ibd\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9172")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":49 country.frm\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("163840")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":49 country.ibd\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8702")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":49 countrylanguage.frm\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("229376")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":49 countrylanguage.ibd\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":49 db.opt\n")])])]),a("p",[s._v("3.拷贝旧表的独立表空间")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db02 world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -a city.ibd city1.ibd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db02 world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1748")]),s._v("\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8710")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 01:52 city1.frm\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("671744")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 01:54 city1.ibd\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8710")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":17 city.frm\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("671744")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":17 city.ibd\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9172")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":49 country.frm\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("163840")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":49 country.ibd\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8702")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":49 countrylanguage.frm\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("229376")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":49 countrylanguage.ibd\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":49 db.opt\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from city1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nERROR "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1814")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HY000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": Tablespace has been discarded "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" table "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'city1'")]),s._v("\n")])])]),a("p",[s._v("4.导入独立表空间")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" city1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tablespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("5.物理删除 旧表")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@db02")]),s._v(" world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rm -fr city.*")]),s._v("\n")])])]),a("p",[s._v("6.改表名")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" city1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rename")]),s._v(" city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("7.如果是新库，那么最后一步，还是 应用割接（修改代码连库的IP）")]),s._v(" "),a("h2",{attrs:{id:"五-innodb核心特性-事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五-innodb核心特性-事务"}},[s._v("#")]),s._v(" 五.Innodb核心特性——事务")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("1.什么是事务")])])]),s._v(" "),a("p",[a("em",[s._v("主要针对DML语句（update，delete，insert）")])]),s._v(" "),a("blockquote",[a("p",[s._v("一组数据操作执行步骤，这些步骤被视为一个工作单元:\n1）用于对多个语句进行分组\n2）可以在多个客户机并发访问同一个表中的数据时使用")])]),s._v(" "),a("hr"),s._v(" "),a("blockquote",[a("p",[s._v("所有步骤都成功或都失败\n1）如果所有步骤正常，则执行\n2）如果步骤出现错误或不完整，则取消")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("2.事务的通俗理解")])])]),s._v(" "),a("p",[a("em",[s._v("伴随着“交易”出现的数据库概念。")])]),s._v(" "),a("blockquote",[a("p",[s._v("我们理解的“交易”是什么？\n1）物与物的交换（古代）\n2）货币现金与实物的交换（现代1）\n3）虚拟货币与实物的交换（现代2）\n4）虚拟货币与虚拟实物交换（现代3）")])]),s._v(" "),a("hr"),s._v(" "),a("blockquote",[a("p",[s._v("数据库中的“交易”是什么？\n1）事务又是如何保证“交易”的“和谐”？\n2）ACID")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("3.事务ACID特性")])])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("Atomic（原子性）\n所有语句作为一个单元全部成功执行或全部取消。")]),s._v(" "),a("p",[s._v("Consistent（一致性）\n如果数据库在事务开始时处于一致状态，则在执行该。\n事务期间将保留一致状态。")]),s._v(" "),a("p",[s._v("Isolated（隔离性）\n事务之间不相互影响。")]),s._v(" "),a("p",[s._v("Durable（持久性）\n事务成功完成后，所做的所有更改都会准确地记录在\n数据库中。所做的更改不会丢失。")]),s._v(" "),a("hr"),s._v(" "),a("ul",[a("li",[a("strong",[s._v("4.事务流程举例")]),s._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/db/mysqlbasic/storage-4.png"),alt:"wxmp"}})]),s._v(" "),a("li",[a("strong",[s._v("5.事务的控制语句")])])]),s._v(" "),a("blockquote",[a("p",[s._v("如下:\nstart transaction;（或 begin;）：显式开始一个新事务\nSAVEPOINT：分配事务过程中的一个位置，以供将来引用（存档）\nCOMMIT：永久记录当前事务所做的更改\nROLLBACK：取消当前事务所做的更改\nROLLBACK TO SAVEPOINT：取消在 savepoint 之后执行的更改（读挡）\nRELEASE SAVEPOINT：删除 savepoint 标识符（删档）\nSET AUTOCOMMIT：为当前连接禁用或启用默认 autocommit 模式")])]),s._v(" "),a("p",[a("strong",[s._v("一个成功事务的生命周期")]),s._v("\nbegin;\nsql1\nsql2\nsql3\n...\ncommit;")]),s._v(" "),a("p",[a("strong",[s._v("一个失败事务的生命周期")]),s._v("\nbegin;\nsql1\nsql2\nsql3\n...\nrollback;")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("3.自动提交")])])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看自动提交")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'autocommit'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" autocommit    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-------+")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#临时关闭")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" autocommit"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#永久关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@db01")]),s._v(" world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/my.cnf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nautocommit"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),a("ul",[a("li",[a("strong",[s._v("4.事务演示")])])]),s._v(" "),a("p",[s._v("1）成功事务")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" stu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nsex "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("enum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'f'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'m'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nmoney "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" stu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("sex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("money"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhang3'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'m'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhang4'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'m'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("2）事务回滚")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" stu "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhang3'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" stu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rollback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[a("strong",[s._v("6.事务隐式提交情况")])])]),s._v(" "),a("p",[s._v("1）现在版本在开启事务时，不需要手工begin，只要你输入的是DML语句，就会自动开启事务。\n2）有些情况下事务会被隐式提交")]),s._v(" "),a("blockquote",[a("p",[s._v("例如:\n在事务运行期间，手工执行begin的时候会自动提交上个事务\n在事务运行期间，加入DDL、DCL操作会自动提交上个事务\n在事务运行期间，执行锁定语句（lock tables、unlock tables）\nload data infile\nselect for update xxx set xxx where xx=xxx;\n在autocommit=1的时候")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("7.事务日志redo基本功能")])])]),s._v(" "),a("p",[a("strong",[s._v("1）Redo是什么？")])]),s._v(" "),a("p",[s._v("redo,顾名思义“重做日志”，是事务日志的一种。")]),s._v(" "),a("p",[a("strong",[s._v("2）作用是什么？")])]),s._v(" "),a("p",[s._v("在事务ACID过程中，实现的是“D”持久化的作用。\n"),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/db/mysqlbasic/storage-5.png"),alt:"wxmp"}})]),s._v(" "),a("p",[a("strong",[s._v("特性:WAL(Write Ahead Log)日志优先写")]),s._v(" "),a("strong",[s._v("REDO：记录的是，内存数据页的变化过程")])]),s._v(" "),a("p",[a("strong",[s._v("3）REDO工作过程")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行步骤")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" t1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" num"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" num"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])])]),a("p",[s._v("1）首先将t1表中num=1的行所在数据页加载到内存中buffer page\n2）MySQL实例在内存中将num=1的数据页改成num=2\n3）num=1变成num=2的变化过程会记录到，redo内存区域，也就是redo buffer page中")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#提交事务执行步骤")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])])]),a("p",[s._v("1）当敲下commit命令的瞬间，MySQL会将redo buffer page写入磁盘区域redo log\n2）当写入成功之后，commit返回ok")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("8.redo数据实例恢复过程")])])]),s._v(" "),a("p",[s._v("图解")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("9.事务日志undo")])])]),s._v(" "),a("p",[a("strong",[s._v("1）undo是什么？")])]),s._v(" "),a("p",[s._v("undo,顾名思义“回滚日志”，是事务日志的一种。")]),s._v(" "),a("p",[s._v("_"),a("strong",[s._v("2）作用是什么？")])]),s._v(" "),a("p",[s._v("在事务ACID过程中，实现的是“A”原子性的作用。当然CI的特性也和undo有关")]),s._v(" "),a("p",[s._v("原子性：你的事务 要么全部成功，要么全部取消")]),s._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/db/mysqlbasic/storage-6.png"),alt:"wxmp"}}),s._v(" "),a("ul",[a("li",[a("strong",[s._v("10.redo和undo的存储位置")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#redo位置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /application/mysql/data/")]),s._v("\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50331648")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" 06:34 ib_logfile0\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50331648")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v(" ib_logfile1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#undo位置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@db01 data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /application/mysql/data/")]),s._v("\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79691776")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" 06:34 ibdata1\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79691776")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" 06:34 ibdata2\n")])])]),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/db/mysqlbasic/storage-7.png"),alt:"wxmp"}}),s._v(" "),a("p",[a("strong",[s._v("在MySQL5.6版本中undo是在ibdata文件中，在MySQL5.7版本会独立出来。")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("11.事务中的锁")])])]),s._v(" "),a("p",[a("strong",[s._v("1）什么是“锁”？")])]),s._v(" "),a("p",[s._v("“锁”顾名思义就是锁定的意思。")]),s._v(" "),a("p",[a("strong",[s._v("2）“锁”的作用是什么？")])]),s._v(" "),a("p",[s._v("在事务ACID特性过程中，“锁”和“隔离级别”一起来实现“I”隔离性的作用。")]),s._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/db/mysqlbasic/storage-8.png"),alt:"wxmp"}}),s._v(" "),a("p",[s._v("排他锁：保证在多事务操作时，数据的一致性。")]),s._v(" "),a("p",[s._v("共享锁：保证在多事务工作期间，数据查询时不会被阻塞。")]),s._v(" "),a("p",[s._v("悲观锁：同时修改数据，谁先修改谁为准")]),s._v(" "),a("p",[s._v("乐观锁：谁先提交谁为准")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("12.多版本并发控制（MVCC）")])])]),s._v(" "),a("p",[s._v("1）只阻塞修改类操作，不阻塞查询类操作 （排它锁和共享锁）\n2）乐观锁的机制（谁先提交谁为准）")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("13.锁的粒度")]),s._v("\nMyIsam：低并发锁（表级锁）\nInnodb：高并发锁（行级锁）")]),s._v(" "),a("li",[a("strong",[s._v("14.事务的隔离级别")])])]),s._v(" "),a("p",[a("em",[s._v("四种隔离级别：")])]),s._v(" "),a("p",[s._v("READ UNCOMMITTED（独立提交）\n允许事务查看其他事务所进行的未提交更改")]),s._v(" "),a("p",[s._v("READ COMMITTED\n允许事务查看其他事务所进行的已提交更改")]),s._v(" "),a("p",[s._v("REPEATABLE READ******\n确保每个事务的 SELECT 输出一致\nInnoDB 的默认级别")]),s._v(" "),a("p",[s._v("SERIALIZABLE\n将一个事务的结果与其他事务完全隔离")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看隔离级别")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%iso%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-----------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-----------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" tx_isolation  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPEATABLE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("READ")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-----------------+")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改隔离级别为RU")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ntransaction_isolation"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("read")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uncommit\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" oldboy\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" stu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" stu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("sex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("money"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'li4'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'f'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改隔离级别为RC")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ntransaction_isolation"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("read")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),s._v("\n")])])]),a("p",[s._v("脏读 幻读 重复读 查询原因，和解决办法")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("脏读:一个事务读到另外一个事务还没有提交的数据。\n解决方法：把事务隔离级别调整到READ COMMITTED\n\n不可重复读:一个事务先后读取同一条记录，但两次读取的数据不同。\n解决方法：把事务隔离级别调整到REPEATABLE READ。\n\n幻象读:一个事务先后读取一个范围的记录，但两次读取的纪录数不同。\n解决方法：把事务隔离级别调整到SERIALIZABLE。\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", 脏读\n一个事务读到另一个事务，尚未提交的修改，就是脏读。这里所谓的修改，除了Update操作,不要忘了,还包括\nInsert和Delete操作。\n脏读的后果：如果后一个事务回滚，那么它所做的修改，统统都会被撤销。前一个事务读到的数据，就是垃圾数据。\n\n举个例子：预订房间。\n有一张Reservation表，往表中插入一条记录，来订购一个房间。\n事务1：在Reservation表中插入一条记录，用于预订99号房间。\n事务2：查询，尚未预定的房间列表，因为99号房间，已经被事务1预订。所以不在列表中。\n事务1：信用卡付款。由于付款失败，导致整个事务回滚。所以插入到Reservation 表中的记录并不置为持久（即它将被删除）。现在99号房间则为可用。所以，事务2所用的是一个无效的房间列表，因为99号房间，已经可用。如果它是最后一个没有被预定的房间，那么这将是一个严重的失误。\n\n注：脏读的后果很严重。\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("，不可重复读。\n在同一个事务中，再次读取数据时【就是你的select操作】，所读取的数据，和第1次读取的数据，不一样了。就是不可重复读。\n举个例子：\n事务1：查询99号房间是否为双人床房间。结果99号是。\n事务2：将99号房间，改成单人床房间。\n事务1：再次执行查询，99号房间不是双人房了。也就是说，事务1，可以看到其他事务所做的修改。\n\n在不可重复读里面，可以看到其他事务所做的修改，而导致2次的查询结果不再一样了。\n这里的修改，是提交过的。也可以是没有提交的，这种情况同时也是脏读。\n\n如果，数据库系统的隔离级别允许不可重复读。那么你启动一个事务，并做一个select查询操作。查询到的数据，就有可能，和你第2次，3次"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".n次，查询到的数据不一样。一般情况下，你只会做一次，select查询，并以这一次的查询数据，作为后续计算的基础。因为允许出现，不可重复读。那么任何时候，查询到的数据，都有可能被其他事务更新，查询的结果将是不确定的。\n注：如果允许不可重复读，你的查询结果将是不确定的。一个不确定的结果，你能容忍吗？\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("，幻读\n事务1读取指定的where子句所返回的一些行。然后，事务2插入一个新行，这个新行也满足事务1使用的查询where子句。然后事务1再次使用相同的查询读取行，但是现在它看到了事务2刚插入的行。这个行被称为幻象，因为对事务1来说，这一行的出现是不可思议的。\n\n举个例子：\n事务1：请求没有预定的，双人床房间列表。99号在其中。\n事务2：向Reservation表中插入一个新纪录，以预订99号房间，并提交。\n事务1：再次请求有双人床的未预定的房间列表，99号房间，不再位于列表中。\n\n注：幻读，针对的是，Insert操作。如果事务2，插入的记录，没有提交。那么同时也是脏读。\n")])])]),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),a("ul",[a("li")])])}),[],!1,null,null,null);t.default=r.exports}}]);