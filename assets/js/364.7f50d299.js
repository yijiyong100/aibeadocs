(window.webpackJsonp=window.webpackJsonp||[]).push([[364],{879:function(s,a,t){"use strict";t.r(a);var r=t(53),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("本文主要是介绍 SQL编写规范36条。")])]),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#sql编写规范36条"}},[s._v("SQL编写规范36条")]),t("ul",[t("li",[t("a",{attrs:{href:"#_1-去掉不必要的括号"}},[s._v("1. 去掉不必要的括号")])]),t("li",[t("a",{attrs:{href:"#_2-去掉重叠常量"}},[s._v("2. 去掉重叠常量")])]),t("li",[t("a",{attrs:{href:"#_3-去除常量条件-由于常量重叠需要"}},[s._v("3. 去除常量条件(由于常量重叠需要)")])]),t("li",[t("a",{attrs:{href:"#_4-去掉无意义的连接用条件"}},[s._v("4. 去掉无意义的连接用条件")])]),t("li",[t("a",{attrs:{href:"#_5-开发过程中不使用拼字符串的方式来完成where子句"}},[s._v("5. 开发过程中不使用拼字符串的方式来完成where子句")])]),t("li",[t("a",{attrs:{href:"#_6-多使用等值操作-少使用非等值操作"}},[s._v("6. 多使用等值操作，少使用非等值操作")])]),t("li",[t("a",{attrs:{href:"#_7-常数表优先-字典表或小表其次-大表最后"}},[s._v("7. 常数表优先，字典表或小表其次，大表最后")])]),t("li",[t("a",{attrs:{href:"#_8-减少或避免临时表"}},[s._v("8. 减少或避免临时表")])]),t("li",[t("a",{attrs:{href:"#_9-where子句中的数据扫描别跨越表的30"}},[s._v("9. where子句中的数据扫描别跨越表的30%")])]),t("li",[t("a",{attrs:{href:"#_10-where子句中同一个表的不同的字段组合建议小于等于5组-否则考虑业务逻辑或分表"}},[s._v("10. where子句中同一个表的不同的字段组合建议小于等于5组，否则考虑业务逻辑或分表")])]),t("li",[t("a",{attrs:{href:"#_11-不使用is-null或is-not-null-字段设计时建议not-null-若麻烦可折中考虑给一默认值"}},[s._v("11. 不使用is null或is not null，字段设计时建议not null，若麻烦可折中考虑给一默认值")])]),t("li",[t("a",{attrs:{href:"#_12-使用like时-不要放在首字符位置。"}},[s._v("12. 使用like时，%不要放在首字符位置。")])]),t("li",[t("a",{attrs:{href:"#_13-值域比较多的表字段放在前面"}},[s._v("13. 值域比较多的表字段放在前面")])]),t("li",[t("a",{attrs:{href:"#_14-表字段组合中出现比较多的表字段放在前面"}},[s._v("14. 表字段组合中出现比较多的表字段放在前面")])]),t("li",[t("a",{attrs:{href:"#_15-表字段不能有表达式或是函数"}},[s._v("15. 表字段不能有表达式或是函数")])]),t("li",[t("a",{attrs:{href:"#_16-注意表字段的类型-避免表字段的隐示转换"}},[s._v("16. 注意表字段的类型，避免表字段的隐示转换")])]),t("li",[t("a",{attrs:{href:"#_17-考虑使用union-all-少使用union-注意考虑去重"}},[s._v("17. 考虑使用union all，少使用union，注意考虑去重")])]),t("li",[t("a",{attrs:{href:"#_18-不同字段的值or或in大于等于3次-考虑用union-all替换-同一字段的值or用in替换"}},[s._v("18. 不同字段的值or或in大于等于3次，考虑用union all替换；同一字段的值or用in替换")])]),t("li",[t("a",{attrs:{href:"#_19-用where子句替换having子句"}},[s._v("19. 用Where子句替换HAVING子句")])]),t("li",[t("a",{attrs:{href:"#_20-对同一表的order-by和group-by操作分别小于3组-否则考虑业务逻辑或分表"}},[s._v("20. 对同一表的order by和group by操作分别小于3组，否则考虑业务逻辑或分表")])]),t("li",[t("a",{attrs:{href:"#_21-尽量使用主键进行update和delete"}},[s._v("21. 尽量使用主键进行update和delete")])]),t("li",[t("a",{attrs:{href:"#_22-小心text-blobs等大字段-如果确实不需要这样的大字段-则不用放入sql语句中"}},[s._v("22. 小心text/blobs等大字段，如果确实不需要这样的大字段，则不用放入sql语句中")])]),t("li",[t("a",{attrs:{href:"#_23-使用insert-on-duplicate-key-update-insert-ignore-来避免不必要的查询"}},[s._v("23. 使用INSERT ... ON DUPLICATE KEY update (INSERT IGNORE)来避免不必要的查询")])]),t("li",[t("a",{attrs:{href:"#其他场景"}},[s._v("其他场景")])])])]),t("li",[t("a",{attrs:{href:"#参考文章"}},[s._v("参考文章")])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"sql编写规范36条"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql编写规范36条"}},[s._v("#")]),s._v(" SQL编写规范36条")]),s._v(" "),t("p",[s._v("以后可能还会增多，也可以考虑做一下减法。")]),s._v(" "),t("h3",{attrs:{id:"_1-去掉不必要的括号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-去掉不必要的括号"}},[s._v("#")]),s._v(" 1. 去掉不必要的括号")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("如：      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("OR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n修改成    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("OR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"_2-去掉重叠常量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-去掉重叠常量"}},[s._v("#")]),s._v(" 2. 去掉重叠常量")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("如：      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n修改成    b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])])]),t("h3",{attrs:{id:"_3-去除常量条件-由于常量重叠需要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-去除常量条件-由于常量重叠需要"}},[s._v("#")]),s._v(" 3. 去除常量条件(由于常量重叠需要)")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("如：      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("B"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("OR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("B"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("OR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("B"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n修改成    B"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("OR")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\n")])])]),t("h3",{attrs:{id:"_4-去掉无意义的连接用条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-去掉无意义的连接用条件"}},[s._v("#")]),s._v(" 4. 去掉无意义的连接用条件")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("如："),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("，"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("，"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("等   直接从"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v("子句中去掉。\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("郑松华"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("注解 ：但是对于"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 有可能是开发为了动态添加"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v(" 标准化而写 \n如 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" emp "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" emp_no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" …"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("  这样后面都是"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" 开始 \n")])])]),t("h3",{attrs:{id:"_5-开发过程中不使用拼字符串的方式来完成where子句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-开发过程中不使用拼字符串的方式来完成where子句"}},[s._v("#")]),s._v(" 5. 开发过程中不使用拼字符串的方式来完成where子句")]),s._v(" "),t("h3",{attrs:{id:"_6-多使用等值操作-少使用非等值操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-多使用等值操作-少使用非等值操作"}},[s._v("#")]),s._v(" 6. 多使用等值操作，少使用非等值操作")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v("条件中的非等值条件（"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("BETWEEN")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v("）会导致后面的条件使用不了索引，因为不能同时用到两个范围条件。\n郑松华注解 ：对这条有疑问 因为一个"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v(" 的一个表来说只分access 和 fiter 只要使用了相应的选择率好的索引过滤了大部分数据对后面\n作为fiter 条件来说没有大问题 \n")])])]),t("h3",{attrs:{id:"_7-常数表优先-字典表或小表其次-大表最后"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-常数表优先-字典表或小表其次-大表最后"}},[s._v("#")]),s._v(" 7. 常数表优先，字典表或小表其次，大表最后")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v(" 常数表指：空表或只有"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("行的表。与在一个"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v("或"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNIQUE")]),s._v("索引的"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v("子句一起使用的表。如：\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" primary_key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("t2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("primary_key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("primary_key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n 字典表指：小数量的行。如：自定义的自增字段表，而不使用MySQL的"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),s._v("。\n 郑松华注解 ："),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SQL")]),s._v("的执行计划是基于cost的 除非强制使用hint 所以无法控制\n 上面的可以改为 表的连接条件最好是查询结果集最少的为驱动表 后续表要有良好的索引\n")])])]),t("h3",{attrs:{id:"_8-减少或避免临时表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-减少或避免临时表"}},[s._v("#")]),s._v(" 8. 减少或避免临时表")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("如果有一个"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v("子句和不同的"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v("子句，或如果"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v("或"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v("包含联接队列中的第一个表之外的其它表的列，则创建一个临时表。\n郑松华注解 ：这里说的临时表应该是执行计划中extra部分的 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temporary")]),s._v(" 和 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" filesort 关键字 \n")])])]),t("h3",{attrs:{id:"_9-where子句中的数据扫描别跨越表的30"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-where子句中的数据扫描别跨越表的30"}},[s._v("#")]),s._v(" 9. where子句中的数据扫描别跨越表的30%")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("比如："),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" primary_key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("或者primary_key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("…"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("，这样跨表的数据肯定超过"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("了。\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("，其中"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("值非常少，主要是"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("值，比如一个表的记录删除用了一个状态位，而删除的记录又比较少。\n郑松华注解 ：这个应该讲的是索引的选择率问题 ，如果是删除数据的话 大量删除考虑创建一个临时表 改表名的方法或者\n分段删除的方法 最好不要一次性 进行大量删除\n")])])]),t("h3",{attrs:{id:"_10-where子句中同一个表的不同的字段组合建议小于等于5组-否则考虑业务逻辑或分表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-where子句中同一个表的不同的字段组合建议小于等于5组-否则考虑业务逻辑或分表"}},[s._v("#")]),s._v(" 10. where子句中同一个表的不同的字段组合建议小于等于5组，否则考虑业务逻辑或分表")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v(" 郑松华注解 ：只要有一个进行好的选择率的索引条件 有几个都无所谓\n")])])]),t("h3",{attrs:{id:"_11-不使用is-null或is-not-null-字段设计时建议not-null-若麻烦可折中考虑给一默认值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-不使用is-null或is-not-null-字段设计时建议not-null-若麻烦可折中考虑给一默认值"}},[s._v("#")]),s._v(" 11. 不使用is null或is not null，字段设计时建议not null，若麻烦可折中考虑给一默认值")]),s._v(" "),t("h3",{attrs:{id:"_12-使用like时-不要放在首字符位置。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12-使用like时-不要放在首字符位置。"}},[s._v("#")]),s._v(" 12. 使用like时，%不要放在首字符位置。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("``` sql\n如果%必须放在首字符位置郑松华注解 ：这是基于有索引而言，记住只是字符类型 如果是别的数据类型即使把%放在后面一样不能使用索引\n```\n")])])]),t("h3",{attrs:{id:"_13-值域比较多的表字段放在前面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_13-值域比较多的表字段放在前面"}},[s._v("#")]),s._v(" 13. 值域比较多的表字段放在前面")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("``` sql\n比如：id，date字段放在前面，而status这样的字段放在后面，具体的可以通过执行计划来把握。郑松华注解 ：不知道作者想表达意思 ？ 如果是SQL中的select 列中的话 上面的没有关系 因为只跟是否回表有关系\n```\n")])])]),t("h3",{attrs:{id:"_14-表字段组合中出现比较多的表字段放在前面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_14-表字段组合中出现比较多的表字段放在前面"}},[s._v("#")]),s._v(" 14. 表字段组合中出现比较多的表字段放在前面")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("``` sql\n方便综合评估索引，缓解因为索引过多导致的增删改的一些性能问题。\n```\n")])])]),t("h3",{attrs:{id:"_15-表字段不能有表达式或是函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_15-表字段不能有表达式或是函数"}},[s._v("#")]),s._v(" 15. 表字段不能有表达式或是函数")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("``` sql\n如：where abs(列)>3或where 列*10>100郑松华注解 ：这是基于该列有索引 如果使用上述方法会导致不能使用索引\n```\n")])])]),t("h3",{attrs:{id:"_16-注意表字段的类型-避免表字段的隐示转换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-注意表字段的类型-避免表字段的隐示转换"}},[s._v("#")]),s._v(" 16. 注意表字段的类型，避免表字段的隐示转换")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("``` sql\n比如：列为int，如果where 列=’1’，则会出现转换。郑松华注解 ：这是基于该列有索引 如果使用上述方法会导致不能使用索引\n```\n")])])]),t("h3",{attrs:{id:"_17-考虑使用union-all-少使用union-注意考虑去重"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_17-考虑使用union-all-少使用union-注意考虑去重"}},[s._v("#")]),s._v(" 17. 考虑使用union all，少使用union，注意考虑去重")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("``` sql\nunion all不去重，而少了排序操作，速度相对比union要快，如果没有去重的需求，优先使用union all。郑松华注解 ：Mysql5.6和5.7对union all 的执行计划是不一样的注意把握\n```\n")])])]),t("h3",{attrs:{id:"_18-不同字段的值or或in大于等于3次-考虑用union-all替换-同一字段的值or用in替换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_18-不同字段的值or或in大于等于3次-考虑用union-all替换-同一字段的值or用in替换"}},[s._v("#")]),s._v(" 18. 不同字段的值or或in大于等于3次，考虑用union all替换；同一字段的值or用in替换")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("``` sql\nSelect * from opp WHERE phone=‘12347856' or phone=‘42242233';\n")])])]),t("p",[s._v("考虑用\nSelect * from opp WHERE phone in ('12347856' , '42242233');")]),s._v(" "),t("p",[s._v("Select * from opp WHERE phone='010-88886666' or cellPhone='13800138000';\n考虑用\nSelect * from opp WHERE phone='010-88886666'\nunion all\nSelect * from opp WHERE cellPhone='13800138000';\n郑松华注解 ：Mysql5.6 和5.7当中对in 的处理机制有点不一样 注意把握")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("```\n")])])]),t("h3",{attrs:{id:"_19-用where子句替换having子句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_19-用where子句替换having子句"}},[s._v("#")]),s._v(" 19. 用Where子句替换HAVING子句")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("``` sql\nselect id,count(*) from table group by id having age>=30 order by null;\n")])])]),t("p",[s._v("考虑用\nselect id,count(*) from table where age>=30 group by id order by null;\n郑松华注解：上面的第一个sql 本身就不严谨 有可能出现执行计划不同结果不同\n```")]),s._v(" "),t("h3",{attrs:{id:"_20-对同一表的order-by和group-by操作分别小于3组-否则考虑业务逻辑或分表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_20-对同一表的order-by和group-by操作分别小于3组-否则考虑业务逻辑或分表"}},[s._v("#")]),s._v(" 20. 对同一表的order by和group by操作分别小于3组，否则考虑业务逻辑或分表")]),s._v(" "),t("h3",{attrs:{id:"_21-尽量使用主键进行update和delete"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_21-尽量使用主键进行update和delete"}},[s._v("#")]),s._v(" 21. 尽量使用主键进行update和delete")]),s._v(" "),t("h3",{attrs:{id:"_22-小心text-blobs等大字段-如果确实不需要这样的大字段-则不用放入sql语句中"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_22-小心text-blobs等大字段-如果确实不需要这样的大字段-则不用放入sql语句中"}},[s._v("#")]),s._v(" 22. 小心text/blobs等大字段，如果确实不需要这样的大字段，则不用放入sql语句中")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("``` sql\n郑松华注解：有可能产生行链接问题，还有排序的时候产生大量消耗\n```\n")])])]),t("h3",{attrs:{id:"_23-使用insert-on-duplicate-key-update-insert-ignore-来避免不必要的查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_23-使用insert-on-duplicate-key-update-insert-ignore-来避免不必要的查询"}},[s._v("#")]),s._v(" 23. 使用INSERT ... ON DUPLICATE KEY update (INSERT IGNORE)来避免不必要的查询")]),s._v(" "),t("h3",{attrs:{id:"其他场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他场景"}},[s._v("#")]),s._v(" 其他场景")]),s._v(" "),t("ol",{attrs:{start:"24"}},[t("li",[t("p",[s._v("考虑使用limit N，少用limit M,N，特别是大表，或M比较大的时候")])]),s._v(" "),t("li",[t("p",[s._v("减少或避免排序，如：group by语句中如果不需要排序，可以增加order by null")])]),s._v(" "),t("li",[t("p",[s._v("增删改语句中不使用不确定值函数和随机函数，如：RAND()和NOW()等。")])]),s._v(" "),t("li",[t("p",[s._v("INSERT语句使用batch提交（INSERT INTO table VALUES(),(),()„„），values的个数不超过500。")])]),s._v(" "),t("li",[t("p",[s._v("避免使用存储过程、触发器、函数、UDF、events等，容易将业务逻辑和DB耦合在一起，并且MySQL的存储过程、触发器、函数、UDF、events中存在一定的bug。")])]),s._v(" "),t("li",[t("p",[s._v("避免使用JOIN。")])]),s._v(" "),t("li",[t("p",[s._v("使用合理的SQL语句减少与数据库的交互次数。")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DUPLICATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLACE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v("、"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IGNORE")]),s._v(" 、"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" … "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" ID "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("…"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])])]),s._v(" "),t("li",[t("p",[s._v("减少使用视图，避免复杂的语句。")])]),s._v(" "),t("li",[t("p",[s._v("SQL语句中IN包含的值不超过500。")])]),s._v(" "),t("li",[t("p",[s._v("UPDATE、DELETE语句不使用LIMIT。有主键id的表WHERE条件应结合主键。")])]),s._v(" "),t("li",[t("p",[s._v("使用prepared statement，可以提供性能并且避免SQL注入。")])]),s._v(" "),t("li",[t("p",[s._v("InnoDB表避免使用COUNT(*)操作，计数统计实时要求较强可以使用memcache或者redis，非实时统计可以使用单独统计表，定时更新。")])]),s._v(" "),t("li",[t("p",[s._v("禁止在Update语句，将“,”写成“and”，非常危险。")])])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("正确示例："),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" uid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("uid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("gid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n错误示例："),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" uid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("uid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" gid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n此时“uid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("uid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" gid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("”将作为值赋给uid，并且无Warning！！！\n")])])]),t("h2",{attrs:{id:"参考文章"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),t("ul",[t("li",[s._v("http://static.kancloud.cn/wubx/mysql-sql-standard/600524")])])])}),[],!1,null,null,null);a.default=e.exports}}]);