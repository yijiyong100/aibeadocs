(window.webpackJsonp=window.webpackJsonp||[]).push([[392],{907:function(a,t,s){"use strict";s.r(t);var n=s(53),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("本文主要是介绍 Flink-安装部署案例 。")])]),a._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#_1-概述"}},[a._v("1. 概述")])]),s("li",[s("a",{attrs:{href:"#_2-flink-standalone-ha安装"}},[a._v("2. Flink Standalone HA安装")]),s("ul",[s("li",[s("a",{attrs:{href:"#_2-1-环境准备"}},[a._v("2.1 环境准备")])]),s("li",[s("a",{attrs:{href:"#_2-2-安装规划"}},[a._v("2.2 安装规划")])]),s("li",[s("a",{attrs:{href:"#_2-3-安装"}},[a._v("2.3 安装")])])])]),s("li",[s("a",{attrs:{href:"#_3-flink-on-yarn安装"}},[a._v("3. Flink On Yarn安装")]),s("ul",[s("li",[s("a",{attrs:{href:"#_3-1-软件配置选择"}},[a._v("3.1 软件配置选择")])]),s("li",[s("a",{attrs:{href:"#_3-2-安装"}},[a._v("3.2 安装")])]),s("li",[s("a",{attrs:{href:"#_3-3-flink-on-yarn三种部署模式"}},[a._v("3.3 flink on yarn三种部署模式")])])])]),s("li",[s("a",{attrs:{href:"#_4-总结"}},[a._v("4. 总结")])]),s("li",[s("a",{attrs:{href:"#【-】"}},[a._v("【----------------------------】")])]),s("li",[s("a",{attrs:{href:"#flink安装及使用"}},[a._v("Flink安装及使用")])]),s("li",[s("a",{attrs:{href:"#_1、官网下载flink"}},[a._v("1、官网下载Flink")]),s("ul",[s("li",[s("a",{attrs:{href:"#官网地址"}},[a._v("官网地址")])]),s("li",[s("a",{attrs:{href:"#下载地址"}},[a._v("下载地址")])])])]),s("li",[s("a",{attrs:{href:"#_2、安装"}},[a._v("2、安装")])]),s("li",[s("a",{attrs:{href:"#_3、添加环境变量"}},[a._v("3、添加环境变量")])]),s("li",[s("a",{attrs:{href:"#_4、启动flink"}},[a._v("4、启动Flink")])]),s("li",[s("a",{attrs:{href:"#_5、运行示例-官方示例"}},[a._v("5、运行示例——官方示例")]),s("ul",[s("li",[s("a",{attrs:{href:"#_5-1、批处理运行wordcount"}},[a._v("5.1、批处理运行WordCount")])])])]),s("li",[s("a",{attrs:{href:"#参考文章"}},[a._v("参考文章")])])])]),s("p"),a._v(" "),s("h2",{attrs:{id:"_1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-概述"}},[a._v("#")]),a._v(" 1. 概述")]),a._v(" "),s("p",[a._v("Flink采用的稳定版本为flink-1.12.1。以往我们所熟知的Map Reduce，Storm，Spark等框架可能在某些场景下已经没法完全地满足用户的需求，或者是实现需求所付出的代价，无论是代码量和架构的复杂程度可能都没法满足预期的需求。新场景的出现催产出新的技术，Flink即为实时流提供了新的选择。Flink相对简单的编程模型加上其高吞吐、低延迟、高性能以及支持exactly-once语义的特性，让它在工业生产中较为出众。")]),a._v(" "),s("h2",{attrs:{id:"_2-flink-standalone-ha安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-flink-standalone-ha安装"}},[a._v("#")]),a._v(" 2. Flink Standalone HA安装")]),a._v(" "),s("h3",{attrs:{id:"_2-1-环境准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-环境准备"}},[a._v("#")]),a._v(" 2.1 环境准备")]),a._v(" "),s("p",[a._v("软件配置选择如下：")]),a._v(" "),s("ul",[s("li",[a._v("jdk：jdk-8u144-linux-x64.tar.gz")]),a._v(" "),s("li",[a._v("zookeeper：zookeeper-3.4.5.tar.gz")]),a._v(" "),s("li",[a._v("hadoop：hadoop-2.7.3.tar.gz")]),a._v(" "),s("li",[a._v("flink：flink-1.12.1-bin-scala_2.11.tgz")])]),a._v(" "),s("h3",{attrs:{id:"_2-2-安装规划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-安装规划"}},[a._v("#")]),a._v(" 2.2 安装规划")]),a._v(" "),s("p",[a._v("3台centos7机器如下：")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("ip")]),a._v(" "),s("th",[a._v("主机名")]),a._v(" "),s("th",[a._v("flink角色")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("192.168.1.105")]),a._v(" "),s("td",[a._v("node1")]),a._v(" "),s("td",[a._v("StandaloneSessionClusterEntrypoint、TaskManagerRunner")])]),a._v(" "),s("tr",[s("td",[a._v("192.168.1.106")]),a._v(" "),s("td",[a._v("node2")]),a._v(" "),s("td",[a._v("StandaloneSessionClusterEntrypoint、TaskManagerRunner")])]),a._v(" "),s("tr",[s("td",[a._v("192.168.1.107")]),a._v(" "),s("td",[a._v("node3")]),a._v(" "),s("td",[a._v("TaskManagerRunner")])])])]),a._v(" "),s("p",[a._v("StandaloneSessionClusterEntrypoint为jobmnager，taskManagerRunner为taskManager。")]),a._v(" "),s("p",[a._v("在Flink运行时涉及到的进程主要有以下两个：")]),a._v(" "),s("ul",[s("li",[a._v("JobManager：主要负责调度task，协调checkpoint已经错误恢复等。当客户端将打包好的任务提交到JobManager之后，JobManager就会根据注册的TaskManager资源信息将任务分配给有资源的TaskManager，然后启动运行任务。")]),a._v(" "),s("li",[a._v("TaskManager：执行数据流的task，一个task通过设置并行度，可能会有多个subtask。每个TaskManager都是作为一个独立的JVM进程运行的，他主要负责在独立的线程执行的operator。其中能执行多少个operator取决于每个taskManager指定的slots数量。Task slot是Flink中最小的资源单位。假如一个taskManager有3个slot，他就会给每个slot分配1/3的内存资源，目前slot不会对cpu进行隔离。同一个taskManager中的slot会共享网络资源和心跳信息。")])]),a._v(" "),s("h3",{attrs:{id:"_2-3-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-安装"}},[a._v("#")]),a._v(" 2.3 安装")]),a._v(" "),s("p",[a._v("首先选定一台机器节点，解压flink-1.12.1-bin-scala_2.11.tgz，并进入conf目录修改flink-conf.yaml和master文件，修改完毕之后把flink安装包往其他两台机器复制")]),a._v(" "),s("h4",{attrs:{id:"_2-3-1-配置flink-conf-yaml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-配置flink-conf-yaml"}},[a._v("#")]),a._v(" 2.3.1 配置flink-conf.yaml")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("jobmanager.rpc.address: node1\njobmanager.rpc.port: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6123")]),a._v("\njobmanager.memory.process.size: 1600m\ntaskmanager.memory.process.size: 1728m\ntaskmanager.numberOfTaskSlots: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\nparallelism.default: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\nhigh-availability: zookeeper\nhigh-availability.storageDir: hdfs://node/flink/ha/\nhigh-availability.zookeeper.quorum: node1:2181,node2:2181,node3:2181\nhigh-availability.zookeeper.path.root: /flink\nstate.backend: filesystem\nstate.checkpoints.dir: hdfs://node/flink/checkpoints\nstate.savepoints.dir: hdfs://node/flink/checkpoints\njobmanager.execution.failover-strategy: region\nio.tmp.dirs: /tmp/flink/tmp\nhistoryserver.web.address: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0\nhistoryserver.web.port: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8082")]),a._v("\nhistoryserver.archive.fs.dir: hdfs://node/flink/completed-jobs/\nhistoryserver.archive.fs.refresh-interval: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10000")]),a._v("\n")])])]),s("p",[a._v("注：")]),a._v(" "),s("p",[a._v("红色字体即为需要修改的内容，node1为每台节点的hostname，每台节点需要适应变动。")]),a._v(" "),s("h4",{attrs:{id:"_2-3-2-配置masters"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-配置masters"}},[a._v("#")]),a._v(" 2.3.2 配置masters")]),a._v(" "),s("p",[a._v("这里配置node1和node2为高可用节点")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node1 conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## vim masters ")]),a._v("\n\nnode1:8081\nnode2:8082\n")])])]),s("h4",{attrs:{id:"_2-3-3-把flink安装包往其余两台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-把flink安装包往其余两台"}},[a._v("#")]),a._v(" 2.3.3 把flink安装包往其余两台")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node1 app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## scp flink-1.12.1/ root@node2:/opt/app")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node1 app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## scp flink-1.12.1/ root@node2:/opt/app")]),a._v("\n")])])]),s("h4",{attrs:{id:"_2-3-4-启动集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-启动集群"}},[a._v("#")]),a._v(" 2.3.4 启动集群")]),a._v(" "),s("p",[a._v("启动顺序：先启动zk和hdfs，再启动flink")]),a._v(" "),s("p",[a._v("启动集群：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("start-cluster.sh\n")])])]),s("h4",{attrs:{id:"_2-3-5-查看flink-webui"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-5-查看flink-webui"}},[a._v("#")]),a._v(" 2.3.5 查看Flink webUI")]),a._v(" "),s("p",[a._v("在浏览器输入：http://node1:8081/或http://node1:8082/，即可看到flink任务执行情况")]),a._v(" "),s("h2",{attrs:{id:"_3-flink-on-yarn安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-flink-on-yarn安装"}},[a._v("#")]),a._v(" 3. Flink On Yarn安装")]),a._v(" "),s("h3",{attrs:{id:"_3-1-软件配置选择"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-软件配置选择"}},[a._v("#")]),a._v(" 3.1 软件配置选择")]),a._v(" "),s("p",[a._v("JDK:1.8 （jdk1.8.0_151）\nHadoop:2.7.6 (hadoop-2.7.6.tar.gz)\nHBase:2.1.2 (hbase-2.1.1-bin.tar.gz)")]),a._v(" "),s("p",[a._v("这里jdk、hadoop、zookeeper假定均已安装完毕。")]),a._v(" "),s("h3",{attrs:{id:"_3-2-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-安装"}},[a._v("#")]),a._v(" 3.2 安装")]),a._v(" "),s("h4",{attrs:{id:"_3-2-1-配置flink-conf-yaml文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-配置flink-conf-yaml文件"}},[a._v("#")]),a._v(" 3.2.1 配置flink-conf.yaml文件")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("high-availability: zookeeper\nhigh-availability.storageDir: hdfs://node/flink/ha/\nhigh-availability.zookeeper.quorum: node1:2181,node2:2181,node3:2181\nhigh-availability.zookeeper.path.root: /flink\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## high-availability.cluster-id: /cluster_one       on yarn不配置，配了任务会启动不来")]),a._v("\n")])])]),s("h4",{attrs:{id:"_3-2-2-配置flink-home和hadoop-classpath环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-配置flink-home和hadoop-classpath环境变量"}},[a._v("#")]),a._v(" 3.2.2 配置FLINK_HOME和HADOOP_CLASSPATH环境变量")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/profile 或者 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/bashrcexport "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("FLINK_HOME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/redpeak/app/flink-1.12.3\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$FLINK_HOME")]),a._v("/bin:"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("HADOOP_CLASSPATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("hadoop classpath"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n")])])]),s("p",[a._v("需要在每台flink节点配置FLINK_HOME和HADOOP_CLASSPATH环境变量")]),a._v(" "),s("h3",{attrs:{id:"_3-3-flink-on-yarn三种部署模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-flink-on-yarn三种部署模式"}},[a._v("#")]),a._v(" 3.3 flink on yarn三种部署模式")]),a._v(" "),s("h4",{attrs:{id:"_3-3-1-session模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-session模式"}},[a._v("#")]),a._v(" 3.3.1 Session模式")]),a._v(" "),s("p",[a._v("Session模式是预分配资源的，也就是提前根据指定的资源参数初始化一个Flink集群，并常驻在YARN系统中，拥有固定数量的JobManager和TaskManager（注意JobManager只有一个）。提交到这个集群的作业可以直接运行，免去每次分配资源的overhead。但是Session的资源总量有限，多个作业之间又不是隔离的，故可能会造成资源的争用；如果有一个TaskManager宕机，它上面承载着的所有作业也都会失败。另外，启动的作业越多，JobManager的负载也就越大。所以，Session模式一般用来部署那些对延迟非常敏感但运行时长较短的作业。")]),a._v(" "),s("p",[a._v("提交任务命令：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("./bin/flink run -t yarn-session "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  -Dyarn.application.id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("application_XXXX_YY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  ./examples/streaming/TopSpeedWindowing.jar\n")])])]),s("p",[a._v("再次连接YARN session命令：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("./bin/yarn-session.sh -id application_XXXX_YY\n")])])]),s("h4",{attrs:{id:"_3-3-2-per-job模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-per-job模式"}},[a._v("#")]),a._v(" 3.3.2 Per_Job模式")]),a._v(" "),s("p",[a._v("顾名思义，在Per-Job模式下，每个提交到YARN上的作业会各自形成单独的Flink集群，拥有专属的JobManager和TaskManager。可见，以Per-Job模式提交作业的启动延迟可能会较高，但是作业之间的资源完全隔离，一个作业的TaskManager失败不会影响其他作业的运行，JobManager的负载也是分散开的，不存在单点问题。当作业运行完成，与它关联的集群也就被销毁，资源被释放。所以，Per-Job模式一般用来部署那些长时间运行的作业。")]),a._v(" "),s("p",[a._v("提交任务命令：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("./bin/flink run -t yarn-per-job --detached ./examples/streaming/TopSpeedWindowing.jar\n")])])]),s("p",[a._v("注：--detached，以分离模式运行作业，detached模式在提交完任务后就退出client")]),a._v(" "),s("p",[a._v("任务列表和取消任务命令：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## List running job on the cluster")]),a._v("\n./bin/flink list -t yarn-per-job -Dyarn.application.id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("application_XXXX_YY\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## Cancel running job")]),a._v("\n./bin/flink cancel -t yarn-per-job -Dyarn.application.id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("application_XXXX_YY "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("jobId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("h4",{attrs:{id:"_3-3-3-session与per-job模式带来的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-session与per-job模式带来的问题"}},[a._v("#")]),a._v(" 3.3.3 Session与Per_Job模式带来的问题")]),a._v(" "),s("p",[a._v("Session模式和Per_Job模式可以用如下简图表示，其中红色、蓝色和绿色的图代表不同的作业。")]),a._v(" "),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/dp/flink/install1-1.png"),alt:"wxmp"}}),a._v(" "),s("p",[a._v("Deployer表示向YARN集群发起部署请求的节点，一般来讲在生产环境中，也总有这样一个节点作为所有作业的提交入口（即客户端）。在main()方法开始执行直到env.execute()方法之前，客户端也需要做一些工作，即：")]),a._v(" "),s("ul",[s("li",[a._v("获取作业所需的依赖项；")]),a._v(" "),s("li",[a._v("通过执行环境分析并取得逻辑计划，即StreamGraph->JobGraph；")]),a._v(" "),s("li",[a._v("将依赖项和JobGraph上传到集群中。")])]),a._v(" "),s("p",[a._v("只有在这些都完成之后，才会通过env.execute()方法触发Flink运行时真正地开始执行作业。如果所有用户都在Deployer上提交作业，较大的依赖会消耗更多的带宽，而较复杂的作业逻辑翻译成JobGraph也需要吃掉更多的CPU和内存，客户端的资源反而会成为瓶颈。不管Session还是Per-Job模式都存在此问题。为了解决，社区在传统部署模式的基础上实现了Application模式。")]),a._v(" "),s("h4",{attrs:{id:"_3-3-4-application模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-4-application模式"}},[a._v("#")]),a._v(" 3.3.4 Application模式")]),a._v(" "),s("p",[a._v("此模式的作业提交框图如下：")]),a._v(" "),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/dp/flink/install1-2.png"),alt:"wxmp"}}),a._v(" "),s("p",[a._v("可见，原本需要客户端做的三件事被转移到了JobManager里，也就是说main()方法在集群中执行（入口点位于ApplicationClusterEntryPoint），Deployer只需要负责发起部署请求了。另外如果一个main()方法中有多个env.execute/executeAsync()调用，在Application模式下，这些作业会被视为同一个应用，在同一个集群中执行（如果在Per-Job模式下，就会启动多个集群）。可见，Application模式本质上是Session和Per-Job模式的折衷。")]),a._v(" "),s("p",[a._v("用Application模式提交作业的示例命令如下：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("bin/flink run-application -t yarn-application "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-Djobmanager.memory.process.size"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("2048m "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-Dtaskmanager.memory.process.size"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("4096m "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-Dtaskmanager.numberOfTaskSlots"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-Dparallelism.default"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-Dyarn.application.name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"MyFlinkApp"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n/path/to/my/flink-app/MyFlinkApp.jar\n")])])]),s("p",[a._v("注：-t参数用来指定部署目标，目前支持YARN（yarn-application）和K8S（kubernetes-application）。-D参数则用来指定与作业相关的各项参数。")]),a._v(" "),s("p",[a._v("查看集群的任务Job列表以及取消任务命令，如下：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## List running job on the cluster")]),a._v("\n./bin/flink list -t yarn-application -Dyarn.application.id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("application_XXXX_YY\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## Cancel running job")]),a._v("\n./bin/flink cancel -t yarn-application -Dyarn.application.id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("application_XXXX_YY "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("jobId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("那么如何解决传输依赖项造成的带宽占用问题呢？Flink作业必须的依赖是发行版flink-dist.jar，还有扩展卡（位于"),s("code",[a._v("$FLINK_HOME/lib")]),a._v("）和插件库（位于"),s("code",[a._v("$FLINK_HOME/plugin")]),a._v("），我们将它们预先上传到像HDFS这样的共享存储，再通过yarn.provided.lib.dirs参数指定存储的路径即可。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("-Dyarn.provided.lib.dirs"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hdfs://myhdfs/flink-common-deps/lib;hdfs://myhdfs/flink-common-deps/plugins"')]),a._v("\n")])])]),s("p",[a._v("这样所有作业就不必各自上传依赖，可以直接从HDFS拉取，并且YARN NodeManager也会缓存这些依赖，进一步加快作业的提交过程。同理，包含Flink作业的用户JAR包也可以上传到HDFS，并指定远程路径进行提交。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("./bin/flink run-application -t yarn-application -Dyarn.provided.lib.dirs"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hdfs://myhdfs/my-remote-flink-dist-dir"')]),a._v(" hdfs://myhdfs/jars/my-application.jar\n")])])]),s("h2",{attrs:{id:"_4-总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-总结"}},[a._v("#")]),a._v(" 4. 总结")]),a._v(" "),s("p",[a._v("【参考资料】")]),a._v(" "),s("p",[a._v("https://www.sohu.com/a/406387061_100109711")]),a._v(" "),s("p",[a._v("https://zhuanlan.zhihu.com/p/354511839")]),a._v(" "),s("p",[a._v("https://www.jianshu.com/p/90d9f1f24937")]),a._v(" "),s("h2",{attrs:{id:"【-】"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#【-】"}},[a._v("#")]),a._v(" 【----------------------------】")]),a._v(" "),s("h2",{attrs:{id:"flink安装及使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#flink安装及使用"}},[a._v("#")]),a._v(" Flink安装及使用")]),a._v(" "),s("h2",{attrs:{id:"_1、官网下载flink"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、官网下载flink"}},[a._v("#")]),a._v(" 1、官网下载Flink")]),a._v(" "),s("h3",{attrs:{id:"官网地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#官网地址"}},[a._v("#")]),a._v(" 官网地址")]),a._v(" "),s("p",[s("code",[a._v("$ https://flink.apache.org/downloads.html")])]),a._v(" "),s("h3",{attrs:{id:"下载地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载地址"}},[a._v("#")]),a._v(" 下载地址")]),a._v(" "),s("p",[s("code",[a._v("$ wget http://mirror.bit.edu.cn/apache/flink/flink-1.9.2/flink-1.9.2-bin-scala_2.11.tgz")]),a._v("\n文件保存在/root/soft目录下")]),a._v(" "),s("h2",{attrs:{id:"_2、安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装"}},[a._v("#")]),a._v(" 2、安装")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /root/soft\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" -zxf flink-1.9.2-bin-scala_2.11.tgz\n")])])]),s("h2",{attrs:{id:"_3、添加环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、添加环境变量"}},[a._v("#")]),a._v(" 3、添加环境变量")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/profile\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("FLNK_HOME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/root/soft/flink-1.9.2\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$FLINK_HOME")]),a._v("/bin:"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),a._v("\n")])])]),s("h2",{attrs:{id:"_4、启动flink"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、启动flink"}},[a._v("#")]),a._v(" 4、启动Flink")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ /root/soft/flink-1.9.2/bin\n$ ./start-cluster.sh\n$ jps\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("19489")]),a._v(" jar\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("24595")]),a._v(" StandaloneSessionClusterEntrypoint\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("25189")]),a._v(" Jps\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("25039")]),a._v(" TaskManagerRunner\n")])])]),s("p",[a._v("可以通过观察logs目录下的日志来检测系统是否正在运行了")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tail")]),a._v(" log/flink-*-standalonesession-*.log\n")])])]),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/dp/flink/install2-1.png"),alt:"wxmp"}}),a._v(" "),s("p",[a._v("JobManager同时会在8081端口上启动一个web前端，通过"),s("a",{attrs:{href:"http://localhost:8081/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://localhost:8081"),s("OutboundLink")],1),a._v("来访问")]),a._v(" "),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/dp/flink/install2-2.png"),alt:"wxmp"}}),a._v(" "),s("p",[a._v("可以发现flink已经正常启动")]),a._v(" "),s("h2",{attrs:{id:"_5、运行示例-官方示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、运行示例-官方示例"}},[a._v("#")]),a._v(" 5、运行示例——官方示例")]),a._v(" "),s("p",[a._v("使用Maven创建Flink项目，在pom.xml中添加以下依赖：")]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.apache.flink"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("flink-java"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("1.9.2"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.apache.flink"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("flink-streaming-java_2.11"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("1.9.2"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.apache.flink"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("flink-clients_2.11"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("1.9.2"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),s("h3",{attrs:{id:"_5-1、批处理运行wordcount"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1、批处理运行wordcount"}},[a._v("#")]),a._v(" 5.1、批处理运行WordCount")]),a._v(" "),s("p",[a._v("可以直接在/root/soft/flink-1.9.2/examples/batch中运行WordCount程序，并且这里还有更多示例：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /root/soft/flink-1.9.2/examples/batch\n$ /root/soft/flink-1.9.2/bin/flink run WordCount.jar\n")])])]),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/dp/flink/install2-3.png"),alt:"wxmp"}}),a._v(" "),s("h2",{attrs:{id:"参考文章"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[a._v("#")]),a._v(" 参考文章")]),a._v(" "),s("ul",[s("li",[a._v("https://www.cnblogs.com/swordfall/p/14462486.html")]),a._v(" "),s("li",[a._v("https://www.cnblogs.com/linjiqin/p/12425584.html")])])])}),[],!1,null,null,null);t.default=e.exports}}]);