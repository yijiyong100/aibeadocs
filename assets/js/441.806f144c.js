(window.webpackJsonp=window.webpackJsonp||[]).push([[441],{956:function(a,t,s){"use strict";s.r(t);var n=s(53),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("本文主要是介绍 Yarn-精华知识总结 。")])]),a._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#yarn"}},[a._v("YARN")])]),s("li",[s("a",{attrs:{href:"#_1-yarn的基本概念"}},[a._v("1.yarn的基本概念")]),s("ul",[s("li",[s("a",{attrs:{href:"#_1、resource-manager"}},[a._v("1、Resource Manager")])]),s("li",[s("a",{attrs:{href:"#_2、node-manager"}},[a._v("2、Node Manager")])])])]),s("li",[s("a",{attrs:{href:"#_2-yarn的资源管理"}},[a._v("2.YARN的资源管理")]),s("ul",[s("li",[s("a",{attrs:{href:"#yarn的内存管理"}},[a._v("Yarn的内存管理：")])]),s("li",[s("a",{attrs:{href:"#yarn-cpu管理"}},[a._v("Yarn cpu管理：")])])])]),s("li",[s("a",{attrs:{href:"#_3-安装yarn集群"}},[a._v("3.安装yarn集群")]),s("ul",[s("li",[s("a",{attrs:{href:"#_1-修改配置文件"}},[a._v("1 修改配置文件：")])]),s("li",[s("a",{attrs:{href:"#_2、scp这个yarn-site-xml-mapred-site-xml到其他节点"}},[a._v("2、scp这个yarn-site.xml,mapred-site.xml到其他节点")])]),s("li",[s("a",{attrs:{href:"#_3、启动yarn集群"}},[a._v("3、启动yarn集群：")])]),s("li",[s("a",{attrs:{href:"#_4、脚本批量启动"}},[a._v("4、脚本批量启动：")])])])]),s("li",[s("a",{attrs:{href:"#_4-运行mapreduce程序"}},[a._v("4.运行mapreduce程序")])]),s("li",[s("a",{attrs:{href:"#_5-mapreduce任务运行方式总结"}},[a._v("5.mapreduce任务运行方式总结：")]),s("ul",[s("li",[s("a",{attrs:{href:"#_5-1运行在yarn平台"}},[a._v("5.1运行在yarn平台")])])])]),s("li",[s("a",{attrs:{href:"#参考文章"}},[a._v("参考文章")])])])]),s("p"),a._v(" "),s("h2",{attrs:{id:"yarn"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yarn"}},[a._v("#")]),a._v(" YARN")]),a._v(" "),s("p",[a._v("mapreduce程序应该是在很多机器上并行启动，而且先执行map task，当众多的maptask都处理完自己的数据后，还需要启动众多的reduce task，这个过程如果用用户自己手动调度不太现实，需要一个自动化的调度平台——hadoop中就为运行mapreduce之类的分布式运算程序开发了一个自动化调度平台——YARN")]),a._v(" "),s("h2",{attrs:{id:"_1-yarn的基本概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-yarn的基本概念"}},[a._v("#")]),a._v(" 1.yarn的基本概念")]),a._v(" "),s("p",[a._v("yarn是一个分布式程序的运行调度平台")]),a._v(" "),s("p",[a._v("yarn中有两大核心角色：")]),a._v(" "),s("h3",{attrs:{id:"_1、resource-manager"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、resource-manager"}},[a._v("#")]),a._v(" 1、Resource Manager")]),a._v(" "),s("p",[a._v("接受用户提交的分布式计算程序，并为其划分资源")]),a._v(" "),s("p",[a._v("管理、监控各个Node Manager上的资源情况，以便于均衡负载")]),a._v(" "),s("p",[a._v("ResourceManager（RM）：")]),a._v(" "),s("p",[a._v("RM是一个全局的资源管理器，负责整个系统的资源管理和分配。它主要由两个组件构成：调度器（Scheduler）和应用程序管理器（Applications Manager，ASM）。")]),a._v(" "),s("p",[a._v("调度器 调度器根据容量、队列等限制条件（如每个队列分配一定的资源，最多执行一定数量的作业等），将系统中的资源分配给各个正在运行的应用程序。需要注意的是，该调度器是一个“纯调度器”，它不再从事任何与具体应用程序相关的工作，比如不负责监控或者跟踪应用的执行状态等，也不负责重新启动因应用执行失败或者硬件故障而产生的失败任务，这些均交由应用程序相关的ApplicationMaster完成。调度器仅根据各个应用程序的资源需求进行资源分配，而资源分配单位用一个抽象概念“资源容器”（Resource Container，简称Container）表示，Container是一个动态资源分配单位，它将内存、CPU、磁盘、网络等资源封装在一起，从而限定每个任务使用的资源量。此外，该调度器是一个可插拔的组件，用户可根据自己的需要设计新的调度器，YARN提供了多种直接可用的调度器，比如Fair Scheduler和Capacity Scheduler等。")]),a._v(" "),s("p",[a._v("应用程序管理器应用程序管理器负责管理整个系统中所有应用程序，包括应用程序提交、与调度器协商资源以启动ApplicationMaster、监控ApplicationMaster运行状态并在失败时重新启动它等。")]),a._v(" "),s("p",[a._v("ApplicationMaster（AM）：用户提交的每个应用程序均包含一个AM，主要功能包括：")]),a._v(" "),s("p",[a._v("与RM调度器协商以获取资源（用Container表示）；")]),a._v(" "),s("p",[a._v("将得到的任务进一步分配给内部的任务(资源的二次分配)；")]),a._v(" "),s("p",[a._v("与NM通信以启动/停止任务；")]),a._v(" "),s("p",[a._v("监控所有任务运行状态，并在任务运行失败时重新为任务申请资源以重启任务。")]),a._v(" "),s("p",[a._v("当前YARN自带了两个AM实现，一个是用于演示AM编写方法的实例程序distributedshell，它可以申请一定数目的Container以并行运行一个Shell命令或者Shell脚本；另一个是运行MapReduce应用程序的AM—MRAppMaster。")]),a._v(" "),s("p",[a._v("注：RM只负责监控AM，在AM运行失败时候启动它，RM并不负责AM内部任务的容错，这由AM来完成。")]),a._v(" "),s("h3",{attrs:{id:"_2、node-manager"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、node-manager"}},[a._v("#")]),a._v(" 2、Node Manager")]),a._v(" "),s("p",[a._v("管理它所在机器的运算资源（cpu + 内存）")]),a._v(" "),s("p",[a._v("负责接受Resource Manager分配的任务，创建容器、回收资源")]),a._v(" "),s("p",[a._v("NodeManager（NM）：NM是每个节点上的资源和任务管理器，一方面，它会定时地向RM汇报本节点上的资源使用情况和各个Container的运行状态；另一方面，它接收并处理来自AM的Container启动/停止等各种请求。")]),a._v(" "),s("p",[a._v("Container：Container是YARN中的资源抽象，它封装了某个节点上的多维度资源，如内存、CPU、磁盘、网络等，当AM向RM申请资源时，RM为AM返回的资源便是用Container表示。YARN会为每个任务分配一个Container，且该任务只能使用该Container中描述的资源。")]),a._v(" "),s("p",[a._v("注：1. Container不同于MRv1中的slot，它是一个动态资源划分单位，是根据应用程序的需求动态生成的。")]),a._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[a._v("现在YARN仅支持CPU和内存两种资源，且使用了轻量级资源隔离机制Cgroups进行资源隔离。")])]),a._v(" "),s("p",[a._v("YARN的资源管理和执行框架都是按主/从范例实现的——Slave ---节点管理器（NM）运行、监控每个节点，并向集群的Master---资源管理器(RM)报告资源的可用性状态，资源管理器最终为系统里所有应用分配资源。")]),a._v(" "),s("p",[a._v("特定应用的执行由ApplicationMaster控制，ApplicationMaster负责将一个应用分割成多个任务，并和资源管理器协调执行所需的资源，资源一旦分配好，ApplicationMaster就和节点管理器一起安排、执行、监控独立的应用任务。")]),a._v(" "),s("p",[a._v("需要说明的是， YARN不同服务组件的通信方式采用了事件驱动的异步并发机制，这样可以简化系统的设计。")]),a._v(" "),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/dp/yarn/sum-1.png"),alt:"wxmp"}}),a._v(" "),s("p",[s("a",{attrs:{href:"https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/YARN.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/YARN.html"),s("OutboundLink")],1)]),a._v(" "),s("h2",{attrs:{id:"_2-yarn的资源管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-yarn的资源管理"}},[a._v("#")]),a._v(" 2.YARN的资源管理")]),a._v(" "),s("p",[a._v("1、资源调度和隔离是yarn作为一个资源管理系统，最重要且最基础的两个功能。资源调度由resourcemanager完成，而资源隔离由各个nodemanager实现。")]),a._v(" "),s("p",[a._v("2、Resourcemanager将某个nodemanager上资源分配给任务（这就是所谓的“资源调度”）后，nodemanager需按照要求为任务提供相应的资源，甚至保证这些资源应具有独占性，为任务运行提供基础和保证，这就是所谓的资源隔离。")]),a._v(" "),s("p",[a._v("3、当谈及到资源时，我们通常指内存、cpu、io三种资源。Hadoop yarn目前为止仅支持cpu和内存两种资源管理和调度。")]),a._v(" "),s("p",[a._v("4、内存资源多少决定任务的生死，如果内存不够，任务可能运行失败；相比之下，cpu资源则不同，它只会决定任务的快慢，不会对任务的生死产生影响。")]),a._v(" "),s("h3",{attrs:{id:"yarn的内存管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yarn的内存管理"}},[a._v("#")]),a._v(" Yarn的内存管理：")]),a._v(" "),s("p",[a._v("yarn允许用户配置每个节点上可用的物理内存资源，注意，这里是“可用的”，因为一个节点上内存会被若干个服务贡享，比如一部分给了yarn，一部分给了hdfs，一部分给了hbase等，yarn配置的只是自己可用的，配置参数如下：")]),a._v(" "),s("p",[a._v("yarn.nodemanager.resource.memory-mb")]),a._v(" "),s("p",[a._v("表示该节点上yarn可以使用的物理内存总量，默认是8192m，注意，如果你的节点内存资源不够8g，则需要调减这个值，yarn不会智能的探测节点物理内存总量。")]),a._v(" "),s("p",[a._v("yarn.nodemanager.vmem-pmem-ratio")]),a._v(" "),s("p",[a._v("任务使用1m物理内存最多可以使用虚拟内存量，默认是2.1")]),a._v(" "),s("p",[a._v("yarn.nodemanager.pmem-check-enabled")]),a._v(" "),s("p",[a._v("是否启用一个线程检查每个任务证使用的物理内存量，如果任务超出了分配值，则直接将其kill，默认是true。")]),a._v(" "),s("p",[a._v("yarn.nodemanager.vmem-check-enabled")]),a._v(" "),s("p",[a._v("是否启用一个线程检查每个任务证使用的虚拟内存量，如果任务超出了分配值，则直接将其kill，默认是true。")]),a._v(" "),s("p",[a._v("yarn.scheduler.minimum-allocation-mb")]),a._v(" "),s("p",[a._v("单个任务可以使用最小物理内存量，默认1024m，如果一个任务申请物理内存量少于该值，则该对应值改为这个数。")]),a._v(" "),s("p",[a._v("yarn.scheduler.maximum-allocation-mb")]),a._v(" "),s("p",[a._v("单个任务可以申请的最多的内存量，默认8192m")]),a._v(" "),s("h3",{attrs:{id:"yarn-cpu管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yarn-cpu管理"}},[a._v("#")]),a._v(" Yarn cpu管理：")]),a._v(" "),s("p",[a._v("目前cpu被划分为虚拟cpu，这里的虚拟cpu是yarn自己引入的概念，初衷是考虑到不同节点cpu性能可能不同，每个cpu具有计算能力也是不一样的，比如，某个物理cpu计算能力可能是另外一个物理cpu的2倍，这时候，你可以通过为第一个物理cpu多配置几个虚拟cpu弥补这种差异。用户提交作业时，可以指定每个任务需要的虚拟cpu个数。在yarn中，cpu相关配置参数如下：")]),a._v(" "),s("p",[a._v("yarn.nodemanager.resource.cpu-vcores")]),a._v(" "),s("p",[a._v("表示该节点上yarn可使用的虚拟cpu个数，默认是8个，注意，目前推荐将该值为与物理cpu核数相同。如果你的节点cpu合数不够8个，则需要调减小这个值，而yarn不会智能的探测节点物理cpu总数。")]),a._v(" "),s("p",[a._v("yarn.scheduler.minimum-allocation-vcores")]),a._v(" "),s("p",[a._v("单个任务可申请最小cpu个数，默认1，如果一个任务申请的cpu个数少于该数，则该对应值被修改为这个数")]),a._v(" "),s("p",[a._v("yarn.scheduler.maximum-allocation-vcores")]),a._v(" "),s("p",[a._v("单个任务可以申请最多虚拟cpu个数，默认是32.")]),a._v(" "),s("h2",{attrs:{id:"_3-安装yarn集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装yarn集群"}},[a._v("#")]),a._v(" 3.安装yarn集群")]),a._v(" "),s("p",[a._v("yarn集群中有两个角色：")]),a._v(" "),s("p",[a._v("主节点：Resource Manager  1台")]),a._v(" "),s("p",[a._v("从节点：Node Manager  N台")]),a._v(" "),s("p",[a._v("Node Manager在物理上应该跟data node部署在一起，为什么？")]),a._v(" "),s("p",[a._v("hdfs上的数据存储在datanode节点上，而nodemanager，要进行运算，就需要读取datanode上的数据块，如果部署在datanode节点上，可用直接本地读取，不需要再跨网络传输，速度更快，效率更高。")]),a._v(" "),s("p",[a._v("Resource Manager在物理上应该独立部署在一台专门的机器上（可用部署在任意的机器）")]),a._v(" "),s("h3",{attrs:{id:"_1-修改配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-修改配置文件"}},[a._v("#")]),a._v(" 1 修改配置文件：")]),a._v(" "),s("p",[a._v("yarn-site.xml")]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("yarn.resourcemanager.hostname"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("hdp-01"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n# nodemanager给 mapreduce程序提供辅助功能，辅助shuffle\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("yarn.nodemanager.aux-services"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("mapreduce_shuffle"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" yarn.nodemanager.resource.memory-mb"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("2048"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" yarn.nodemanager.resource.cpu-vcores"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("2"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),s("p",[a._v("mapred-site.xml")]),a._v(" "),s("p",[a._v("添加mapreduce默认使用yarn来调度。")]),a._v(" "),s("p",[a._v("mapreduce.framework.name=yarn|local  默认是local")]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" mapreduce.framework.name"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("yarn"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),s("h4",{attrs:{id:"yarn集群配置参数说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yarn集群配置参数说明"}},[a._v("#")]),a._v(" yarn集群配置参数说明：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("yarn.nodemanager.resource.memory-mb  默认是8G\n\nyarn.nodemanager.resource.cpu-vcores  默认是8\n\n注意：如果内存不足2G,至少配置2G,即值为2048\n\n如果内存配置低于2G,可能会导致mapreduce任务不能正常运行。\n\n报错如下：\n\n \n\n原因：\n\n在mapred-default.xml中，有默认参数配置了（MR AppMaster）内存为1.5G。\n\n每一个mapreduce 会启动一个MR AppMaster进行。\n\n \n")])])]),s("h3",{attrs:{id:"_2、scp这个yarn-site-xml-mapred-site-xml到其他节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、scp这个yarn-site-xml-mapred-site-xml到其他节点"}},[a._v("#")]),a._v(" 2、scp这个yarn-site.xml,mapred-site.xml到其他节点")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v("  /root/apps/Hadoop/etc/Hadoop/\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[a._v("i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("scp")]),a._v(" yarn-site.xml hdp-0"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$i")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[a._v("i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("scp")]),a._v(" mapred-site.xml hdp-0"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$i")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n")])])]),s("p",[a._v("yarn为每一个容器分配内存和核数：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("yarn为每一个container分配的最小的内存：1024\n\nyarn.scheduler.minimum-allocation-mb  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),a._v("\n\n最大可分配的内存为8G:\n\nyarn.scheduler.maximum-allocation-mb  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8192")]),a._v("\n\n最小的cores： "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("个  默认的就是一个\n\nyarn.scheduler.minimum-allocation-vcores "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" \n\n最多可分配的cores：32个\n\nyarn.scheduler.maximum-allocation-vcores "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("32")]),a._v("\n\n")])])]),s("h3",{attrs:{id:"_3、启动yarn集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、启动yarn集群"}},[a._v("#")]),a._v(" 3、启动yarn集群：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("\n主节点："),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# yarn-daemon.sh start resourcemanager")]),a._v("\n\n从节点："),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# yarn-daemon.sh start nodemanager")]),a._v("\n")])])]),s("h3",{attrs:{id:"_4、脚本批量启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、脚本批量启动"}},[a._v("#")]),a._v(" 4、脚本批量启动：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("\n在hdp-01上，修改hadoop的slaves文件，列入要启动nodemanager的机器\n\n然后将hdp-01到所有机器的免密登陆配置好\n\n启动yarn集群：（注：该命令应该在resourcemanager所在的机器上执行）\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# start-yarn.sh")]),a._v("\n\n停止："),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# stop-yarn.sh")]),a._v("\n\n验证：用jps检查yarn的进程，用web浏览器查看yarn的web控制台\n\n启动完成后，可以在windows上用浏览器访问resourcemanager的web端口：\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("http://hdp-01:8088"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("http://hdp-01:8088/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n看resource mananger是否认出了所有的node manager节点\n\n")])])]),s("h2",{attrs:{id:"_4-运行mapreduce程序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-运行mapreduce程序"}},[a._v("#")]),a._v(" 4.运行mapreduce程序")]),a._v(" "),s("p",[a._v("定义一个主类，用来描述job并提交job")]),a._v(" "),s("p",[a._v("提交job到yarn的客户端类（模板代码）：")]),a._v(" "),s("p",[a._v("描述你的mapreduce程序运行时所需要的一些信息(比如用哪个mapper、reducer、map和reduce输出的kv类型、jar包所在路径、reduce task的数量、输入输出数据的路径)")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n\n * 本类其实跟你的wordcount mapreduce程序关系不大\n\n * 它只是用来描述你的mapreduce程序相关信息，并将mapreduce程序所在的jar包提交给yarn\n\n */")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JobSubmitter")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throws")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Exception")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 描述job信息")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Configuration")]),a._v(" conf "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nconf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mapreduce.framework.name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"yarn"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nconf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"yarn.resourcemanager.hostname"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hdp-01"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n \n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Job")]),a._v(" job "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Job")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getInstance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 指定mapreduce程序的jar包路径，通过类加载机制动态获取")]),a._v("\n\njob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setJarByClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JobSubmitter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n \n\njob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setMapperClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WordcountMapper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\njob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setReducerClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WordcountReducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 指定map输出的keyvalue类型")]),a._v("\n\njob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setMapOutputKeyClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\njob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setMapOutputValueClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("IntWritable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 指定最终输出的结果的keyvalue类型")]),a._v("\n\njob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setOutputKeyClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\njob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setOutputValueClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("IntWritable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 指定job所要读取的数据源目录")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FileInputFormat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setInputPaths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("job"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/wordcount/input"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 指定job输出结果的目录")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FileOutputFormat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setOutputPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("job"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/wordcount/output"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 指定reduce task的数量")]),a._v("\n\njob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setNumReduceTasks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 提交job给yarn")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//job.submit();")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" job"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("waitForCompletion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("exit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("res"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("注意：FileInputFormat和FileOutputFormat导的包是：")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("hadoop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mapreduce"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lib"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("input"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FileInputFormat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("hadoop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mapreduce"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lib"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("output"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FileOutputFormat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("hadoop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("io"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("ol",[s("li",[a._v("将工程整体打成一个jar包并上传到linux机器上")])]),a._v(" "),s("p",[a._v("这里打普通的jar包即可，不需要打成可执行的jar包。")]),a._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[a._v("准备好要处理的数据文件放到hdfs的指定目录中")])]),a._v(" "),s("li",[s("p",[a._v("用命令启动jar包中的Jobsubmitter，让它去提交jar包给yarn来运行其中的mapreduce程序  ：")])])]),a._v(" "),s("p",[a._v("hadoop jar wc.jar cn.edu360.mr.wordcount.JobSubmitter .....")]),a._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[a._v("去hdfs的输出目录中查看结果")])]),a._v(" "),s("p",[a._v("运行流程分析：")]),a._v(" "),s("p",[a._v("启动一个mapreduce任务的时候，通过jps可以看见：")]),a._v(" "),s("p",[a._v("提交任务的进程：")]),a._v(" "),s("p",[a._v("每一个mapreduce任务，都会有一个MRAppMaster的进程，该进程负责启动maptask和reducetask,")]),a._v(" "),s("p",[a._v("maptask和reducetask的进程名称叫做YarnChild")]),a._v(" "),s("h2",{attrs:{id:"_5-mapreduce任务运行方式总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-mapreduce任务运行方式总结"}},[a._v("#")]),a._v(" 5.mapreduce任务运行方式总结：")]),a._v(" "),s("h3",{attrs:{id:"_5-1运行在yarn平台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1运行在yarn平台"}},[a._v("#")]),a._v(" 5.1运行在yarn平台")]),a._v(" "),s("h4",{attrs:{id:"_5-1-1linux平台提交mapreduce任务到yarn上"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1linux平台提交mapreduce任务到yarn上"}},[a._v("#")]),a._v(" 5.1.1linux平台提交mapreduce任务到yarn上")]),a._v(" "),s("p",[a._v("所需参数：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("Mapred-site.xml\n\nmapreduce.framework.name   "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v("\n\ncore-site.xml\n\nfs.defaultFS   hdfs://hdp-01:9000\n\nyarn-site.xml\n\nyarn.resourcemanager.hostname   hdp-01\n\n \n")])])]),s("h4",{attrs:{id:"_5-1-2windows平台提交mapreduce任务到yarn"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2windows平台提交mapreduce任务到yarn"}},[a._v("#")]),a._v(" 5.1.2windows平台提交mapreduce任务到yarn")]),a._v(" "),s("p",[a._v("所需参数：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("\n\n// 基本的参数配置\n\nconf.set"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"fs.defaultFS"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hdfs://hdp-01:9000"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nconf.set"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"yarn.resourcemanager.hostname"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hdp-01"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nconf.set"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mapreduce.framework.name"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"yarn"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n// 配置跨平台执行的参数\n\nconf.set"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mapreduce.app-submission.cross-platform"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"true"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n// 伪装root用户\n\nSystem.setProperty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"HADOOP_USER_NAME"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"root"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n需要指定jar包路径：\n\n// 需要设置jar包的路径\n\njob.setJar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"d:/wc.jar"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nwindows平台hadoop环境变量：\n\n需要指定本地的hadoop的环境变量，（windows版本的hadoop安装包）\n\n")])])]),s("h4",{attrs:{id:"_5-2本地运行-windows-linux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2本地运行-windows-linux"}},[a._v("#")]),a._v(" 5.2本地运行（windows/linux）")]),a._v(" "),s("p",[a._v("可不配置任何参数，使用的是默认的参数")]),a._v(" "),s("p",[a._v("mapreduce.framework.name的默认值是local")]),a._v(" "),s("p",[a._v("windows本地运行")]),a._v(" "),s("p",[a._v("windows平台上执行本地的mapreduce任务，需要指定windows平台的输入输出路径：")]),a._v(" "),s("p",[a._v("// 设置输入路径 输出路径F")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("ileInputFormat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("*setInputPaths"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("job"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"f:/mrdata/wordcount/input/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FileOutputFormat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("*setOutputPath"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("job"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"f:/mrdata/wordcount/output/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h2",{attrs:{id:"参考文章"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[a._v("#")]),a._v(" 参考文章")]),a._v(" "),s("ul",[s("li",[a._v("https://www.cnblogs.com/lq0310/p/9839178.html")])])])}),[],!1,null,null,null);t.default=e.exports}}]);