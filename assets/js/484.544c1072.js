(window.webpackJsonp=window.webpackJsonp||[]).push([[484],{999:function(t,s,a){"use strict";a.r(s);var n=a(53),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("本文主要是介绍 Hive-HiveSQL执行计划 。")])]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#hive执行计划"}},[t._v("Hive执行计划")]),a("ul",[a("li",[a("a",{attrs:{href:"#查看sql的执行计划"}},[t._v("查看SQL的执行计划")])]),a("li",[a("a",{attrs:{href:"#_1-explain-的用法"}},[t._v("1.  explain 的用法")])]),a("li",[a("a",{attrs:{href:"#_2-explain-的使用场景"}},[t._v("2. explain 的使用场景")])]),a("li",[a("a",{attrs:{href:"#_2-explain-dependency的用法"}},[t._v("2. explain dependency的用法")])]),a("li",[a("a",{attrs:{href:"#_3-explain-authorization-的用法"}},[t._v("3. explain authorization 的用法")])]),a("li",[a("a",{attrs:{href:"#最后"}},[t._v("最后")])])])]),a("li",[a("a",{attrs:{href:"#参考文章"}},[t._v("参考文章")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"hive执行计划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hive执行计划"}},[t._v("#")]),t._v(" Hive执行计划")]),t._v(" "),a("p",[t._v("Hive SQL的执行计划描述SQL实际执行的整体轮廓，通过执行计划能了解SQL程序在转换成相应计算引擎的执行逻辑，掌握了执行逻辑也就能更好地把握程序出现的瓶颈点，从而能够实现更有针对性的优化。此外还能帮助开发者识别看似等价的SQL其实是不等价的，看似不等价的SQL其实是等价的SQL。"),a("strong",[t._v("可以说执行计划是打开SQL优化大门的一把钥匙")]),t._v("。")]),t._v(" "),a("p",[t._v("要想学SQL执行计划，就需要学习查看执行计划的命令："),a("code",[t._v("explain")]),t._v("，在查询语句的SQL前面加上关键字explain是查看执行计划的基本方法。")]),t._v(" "),a("p",[t._v("学会explain，能够给我们工作中使用hive带来极大的便利！")]),t._v(" "),a("h3",{attrs:{id:"查看sql的执行计划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看sql的执行计划"}},[t._v("#")]),t._v(" 查看SQL的执行计划")]),t._v(" "),a("p",[t._v("Hive提供的执行计划目前可以查看的信息有以下几种：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("explain")]),t._v("：查看执行计划的基本信息；")]),t._v(" "),a("li",[a("strong",[t._v("explain dependency")]),t._v("：dependency在explain语句中使用会产生有关计划中输入的额外信息。它显示了输入的各种属性；")]),t._v(" "),a("li",[a("strong",[t._v("explain authorization")]),t._v("：查看SQL操作相关权限的信息；")]),t._v(" "),a("li",[a("strong",[t._v("explain vectorization")]),t._v("：查看SQL的向量化描述信息，显示为什么未对Map和Reduce进行矢量化。从 Hive 2.3.0 开始支持；")]),t._v(" "),a("li",[a("strong",[t._v("explain analyze")]),t._v("：用实际的行数注释计划。从 Hive 2.2.0 开始支持；")]),t._v(" "),a("li",[a("strong",[t._v("explain cbo")]),t._v("：输出由Calcite优化器生成的计划。CBO 从 Hive 4.0.0 版本开始支持；")]),t._v(" "),a("li",[a("strong",[t._v("explain locks")]),t._v("：这对于了解系统将获得哪些锁以运行指定的查询很有用。LOCKS 从 Hive 3.2.0 开始支持；")]),t._v(" "),a("li",[a("strong",[t._v("explain ast")]),t._v("：输出查询的抽象语法树。AST 在 Hive 2.1.0 版本删除了，存在bug，转储AST可能会导致OOM错误，将在4.0.0版本修复；")]),t._v(" "),a("li",[a("strong",[t._v("explain extended")]),t._v("：加上 extended 可以输出有关计划的额外信息。这通常是物理信息，例如文件名，这些额外信息对我们用处不大；")])]),t._v(" "),a("h3",{attrs:{id:"_1-explain-的用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-explain-的用法"}},[t._v("#")]),t._v(" 1.  explain 的用法")]),t._v(" "),a("p",[a("strong",[t._v("Hive提供了explain命令来展示一个查询的执行计划")]),t._v("，这个执行计划对于我们了解底层原理，Hive 调优，排查数据倾斜等很有帮助。")]),t._v(" "),a("p",[t._v("使用语法如下：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explain")]),t._v(" query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("在 hive cli 中输入以下命令(hive 2.3.7)：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explain")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" test1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("得到结果：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("STAGE DEPENDENCIES:\n  Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("is")]),t._v(" a root stage\n  Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" depends "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" stages: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n \nSTAGE PLANS:\n  Stage: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    Map Reduce\n      Map Operator Tree:\n          TableScan\n            alias: test1\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v(" Operator\n              expressions: id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n              outputColumnNames: id\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Group")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("By")]),t._v(" Operator\n                aggregations: "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mode")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("hash")]),t._v("\n                outputColumnNames: _col0\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                Reduce Output Operator\n                  sort "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(":\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),t._v(" expressions: _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      Reduce Operator Tree:\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Group")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("By")]),t._v(" Operator\n          aggregations: "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VALUE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_col0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mode")]),t._v(": mergepartial\n          outputColumnNames: _col0\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("File")]),t._v(" Output Operator\n            compressed: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(":\n                input format: org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hadoop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mapred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SequenceFileInputFormat\n                output format: org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hadoop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HiveSequenceFileOutputFormat\n                serde: org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hadoop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serde2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lazy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LazySimpleSerDe\n \n  Stage: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Fetch")]),t._v(" Operator\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("limit")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      Processor Tree:\n        ListSink\n \n")])])]),a("p",[t._v("看完以上内容有什么感受，是不是感觉都看不懂，不要着急，下面将会详细讲解每个参数，相信你学完下面的内容之后再看 explain 的查询结果将游刃有余。")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("一个HIVE查询被转换为一个由一个或多个stage组成的序列（有向无环图DAG）。这些stage可以是MapReduce stage，也可以是负责元数据存储的stage，也可以是负责文件系统的操作（比如移动和重命名）的stage")]),t._v("。")])]),t._v(" "),a("p",[t._v("我们将上述结果拆分看，先从最外层开始，包含两个大的部分：")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("stage dependencies：各个stage之间的依赖性")])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("stage plan：各个stage的执行计划")])])])]),t._v(" "),a("p",[t._v("先看第一部分 stage dependencies ，包含两个 stage，Stage-1 是根stage，说明这是开始的stage，Stage-0 依赖 Stage-1，Stage-1执行完成后执行Stage-0。")]),t._v(" "),a("p",[t._v("再看第二部分 stage plan，里面有一个 Map Reduce，一个MR的执行计划分为两个部分：")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("Map Operator Tree：MAP端的执行计划树")])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("Reduce Operator Tree：Reduce端的执行计划树")])])])]),t._v(" "),a("p",[t._v("这两个执行计划树里面包含这条sql语句的 operator：")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("TableScan：表扫描操作")]),t._v("，map端第一个操作肯定是加载表，所以就是表扫描操作，常见的属性：")]),t._v(" "),a("ul",[a("li",[t._v("alias：表名称")]),t._v(" "),a("li",[t._v("Statistics：表统计信息，包含表中数据条数，数据大小等")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Select Operator：选取操作")]),t._v("，常见的属性 ：")]),t._v(" "),a("ul",[a("li",[t._v("expressions：需要的字段名称及字段类型")]),t._v(" "),a("li",[t._v("outputColumnNames：输出的列名称")]),t._v(" "),a("li",[t._v("Statistics：表统计信息，包含表中数据条数，数据大小等")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Group By Operator：分组聚合操作")]),t._v("，常见的属性：")]),t._v(" "),a("ul",[a("li",[t._v("aggregations：显示聚合函数信息")]),t._v(" "),a("li",[t._v("mode：聚合模式，值有 hash：随机聚合，就是hash partition；partial：局部聚合；final：最终聚合")]),t._v(" "),a("li",[t._v("keys：分组的字段，如果没有分组，则没有此字段")]),t._v(" "),a("li",[t._v("outputColumnNames：聚合之后输出列名")]),t._v(" "),a("li",[t._v("Statistics：表统计信息，包含分组聚合之后的数据条数，数据大小等")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Reduce Output Operator：输出到reduce操作")]),t._v("，常见属性：")]),t._v(" "),a("ul",[a("li",[t._v("sort order：值为空 不排序；值为 + 正序排序，值为 - 倒序排序；值为 +-  排序的列为两列，第一列为正序，第二列为倒序")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Filter Operator：过滤操作")]),t._v("，常见的属性：")]),t._v(" "),a("ul",[a("li",[t._v("predicate：过滤条件，如sql语句中的where id>=1，则此处显示(id >= 1)")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Map Join Operator：join 操作")]),t._v("，常见的属性：")]),t._v(" "),a("ul",[a("li",[t._v("condition map：join方式 ，如Inner Join 0 to 1 Left Outer Join0 to 2")]),t._v(" "),a("li",[t._v("keys: join 的条件字段")]),t._v(" "),a("li",[t._v("outputColumnNames：join 完成之后输出的字段")]),t._v(" "),a("li",[t._v("Statistics：join 完成之后生成的数据条数，大小等")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("File Output Operator：文件输出操作")]),t._v("，常见的属性")]),t._v(" "),a("ul",[a("li",[t._v("compressed：是否压缩")]),t._v(" "),a("li",[t._v("table：表的信息，包含输入输出文件格式化方式，序列化方式等")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Fetch Operator 客户端获取数据操作")]),t._v("，常见的属性：")]),t._v(" "),a("ul",[a("li",[t._v("limit，值为 -1 表示不限制条数，其他值为限制的条数")])])])]),t._v(" "),a("h3",{attrs:{id:"_2-explain-的使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-explain-的使用场景"}},[t._v("#")]),t._v(" 2. explain 的使用场景")]),t._v(" "),a("blockquote",[a("p",[t._v("本节介绍 explain 能够为我们在生产实践中带来哪些便利及解决我们哪些迷惑")])]),t._v(" "),a("p",[t._v("案例一：join 语句会过滤 null 的值吗？")]),t._v(" "),a("p",[t._v("现在，我们在hive cli 输入以下查询计划语句")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" test1 a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" test2 b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("问："),a("strong",[t._v("上面这条 join 语句会过滤 id 为 null 的值吗")])]),t._v(" "),a("p",[t._v("执行下面语句：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explain")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" test1 a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" test2 b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("我们来看结果 (为了适应页面展示，仅截取了部分输出信息)：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("TableScan\n alias: a\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n Filter Operator\n    predicate: id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v(" Operator\n        expressions: id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        outputColumnNames: _col0\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n        HashTable Sink Operator\n           "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keys")]),t._v(":\n             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),a("p",[t._v("从上述结果可以看到 "),a("strong",[t._v("predicate: id is not null")]),t._v(" 这样一行，"),a("strong",[t._v("说明 join 时会自动过滤掉关联字段为 null 值的情况，但 left join 或 full join 是不会自动过滤null值的")]),t._v("，大家可以自行尝试下。")]),t._v(" "),a("p",[t._v("案例二：group by 分组语句会进行排序吗？")]),t._v(" "),a("p",[t._v("看下面这条sql")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" test1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("group")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("问："),a("strong",[t._v("group by 分组语句会进行排序吗")])]),t._v(" "),a("p",[t._v("直接来看 explain 之后结果 (为了适应页面展示，仅截取了部分输出信息)")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v(" TableScan\n    alias: test1\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("108")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v(" Operator\n        expressions: id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        outputColumnNames: id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user_name\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("108")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Group")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("By")]),t._v(" Operator\n           aggregations: "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keys")]),t._v(": id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mode")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("hash")]),t._v("\n           outputColumnNames: _col0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _col1\n           "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("108")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n           Reduce Output Operator\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),t._v(" expressions: _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n             sort "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n             Map"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("reduce "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("partition")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("columns")]),t._v(": _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("108")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),t._v(" expressions: _col1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),a("p",[t._v("我们看 Group By Operator，里面有 keys: id (type: int) 说明按照 id 进行分组的，再往下看还有 sort order: + ，"),a("strong",[t._v("说明是按照 id 字段进行正序排序的")]),t._v("。")]),t._v(" "),a("p",[t._v("案例三：哪条sql执行效率高呢？")]),t._v(" "),a("p",[t._v("观察两条sql语句")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("\n a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user_name\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("\n test1 a\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" test2 b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v("\n a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("\n a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user_name\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" test1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" a\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" test2 b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("这两条sql语句输出的结果是一样的，但是哪条sql执行效率高呢")]),t._v("？")]),t._v(" "),a("p",[t._v("有人说第一条sql执行效率高，因为第二条sql有子查询，子查询会影响性能；")]),t._v(" "),a("p",[t._v("有人说第二条sql执行效率高，因为先过滤之后，在进行join时的条数减少了，所以执行效率就高了。")]),t._v(" "),a("p",[t._v("到底哪条sql效率高呢，我们直接在sql语句前面加上 explain，看下执行计划不就知道了嘛！")]),t._v(" "),a("p",[t._v("在第一条sql语句前加上 explain，得到如下结果")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("hive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explain")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" test1 a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" test2 b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Explain")]),t._v("\nSTAGE DEPENDENCIES:\n  Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("is")]),t._v(" a root stage\n  Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" depends "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" stages: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n  Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" depends "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" stages: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n \nSTAGE PLANS:\n  Stage: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n    Map Reduce "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Local")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Work")]),t._v("\n      Alias "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Map "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Local")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Tables")]),t._v(":\n        $hdt$_0:a\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Fetch")]),t._v(" Operator\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("limit")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      Alias "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Map "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Local")]),t._v(" Operator Tree:\n        $hdt$_0:a\n          TableScan\n            alias: a\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n            Filter Operator\n              predicate: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v(" Operator\n                expressions: id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                outputColumnNames: _col0\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                HashTable Sink Operator\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keys")]),t._v(":\n                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n \n  Stage: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    Map Reduce\n      Map Operator Tree:\n          TableScan\n            alias: b\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n            Filter Operator\n              predicate: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v(" Operator\n                expressions: id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                outputColumnNames: _col0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _col1\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                Map "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Join")]),t._v(" Operator\n                  condition map:\n                       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Inner")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Join")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keys")]),t._v(":\n                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                  outputColumnNames: _col0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _col2\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v(" Operator\n                    expressions: _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _col2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    outputColumnNames: _col0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _col1\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("File")]),t._v(" Output Operator\n                      compressed: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(":\n                          input format: org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hadoop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mapred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SequenceFileInputFormat\n                          output format: org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hadoop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HiveSequenceFileOutputFormat\n                          serde: org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hadoop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serde2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lazy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LazySimpleSerDe\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Local")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Work")]),t._v(":\n        Map Reduce "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Local")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Work")]),t._v("\n \n  Stage: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Fetch")]),t._v(" Operator\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("limit")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      Processor Tree:\n        ListSink\n")])])]),a("p",[t._v("在第二条sql语句前加上 explain，得到如下结果")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("hive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explain")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("  test1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" test2 b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Explain")]),t._v("\nSTAGE DEPENDENCIES:\n  Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("is")]),t._v(" a root stage\n  Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" depends "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" stages: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n  Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" depends "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" stages: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n \nSTAGE PLANS:\n  Stage: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n    Map Reduce "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Local")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Work")]),t._v("\n      Alias "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Map "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Local")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Tables")]),t._v(":\n        $hdt$_0:test1\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Fetch")]),t._v(" Operator\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("limit")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      Alias "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Map "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Local")]),t._v(" Operator Tree:\n        $hdt$_0:test1\n          TableScan\n            alias: test1\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n            Filter Operator\n              predicate: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v(" Operator\n                expressions: id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                outputColumnNames: _col0\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                HashTable Sink Operator\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keys")]),t._v(":\n                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n \n  Stage: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    Map Reduce\n      Map Operator Tree:\n          TableScan\n            alias: b\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n            Filter Operator\n              predicate: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v(" Operator\n                expressions: id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                outputColumnNames: _col0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _col1\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                Map "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Join")]),t._v(" Operator\n                  condition map:\n                       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Inner")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Join")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keys")]),t._v(":\n                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                  outputColumnNames: _col0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _col2\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v(" Operator\n                    expressions: _col0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _col2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(": string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    outputColumnNames: _col0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _col1\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("File")]),t._v(" Output Operator\n                      compressed: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Statistics")]),t._v(": Num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rows")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Data")]),t._v(" size: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" Basic stats: COMPLETE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Column")]),t._v(" stats: NONE\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(":\n                          input format: org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hadoop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mapred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SequenceFileInputFormat\n                          output format: org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hadoop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HiveSequenceFileOutputFormat\n                          serde: org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hadoop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serde2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lazy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LazySimpleSerDe\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Local")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Work")]),t._v(":\n        Map Reduce "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Local")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Work")]),t._v("\n \n  Stage: Stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Fetch")]),t._v(" Operator\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("limit")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      Processor Tree:\n        ListSink\n")])])]),a("p",[t._v("大家有什么发现，除了表别名不一样，其他的执行计划完全一样，都是先进行 where 条件过滤，在进行 join 条件关联。"),a("strong",[t._v("说明 hive 底层会自动帮我们进行优化，所以这两条sql语句执行效率是一样的")]),t._v("。")]),t._v(" "),a("p",[t._v("以上仅列举了3个我们生产中既熟悉又有点迷糊的例子，explain 还有很多其他的用途，如查看stage的依赖情况、排查数据倾斜、hive 调优等，小伙伴们可以自行尝试。")]),t._v(" "),a("h3",{attrs:{id:"_2-explain-dependency的用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-explain-dependency的用法"}},[t._v("#")]),t._v(" 2. explain dependency的用法")]),t._v(" "),a("p",[t._v("explain dependency用于描述一段SQL需要的数据来源，输出是一个json格式的数据，里面包含以下两个部分的内容：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("input_partitions")]),t._v("：描述一段SQL依赖的数据来源表分区，里面存储的是分区名的列表，如果整段SQL包含的所有表都是非分区表，则显示为空。")]),t._v(" "),a("li",[a("strong",[t._v("input_tables")]),t._v("：描述一段SQL依赖的数据来源表，里面存储的是Hive表名的列表。")])]),t._v(" "),a("p",[a("strong",[t._v("使用explain dependency查看SQL查询非分区普通表")]),t._v("，在 hive cli 中输入以下命令：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explain")]),t._v(" dependency "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" s_age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" student_orc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("得到结果：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_partitions"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_tables"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tablename"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_tb _orc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tabletype"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MANAGED_TABLE"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("}\n")])])]),a("p",[a("strong",[t._v("使用explain dependency查看SQL查询分区表")]),t._v("，在 hive cli 中输入以下命令：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explain")]),t._v(" dependency "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" s_age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" num "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" student_orc_partition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("得到结果：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_partitions"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@ part=0"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=1"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=2"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=3"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=4"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=5"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=6"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=7"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=8"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=9"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_tables"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tablename"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tabletype"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MANAGED_TABLE"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("explain dependency的使用场景有两个：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("场景一")]),t._v("：快速排除。快速排除因为读取不到相应分区的数据而导致任务数据输出异常。例如，在一个以天分区的任务中，上游任务因为生产过程不可控因素出现异常或者空跑，导致下游任务引发异常。通过这种方式，可以快速查看SQL读取的分区是否出现异常。")]),t._v(" "),a("li",[a("strong",[t._v("场景二")]),t._v("：理清表的输入，帮助理解程序的运行，特别是有助于理解有多重子查询，多表连接的依赖输入。")])]),t._v(" "),a("p",[t._v("下面通过两个案例来看explain dependency的实际运用：")]),t._v(" "),a("p",[t._v("案例一：识别看似等价的代码")]),t._v(" "),a("p",[t._v("对于刚接触SQL的程序员，很容易将")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("inner")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("no")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("no")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("f"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("f"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("等价于")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("inner")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("no")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("no")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("f"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("f"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("我们可以通过案例来查看下它们的区别：")]),t._v(" "),a("p",[t._v("代码1：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" \na"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" student_orc_partition a \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("inner")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" \nstudent_orc_partition_only b \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("代码2：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" \na"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" student_orc_partition a \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("inner")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" \nstudent_orc_partition_only b \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("我们看下上述两段代码explain dependency的输出结果：")]),t._v(" "),a("p",[a("strong",[t._v("代码1的explain dependency结果")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_partitions"')]),t._v(": \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=0"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=1"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=2"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only@part=1"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only@part=2"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_tables"')]),t._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tablename"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tabletype"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MANAGED_TABLE"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" {"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tablename"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tabletype"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MANAGED_TABLE"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("}\n")])])]),a("p",[a("strong",[t._v("代码2的explain dependency结果")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_partitions"')]),t._v(": \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=1"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(" : "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=2"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(" :"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only@part=1"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only@part=2"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_tables"')]),t._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tablename"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tabletype"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MANAGED_TABLE"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" {"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tablename"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tabletype"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MANAGED_TABLE"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("}\n")])])]),a("p",[t._v("通过上面的输出结果可以看到，其实上述的两个SQL并不等价，代码1在内连接（inner join）中的连接条件（on）中加入非等值的过滤条件后，并没有将内连接的左右两个表按照过滤条件进行过滤，内连接在执行时会多读取part=0的分区数据。而在代码2中，会过滤掉不符合条件的分区。")]),t._v(" "),a("p",[t._v("案例二：识别SQL读取数据范围的差别")]),t._v(" "),a("p",[t._v("代码1：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explain")]),t._v(" dependency\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v("\na"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" student_orc_partition a \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("left")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" \nstudent_orc_partition_only b \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("代码2：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explain")]),t._v(" dependency \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" \na"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" student_orc_partition a \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("left")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" \nstudent_orc_partition_only b \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("s_no "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("part"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("以上两个代码的数据读取范围是一样的吗？答案是不一样，我们通过explain dependency来看下：")]),t._v(" "),a("p",[a("strong",[t._v("代码1的explain dependency结果")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_partitions"')]),t._v(": \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(": "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=0"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=1"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" …中间省略"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("个分区\n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=9"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only@part=1"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only@part=2"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_tables"')]),t._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tablename"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tabletype"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MANAGED_TABLE"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" {"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tablename"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tabletype"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MANAGED_TABLE"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("}\n")])])]),a("p",[a("strong",[t._v("代码2的explain dependency结果")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_partitions"')]),t._v(": \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=0"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=1"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" …中间省略"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("个分区 \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition@part=9"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only@part=0"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only@part=1"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" …中间省略"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("个分区 \n{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"partitionName"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only@part=9"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_tables"')]),t._v(": "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("{"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tablename"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tabletype"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MANAGED_TABLE"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" {"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tablename"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default@student_orc_partition_only"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tabletype"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MANAGED_TABLE"')]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("}\n")])])]),a("p",[t._v("可以看到，对左外连接在连接条件中加入非等值过滤的条件，"),a("strong",[t._v("如果过滤条件是作用于右表（b表）有起到过滤的效果，则右表只要扫描两个分区即可，但是左表（a表）会进行全表扫描。如果过滤条件是针对左表，则完全没有起到过滤的作用，那么两个表将进行全表扫描")]),t._v("。这时的情况就如同全外连接一样都需要对两个数据进行全表扫描。")]),t._v(" "),a("p",[t._v("在使用过程中，容易认为代码片段2可以像代码片段1一样进行数据过滤，通过查看explain dependency的输出结果，可以知道不是如此。")]),t._v(" "),a("h3",{attrs:{id:"_3-explain-authorization-的用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-explain-authorization-的用法"}},[t._v("#")]),t._v(" 3. explain authorization 的用法")]),t._v(" "),a("p",[t._v("通过explain authorization可以知道当前SQL访问的数据来源（INPUTS） 和数据输出（OUTPUTS），以及当前Hive的访问用户 （CURRENT_USER）和操作（OPERATION）。")]),t._v(" "),a("p",[t._v("在 hive cli 中输入以下命令：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("explain")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("authorization")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" variance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s_score"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" student_tb_orc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("结果如下：")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("INPUTS: \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@student_tb_orc")]),t._v(" \nOUTPUTS: \n  hdfs:"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//node01:8020/tmp/hive/hdfs/cbf182a5-8258-4157-9194- 90f1475a3ed5/-mr-10000 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_USER")]),t._v(": \n  hdfs \nOPERATION: \n  QUERY \nAUTHORIZATION_FAILURES: \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("No")]),t._v(" privilege "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Select'")]),t._v(" found "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" inputs { "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("database")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(":student_ tb_orc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" columnName:s_score}\n")])])]),a("p",[t._v("从上面的信息可知：")]),t._v(" "),a("p",[t._v("上面案例的数据来源是defalut数据库中的 student_tb_orc表；")]),t._v(" "),a("p",[t._v("数据的输出路径是hdfs://node01:8020/tmp/hive/hdfs/cbf182a5-8258-4157-9194-90f1475a3ed5/-mr-10000；")]),t._v(" "),a("p",[t._v("当前的操作用户是hdfs，操作是查询；")]),t._v(" "),a("p",[t._v("观察上面的信息我们还会看到AUTHORIZATION_FAILURES信息，提示对当前的输入没有查询权限，但如果运行上面的SQL的话也能够正常运行。为什么会出现这种情况？"),a("strong",[t._v("Hive在默认不配置权限管理的情况下不进行权限验证，所有的用户在Hive里面都是超级管理员，即使不对特定的用户进行赋权，也能够正常查询")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[t._v("#")]),t._v(" 最后")]),t._v(" "),a("p",[t._v("通过上面对explain的介绍，可以发现explain中有很多值得我们去研究的内容，读懂 explain 的执行计划有利于我们优化Hive SQL，同时也能提升我们对SQL的掌控力。")]),t._v(" "),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),a("ul",[a("li",[t._v("https://blog.csdn.net/weixin_44291548/article/details/119764919")])])])}),[],!1,null,null,null);s.default=e.exports}}]);