(window.webpackJsonp=window.webpackJsonp||[]).push([[499],{1015:function(_,v,t){"use strict";t.r(v);var a=t(53),r=Object(a.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[_._v("TIP")]),_._v(" "),t("p",[_._v("本文主要是介绍 Pig-基础知识总结 。")])]),_._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#pig-基础知识总结"}},[_._v("Pig-基础知识总结")])]),t("li",[t("a",{attrs:{href:"#_1-常用操作"}},[_._v("1. 常用操作")])]),t("li",[t("a",{attrs:{href:"#_2-pig-latin数据类型"}},[_._v("2. Pig Latin数据类型")])]),t("li",[t("a",{attrs:{href:"#_3-常用函数"}},[_._v("3. 常用函数")])]),t("li",[t("a",{attrs:{href:"#【-】"}},[_._v("【----------------------------】")])]),t("li",[t("a",{attrs:{href:"#准备两个数据文件"}},[_._v("准备两个数据文件：")])]),t("li",[t("a",{attrs:{href:"#加载和存储-load-store"}},[_._v("加载和存储（Load，Store）")])]),t("li",[t("a",{attrs:{href:"#筛选-filter"}},[_._v("筛选（Filter）")])]),t("li",[t("a",{attrs:{href:"#foreach-generate"}},[_._v("Foreach Generate")])]),t("li",[t("a",{attrs:{href:"#分组-group"}},[_._v("分组（group）")])]),t("li",[t("a",{attrs:{href:"#stream操作"}},[_._v("Stream操作")])]),t("li",[t("a",{attrs:{href:"#join"}},[_._v("Join")])]),t("li",[t("a",{attrs:{href:"#cogroup"}},[_._v("COGROUP")])]),t("li",[t("a",{attrs:{href:"#cross"}},[_._v("Cross")])]),t("li",[t("a",{attrs:{href:"#排序-order"}},[_._v("排序（Order）")])]),t("li",[t("a",{attrs:{href:"#联合-union"}},[_._v("联合（Union）")])]),t("li",[t("a",{attrs:{href:"#参考文章"}},[_._v("参考文章")])])])]),t("p"),_._v(" "),t("h2",{attrs:{id:"pig-基础知识总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pig-基础知识总结"}},[_._v("#")]),_._v(" Pig-基础知识总结")]),_._v(" "),t("p",[_._v("Pig查询语言是基于Pig Latin,程序由一系列语句构成，操作和命令不区分大小写，别名和函数名区分大小写。下面，将介绍Pig Latin的常用语法。")]),_._v(" "),t("h2",{attrs:{id:"_1-常用操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-常用操作"}},[_._v("#")]),_._v(" 1. 常用操作")]),_._v(" "),t("ul",[t("li",[_._v("加载与存储")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("LOAD")]),_._v(" "),t("th",[_._v("导入外部文件中的数据，存入关系")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("STORE")]),_._v(" "),t("td",[_._v("将一个关系存储到文件系统中")])]),_._v(" "),t("tr",[t("td",[_._v("DUMP")]),_._v(" "),t("td",[_._v("将关系打印到控制台")])])])]),_._v(" "),t("ul",[t("li",[_._v("过滤")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("FILTER")]),_._v(" "),t("th",[_._v("按条件筛选关系中的行")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("DISTINCT")]),_._v(" "),t("td",[_._v("去除关系中的重复行")])]),_._v(" "),t("tr",[t("td",[t("em",[_._v("FOREACH")]),_._v("*...*"),t("em",[_._v("GENERATE")])]),_._v(" "),t("td",[_._v("对于集合的每个元素，生成或删除字段")])]),_._v(" "),t("tr",[t("td",[_._v("STREAM")]),_._v(" "),t("td",[_._v("使用外部程序对关系进行变换(例如，将Python程序嵌入到Pig中使用)")])]),_._v(" "),t("tr",[t("td",[_._v("SAMPLE")]),_._v(" "),t("td",[_._v("从关系中随机取样")])])])]),_._v(" "),t("ul",[t("li",[_._v("分组与连接")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("JOIN")]),_._v(" "),t("th",[_._v("连接两个或多个关系")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("COGROUP")]),_._v(" "),t("td",[_._v("在两个或多个关系中分组")])]),_._v(" "),t("tr",[t("td",[_._v("GROUP")]),_._v(" "),t("td",[_._v("在一个关系中对数据分组")])]),_._v(" "),t("tr",[t("td",[_._v("CROSS")]),_._v(" "),t("td",[_._v("获取两个或更多关系的乘积（叉乘）")])])])]),_._v(" "),t("ul",[t("li",[_._v("排序")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("ORDER")]),_._v(" "),t("th",[_._v("根据一个或多个字段对某个关系进行排序")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("LIMIT")]),_._v(" "),t("td",[_._v("限制关系的元组个数")])])])]),_._v(" "),t("ul",[t("li",[_._v("合并与分割")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("UNION")]),_._v(" "),t("th",[_._v("合并两个或多个关系")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("SPLIT")]),_._v(" "),t("td",[_._v("把某个关系切分成两个或多个关系")])])])]),_._v(" "),t("ul",[t("li",[_._v("诊断操作")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("DESCRIBE")]),_._v(" "),t("th",[_._v("打印关系的模式")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("EXPLAIN")]),_._v(" "),t("td",[_._v("打印逻辑和物理计划")])]),_._v(" "),t("tr",[t("td",[_._v("ILLUSTRATE")]),_._v(" "),t("td",[_._v("使用生成的输入子集显示逻辑计划的试运行结果")])])])]),_._v(" "),t("ul",[t("li",[t("em",[_._v("UDF**操作")])])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("REGISTER")]),_._v(" "),t("th",[_._v("在"),t("em",[_._v("Pig")]),_._v("运行时环境中注册一个"),t("em",[_._v("JAR")]),_._v("文件")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("DEFINE")]),_._v(" "),t("td",[_._v("为"),t("em",[_._v("UDF")]),_._v("、流式脚本或命令规范新建别名")])])])]),_._v(" "),t("ul",[t("li",[t("em",[_._v("Pig Latin")]),_._v("命令操作")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("kill")]),_._v(" "),t("th",[_._v("中止某个"),t("em",[_._v("MapReduce")]),_._v("任务")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("exec")]),_._v(" "),t("td",[_._v("在一个新的"),t("em",[_._v("Grunt shell")]),_._v("程序中以批处理模式运行一个脚本")])]),_._v(" "),t("tr",[t("td",[_._v("run")]),_._v(" "),t("td",[_._v("在当前"),t("em",[_._v("Grunt")]),_._v("外壳程序中运行程序")])]),_._v(" "),t("tr",[t("td",[_._v("quit")]),_._v(" "),t("td",[_._v("退出解释器")])]),_._v(" "),t("tr",[t("td",[_._v("set")]),_._v(" "),t("td",[_._v("设置"),t("em",[_._v("Pig")]),_._v("选项")])])])]),_._v(" "),t("ul",[t("li",[t("em",[_._v("Pig Latin")]),_._v("表达式")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("类型")]),_._v(" "),t("th",[_._v("表达式")]),_._v(" "),t("th",[_._v("描述")]),_._v(" "),t("th",[_._v("示例")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("字段")]),_._v(" "),t("td",[_._v("$n")]),_._v(" "),t("td",[_._v("第"),t("em",[_._v("n")]),_._v("个字段")]),_._v(" "),t("td",[_._v("$0")])]),_._v(" "),t("tr",[t("td",[_._v("字段")]),_._v(" "),t("td",[_._v("d")]),_._v(" "),t("td",[_._v("字段名d")]),_._v(" "),t("td",[_._v("year")])]),_._v(" "),t("tr",[t("td",[_._v("投影")]),_._v(" "),t("td",[_._v("c.$n, c.f")]),_._v(" "),t("td",[t("em",[_._v("c.f")]),_._v(" 在关系、包或元组中的字段")]),_._v(" "),t("td",[_._v("user.$0, user.year")])]),_._v(" "),t("tr",[t("td",[t("em",[_._v("Map")]),_._v("查找")]),_._v(" "),t("td",[_._v("m#k")]),_._v(" "),t("td",[_._v("在映射"),t("em",[_._v("m")]),_._v("中键"),t("em",[_._v("k")]),_._v("对应的值")]),_._v(" "),t("td",[t("em",[_._v("items")]),_._v("*'"),t("strong",[_._v("Coat")]),_._v("'*")])]),_._v(" "),t("tr",[t("td",[_._v("类型转换")]),_._v(" "),t("td",[_._v("(t)f")]),_._v(" "),t("td",[_._v("将字段"),t("em",[_._v("t")]),_._v("转换成"),t("em",[_._v("f")]),_._v("类型")]),_._v(" "),t("td",[_._v("(int)age")])]),_._v(" "),t("tr",[t("td",[_._v("函数型平面化")]),_._v(" "),t("td",[t("em",[_._v("fn(f1, f2,")]),_._v(" …"),t("em",[_._v(")")])]),_._v(" "),t("td",[_._v("在字段上应用函数")]),_._v(" "),t("td",[_._v("fn isGood(quality)")])]),_._v(" "),t("tr",[t("td",[_._v("函数型平面化")]),_._v(" "),t("td",[_._v("FLATTEN(f)")]),_._v(" "),t("td",[_._v("从包和元组中去除嵌套")]),_._v(" "),t("td",[_._v("flatten(group)")])])])]),_._v(" "),t("h2",{attrs:{id:"_2-pig-latin数据类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-pig-latin数据类型"}},[_._v("#")]),_._v(" 2. Pig Latin数据类型")]),_._v(" "),t("p",[_._v("数据类型：")]),_._v(" "),t("ul",[t("li",[t("strong",[_._v("int")]),_._v(" (32位有符号整数)")]),_._v(" "),t("li",[t("strong",[_._v("long")]),_._v("(64位有符号整数)")]),_._v(" "),t("li",[t("strong",[_._v("float")]),_._v("(32位浮点数)")]),_._v(" "),t("li",[t("strong",[_._v("double")]),_._v("(64位浮点数)")]),_._v(" "),t("li",[t("strong",[_._v("chararray")]),_._v("(UTF16格式的字符数组)")]),_._v(" "),t("li",[t("strong",[_._v("bytearray")]),_._v("(字节数组)")]),_._v(" "),t("li",[_._v("**tuple(元组) : tuple: (1, "),t("strong",[_._v("world")]),_._v(")        //任何类型的字段序列")]),_._v(" "),t("li",[_._v("**bag(包) :bag: {(1, "),t("strong",[_._v("world")]),_._v("), (2)}    //元组的无序多重集合（允许重复元组）")]),_._v(" "),t("li",[t("strong",[_._v("map(键值对)")]),_._v(" : map: ['a' 'world']          //一组键值对，键必须是字符数组")])]),_._v(" "),t("h2",{attrs:{id:"_3-常用函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-常用函数"}},[_._v("#")]),_._v(" 3. 常用函数")]),_._v(" "),t("p",[_._v("计算函数：")]),_._v(" "),t("ul",[t("li",[_._v("AVG ： 所有值平均值")]),_._v(" "),t("li",[_._v("COUNT ： 获取包中的元素数量")]),_._v(" "),t("li",[_._v("CONCAT：将两列合并为一列")]),_._v(" "),t("li",[_._v("COUNT_STAR：获取包中的元素数量。在计数元素时，COUNT_STAR() 函数包含NULL值")]),_._v(" "),t("li",[_._v("DIFF：比较元组中的两个包")]),_._v(" "),t("li",[_._v("MAX：计算单列包中的列（数值或字符）的最大值")]),_._v(" "),t("li",[_._v("MIN：计算单列包中的列（数值或字符）的最小值")]),_._v(" "),t("li",[_._v("SIZE：基于任何Pig数据类型计算元素的数量")]),_._v(" "),t("li",[_._v("SUM：获取单列包中列的总数值")]),_._v(" "),t("li",[_._v("TOKENIZE：用于在单个元组中分割字符串（其中包含一组字），并返回包含拆分操作输出的包")])]),_._v(" "),t("p",[_._v("过滤函数：")]),_._v(" "),t("ul",[t("li",[_._v("IsEmpty：检查包或映射是否为空")])]),_._v(" "),t("p",[_._v("加载*/*存储函数：")]),_._v(" "),t("ul",[t("li",[_._v("PigStorage：将数据加载并存储为结构化文本文件")]),_._v(" "),t("li",[_._v("BinStorage：使用机器可读格式将数据加载并存储到Pig中")]),_._v(" "),t("li",[_._v("TextLoader：用于以UTF-8格式加载非结构化数据")])]),_._v(" "),t("h2",{attrs:{id:"【-】"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#【-】"}},[_._v("#")]),_._v(" 【----------------------------】")]),_._v(" "),t("p",[_._v("所有命令和脚本都在Pig 0.12.0 & Hadoop 2.2.0下测试通过。")]),_._v(" "),t("h2",{attrs:{id:"准备两个数据文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备两个数据文件"}},[_._v("#")]),_._v(" 准备两个数据文件：")]),_._v(" "),t("p",[_._v("1）student.txt 结构为（班级号，学号，成绩）,字段间逗号分隔。")]),_._v(" "),t("p",[_._v("C01,N0101,82")]),_._v(" "),t("p",[_._v("C01,N0102,59")]),_._v(" "),t("p",[_._v("C01,N0103,65")]),_._v(" "),t("p",[_._v("C02,N0201,81")]),_._v(" "),t("p",[_._v("C02,N0202,82")]),_._v(" "),t("p",[_._v("C02,N0203,79")]),_._v(" "),t("p",[_._v("C03,N0301,56")]),_._v(" "),t("p",[_._v("C03,N0302,92")]),_._v(" "),t("p",[_._v("C03,N0306,72")]),_._v(" "),t("p",[_._v("2）teacher.txt 结构为（班级号，教师）,字段间逗号分隔。")]),_._v(" "),t("p",[_._v("C01,Zhang")]),_._v(" "),t("p",[_._v("C02,Sun")]),_._v(" "),t("p",[_._v("C03,Wang")]),_._v(" "),t("p",[_._v("C04,Dong")]),_._v(" "),t("h2",{attrs:{id:"加载和存储-load-store"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加载和存储-load-store"}},[_._v("#")]),_._v(" 加载和存储（Load，Store）")]),_._v(" "),t("p",[_._v("执行以下命令")]),_._v(" "),t("p",[t("em",[_._v("records = load'hdfs://localhost:9000/input/student.txt' using PigStorage(',') as(classNo:chararray, studNo:chararray, score:int);")])]),_._v(" "),t("p",[t("em",[_._v("dump records;")])]),_._v(" "),t("p",[t("em",[_._v("store records into ' hdfs://localhost:9000/input/student_out' using PigStorage('😂;")])]),_._v(" "),t("p",[_._v("然后查看hdfs://localhost:9000/input/student_out目录下的part-m-00000文件，其内容如下：")]),_._v(" "),t("p",[_._v("C01:N0101:82")]),_._v(" "),t("p",[_._v("C01:N0102:59")]),_._v(" "),t("p",[_._v("C01:N0103:65")]),_._v(" "),t("p",[_._v("C02:N0201:81")]),_._v(" "),t("p",[_._v("C02:N0202:82")]),_._v(" "),t("p",[_._v("C02:N0203:79")]),_._v(" "),t("p",[_._v("C03:N0301:56")]),_._v(" "),t("p",[_._v("C03:N0302:92")]),_._v(" "),t("p",[_._v("C03:N0306:72")]),_._v(" "),t("p",[_._v("其中的load是加载操作，store是存储操作。他们分别可以指定其分隔符，比如上例中的逗号和分号。")]),_._v(" "),t("h2",{attrs:{id:"筛选-filter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#筛选-filter"}},[_._v("#")]),_._v(" 筛选（Filter）")]),_._v(" "),t("p",[_._v("执行以下命令：")]),_._v(" "),t("p",[t("em",[_._v("records_c01 = filter records byclassNo=='C01';")])]),_._v(" "),t("p",[t("em",[_._v("dump records_c01;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C01,N0101,82)")]),_._v(" "),t("p",[_._v("(C01,N0102,59)")]),_._v(" "),t("p",[_._v("(C01,N0103,65)")]),_._v(" "),t("p",[_._v("注意：判断是否相等要用两个等号。")]),_._v(" "),t("h2",{attrs:{id:"foreach-generate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#foreach-generate"}},[_._v("#")]),_._v(" Foreach Generate")]),_._v(" "),t("p",[_._v("Foreach对关系中的每一个记录循环，然后按指定模式生成一个新的关系。")]),_._v(" "),t("p",[_._v("执行以下命令：")]),_._v(" "),t("p",[t("em",[_._v("score_c01 = foreach records_c01generate 'Teacher',$1,score;")])]),_._v(" "),t("p",[t("em",[_._v("dump score_c01;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(Teacher,N0101,82)")]),_._v(" "),t("p",[_._v("(Teacher,N0102,59)")]),_._v(" "),t("p",[_._v("(Teacher,N0103,65)")]),_._v(" "),t("p",[_._v("生成的新的关系中包括三个字段，第一个字段是常量，第二个字段是学号（我们是通过索引号引用的），第三个字段是分数（我们通过字段名引用的）。")]),_._v(" "),t("h2",{attrs:{id:"分组-group"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分组-group"}},[_._v("#")]),_._v(" 分组（group）")]),_._v(" "),t("p",[_._v("执行以下命令：")]),_._v(" "),t("p",[t("em",[_._v("grouped_records = group recordsby classNo parallel 2;")])]),_._v(" "),t("p",[t("em",[_._v("dump grouped_records;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C02,{(C02,N0203,79),(C02,N0202,82),(C02,N0201,81)})")]),_._v(" "),t("p",[_._v("(C01,{(C01,N0103,65),(C01,N0102,59),(C01,N0101,82)})")]),_._v(" "),t("p",[_._v("(C03,{(C03,N0306,72),(C03,N0302,92),(C03,N0301,56)})")]),_._v(" "),t("p",[_._v("其中的Paraller 2表示启用2个Reduce操作。")]),_._v(" "),t("p",[_._v("如何统计每个班级及格和优秀的学生人数呢？执行以下两个命令：")]),_._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[_._v("\n*result "),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),_._v(" foreach grouped_records "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("{")]),_._v("*\n\n​     *fail "),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),_._v("filter records by score "),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("<")]),_._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("60")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("*\n\n​     *excellent "),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),_._v("filter records by score "),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("90")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("*\n\n​     *generategroup, COUNT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("(")]),_._v("fail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(")")]),_._v(" as fail, COUNT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("(")]),_._v("excellent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(")")]),_._v(" as excellent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("*\n\n*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("*\n")])])]),t("p",[t("em",[_._v("dump result;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C01,1,0)")]),_._v(" "),t("p",[_._v("(C02,0,0)")]),_._v(" "),t("p",[_._v("(C03,1,1)")]),_._v(" "),t("p",[_._v("题外话：")]),_._v(" "),t("p",[_._v("flatten操作，可以将数据格式扁平化。我们分别通过tuple和bag来看看flatten的作用：")]),_._v(" "),t("p",[_._v("1） Flatten对tuple的作用")]),_._v(" "),t("p",[_._v("执行以下命令:")]),_._v(" "),t("p",[t("em",[_._v("a= foreach records generate $0,($1,$2);")])]),_._v(" "),t("p",[t("em",[_._v("dumpa;")])]),_._v(" "),t("p",[_._v("输出结果如下：")]),_._v(" "),t("p",[_._v("(C01,(N0101,82))")]),_._v(" "),t("p",[_._v("(C01,(N0102,59))")]),_._v(" "),t("p",[_._v("(C01,(N0103,65))")]),_._v(" "),t("p",[_._v("(C02,(N0201,81))")]),_._v(" "),t("p",[_._v("(C02,(N0202,82))")]),_._v(" "),t("p",[_._v("(C02,(N0203,79))")]),_._v(" "),t("p",[_._v("(C03,(N0301,56))")]),_._v(" "),t("p",[_._v("(C03,(N0302,92))")]),_._v(" "),t("p",[_._v("(C03,(N0306,72))")]),_._v(" "),t("p",[_._v("然后，执行:")]),_._v(" "),t("p",[t("em",[_._v("b = foreach a generate $0,flatten($1);")])]),_._v(" "),t("p",[t("em",[_._v("dump b;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C01,N0101,82)")]),_._v(" "),t("p",[_._v("(C01,N0102,59)")]),_._v(" "),t("p",[_._v("(C01,N0103,65)")]),_._v(" "),t("p",[_._v("(C02,N0201,81)")]),_._v(" "),t("p",[_._v("(C02,N0202,82)")]),_._v(" "),t("p",[_._v("(C02,N0203,79)")]),_._v(" "),t("p",[_._v("(C03,N0301,56)")]),_._v(" "),t("p",[_._v("(C03,N0302,92)")]),_._v(" "),t("p",[_._v("(C03,N0306,72)")]),_._v(" "),t("p",[_._v("由此看见，flatten作用于tuple时，将flatten对应的字段（tuple）中的字段扁平化为关系中的字段。（不知道该如何解释比较好）")]),_._v(" "),t("p",[_._v("2） Flatten对bag的作用")]),_._v(" "),t("p",[_._v("执行以下命令")]),_._v(" "),t("p",[t("em",[_._v("c = foreach records generate $0,{($1),($1,$2)};")])]),_._v(" "),t("p",[t("em",[_._v("dump c;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C01,{(N0101),(N0101,82)})")]),_._v(" "),t("p",[_._v("(C01,{(N0102),(N0102,59)})")]),_._v(" "),t("p",[_._v("(C01,{(N0103),(N0103,65)})")]),_._v(" "),t("p",[_._v("(C02,{(N0201),(N0201,81)})")]),_._v(" "),t("p",[_._v("(C02,{(N0202),(N0202,82)})")]),_._v(" "),t("p",[_._v("(C02,{(N0203),(N0203,79)})")]),_._v(" "),t("p",[_._v("(C03,{(N0301),(N0301,56)})")]),_._v(" "),t("p",[_._v("(C03,{(N0302),(N0302,92)})")]),_._v(" "),t("p",[_._v("(C03,{(N0306),(N0306,72)})")]),_._v(" "),t("p",[_._v("接下来执行：")]),_._v(" "),t("p",[t("em",[_._v("d = foreach c generate $0,flatten($1);")])]),_._v(" "),t("p",[t("em",[_._v("dump d;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C01,N0101)")]),_._v(" "),t("p",[_._v("(C01,N0101,82)")]),_._v(" "),t("p",[_._v("(C01,N0102)")]),_._v(" "),t("p",[_._v("(C01,N0102,59)")]),_._v(" "),t("p",[_._v("(C01,N0103)")]),_._v(" "),t("p",[_._v("(C01,N0103,65)")]),_._v(" "),t("p",[_._v("(C02,N0201)")]),_._v(" "),t("p",[_._v("(C02,N0201,81)")]),_._v(" "),t("p",[_._v("(C02,N0202)")]),_._v(" "),t("p",[_._v("(C02,N0202,82)")]),_._v(" "),t("p",[_._v("(C02,N0203)")]),_._v(" "),t("p",[_._v("(C02,N0203,79)")]),_._v(" "),t("p",[_._v("(C03,N0301)")]),_._v(" "),t("p",[_._v("(C03,N0301,56)")]),_._v(" "),t("p",[_._v("(C03,N0302)")]),_._v(" "),t("p",[_._v("(C03,N0302,92)")]),_._v(" "),t("p",[_._v("(C03,N0306)")]),_._v(" "),t("p",[_._v("(C03,N0306,72)")]),_._v(" "),t("p",[_._v("可以看出，flatten作用于bag时，会消除嵌套关系，生成类似于笛卡尔乘积的结果。（不好表达，读者可以细细体会）。")]),_._v(" "),t("h2",{attrs:{id:"stream操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#stream操作"}},[_._v("#")]),_._v(" Stream操作")]),_._v(" "),t("p",[_._v("可以将Python程序嵌入到Pig中使用。")]),_._v(" "),t("p",[_._v("建立一个Python文件pass.py，内容如下：")]),_._v(" "),t("div",{staticClass:"language-python extra-class"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[_._v("\n\\#! "),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("/")]),_._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[_._v("bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("/")]),_._v("envpython\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("import")]),_._v(" sys\n\n \n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("for")]),_._v(" line insys"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(".")]),_._v("stdin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(":")]),_._v("\n\n​     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("(")]),_._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v("n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(")")]),_._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),_._v(" line"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(".")]),_._v("split"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(")")]),_._v(" \n\n​     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("if")]),_._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[_._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("(")]),_._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(")")]),_._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v(">=")]),_._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("60")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(":")]),_._v("\n\n​          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("print")]),_._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[_._v('"%s\\t%s\\t%s"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("%")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("(")]),_._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v("n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(")")]),_._v("\n\n")])])]),t("p",[_._v("执行以下命令:")]),_._v(" "),t("p",[t("em",[_._v("define pass "),t("code",[_._v("pass.py")]),_._v(" SHIP('/home/user/pass.py');")])]),_._v(" "),t("p",[t("em",[_._v("records_pass = stream records through pass as(classNo:chararray, studNo:chararray, score:int);")])]),_._v(" "),t("p",[t("em",[_._v("dump records_pass;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C01,N0101,82)")]),_._v(" "),t("p",[_._v("(C01,N0103,65)")]),_._v(" "),t("p",[_._v("(C02,N0201,81)")]),_._v(" "),t("p",[_._v("(C02,N0202,82)")]),_._v(" "),t("p",[_._v("(C02,N0203,79)")]),_._v(" "),t("p",[_._v("(C03,N0302,92)")]),_._v(" "),t("p",[_._v("(C03,N0306,72)")]),_._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[_._v("\n可以看出，统计结果为所有及格的记录（"),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[_._v("60")]),_._v("）。\n\n其中，ship用于将python程序提交到Hadoop集群中去。\n\n请注意第一个命令中的*"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[_._v("`")]),_._v("pass.py"),t("span",{pre:!0,attrs:{class:"token variable"}},[_._v("`")])]),_._v("*，不是用单引号括起来的，是用键盘1左边的那个键上的字符括起来的。（不知道这个字符怎么称呼，只知道是一种标注符号）\n\n")])])]),t("h2",{attrs:{id:"join"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#join"}},[_._v("#")]),_._v(" Join")]),_._v(" "),t("p",[_._v("先执行以下两条命令：")]),_._v(" "),t("p",[t("em",[_._v("r_student = load'hdfs://localhost:9000/input/student.txt' using PigStorage(',') as (classNo:chararray, studNo: chararray, score: int);")])]),_._v(" "),t("p",[t("em",[_._v("r_teacher2 = load'hdfs://localhost:9000/input/teacher.txt' using PigStorage(',') as (classNo:chararray, teacher: chararray);")])]),_._v(" "),t("p",[_._v("回到本文开头，我们有两个数据文件，分别为学生（班级，学号，成绩）；老师（班级，姓名）。")]),_._v(" "),t("p",[_._v("执行以下命令：")]),_._v(" "),t("p",[t("em",[_._v("r_joined = join r_student by classNo,r_teacher by classNo;")])]),_._v(" "),t("p",[t("em",[_._v("dump r_joined;")])]),_._v(" "),t("p",[_._v("(C01,N0103,65,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C01,N0102,59,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C01,N0101,82,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C02,N0203,79,C02,Sun)")]),_._v(" "),t("p",[_._v("(C02,N0202,82,C02,Sun)")]),_._v(" "),t("p",[_._v("(C02,N0201,81,C02,Sun)")]),_._v(" "),t("p",[_._v("(C03,N0306,72,C03,Wang)")]),_._v(" "),t("p",[_._v("(C03,N0302,92,C03,Wang)")]),_._v(" "),t("p",[_._v("(C03,N0301,56,C03,Wang)")]),_._v(" "),t("p",[_._v("类似于SQL中的内连接Inner Join。当然你也可以使用外连接，比如：")]),_._v(" "),t("p",[t("em",[_._v("r_joined = join r_student by classNo left outer,r_teacher by classNo;")])]),_._v(" "),t("p",[t("em",[_._v("dump r_joined;")])]),_._v(" "),t("p",[_._v("注意：left outer/right outer要写在第一个关系名的后面。以下语法是错误的：")]),_._v(" "),t("p",[t("em",[_._v("r_joined = join r_student by classNo, r_teacher by classNo leftouter; //错误")])]),_._v(" "),t("h2",{attrs:{id:"cogroup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cogroup"}},[_._v("#")]),_._v(" COGROUP")]),_._v(" "),t("p",[_._v("Join的操作结果是平面的（一组元组），而COGROUP的结果是有嵌套结构的。")]),_._v(" "),t("p",[_._v("运行以下命令：")]),_._v(" "),t("p",[t("em",[_._v("r1 = cogroup r_student by classNo,r_teacher by classNo;")])]),_._v(" "),t("p",[t("em",[_._v("dump r1;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C01,{(C01,N0103,65),(C01,N0102,59),(C01,N0101,82)},{(C01,Zhang)})")]),_._v(" "),t("p",[_._v("(C02,{(C02,N0203,79),(C02,N0202,82),(C02,N0201,81)},{(C02,Sun)})")]),_._v(" "),t("p",[_._v("(C03,{(C03,N0306,72),(C03,N0302,92),(C03,N0301,56)},{(C03,Wang)})")]),_._v(" "),t("p",[_._v("(C04,{},{(C04,Dong)})")]),_._v(" "),t("p",[_._v("由结果可以看出：")]),_._v(" "),t("p",[_._v("1） cogroup和join操作类似。")]),_._v(" "),t("p",[_._v("2） 生成的关系有3个字段。第一个字段为连接字段；第二个字段是一个包，值为关系1中的满足匹配关系的所有元组；第三个字段也是一个包，值为关系2中的满足匹配关系的所有元组。")]),_._v(" "),t("p",[_._v("3） 类似于Join的外连接。比如结果中的第四个记录，第二个字段值为空包，因为关系1中没有满足条件的记录。实际上第一条语句和以下语句等同：")]),_._v(" "),t("p",[t("em",[_._v("r1= cogroup r_student by classNo outer,r_teacher by classNo outer;")])]),_._v(" "),t("p",[_._v("如果你希望关系1或2中没有匹配记录时不在结果中出现，则可以分别在关系中使用inner而关键字进行排除。")]),_._v(" "),t("p",[_._v("执行以下语句：")]),_._v(" "),t("p",[t("em",[_._v("r1 = cogroup r_student by classNo inner,r_teacher byclassNo outer;")])]),_._v(" "),t("p",[t("em",[_._v("dump r1;")])]),_._v(" "),t("p",[_._v("结果为：")]),_._v(" "),t("p",[_._v("(C01,{(C01,N0103,65),(C01,N0102,59),(C01,N0101,82)},{(C01,Zhang)})")]),_._v(" "),t("p",[_._v("(C02,{(C02,N0203,79),(C02,N0202,82),(C02,N0201,81)},{(C02,Sun)})")]),_._v(" "),t("p",[_._v("(C03,{(C03,N0306,72),(C03,N0302,92),(C03,N0301,56)},{(C03,Wang)})")]),_._v(" "),t("p",[_._v("如先前我们讲到的flatten，执行以下命令：")]),_._v(" "),t("p",[t("code",[_._v("r2 = foreach r1 generate flatten($1),flatten($2);")])]),_._v(" "),t("p",[t("code",[_._v("dump r2;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C01,N0103,65,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C01,N0102,59,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C01,N0101,82,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C02,N0203,79,C02,Sun)")]),_._v(" "),t("p",[_._v("(C02,N0202,82,C02,Sun)")]),_._v(" "),t("p",[_._v("(C02,N0201,81,C02,Sun)")]),_._v(" "),t("p",[_._v("(C03,N0306,72,C03,Wang)")]),_._v(" "),t("p",[_._v("(C03,N0302,92,C03,Wang)")]),_._v(" "),t("p",[_._v("(C03,N0301,56,C03,Wang)")]),_._v(" "),t("h2",{attrs:{id:"cross"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cross"}},[_._v("#")]),_._v(" Cross")]),_._v(" "),t("p",[_._v("执行以下命令：")]),_._v(" "),t("p",[t("em",[_._v("r = cross r_student,r_teacher;")])]),_._v(" "),t("p",[t("em",[_._v("dump r;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C03,N0306,72,C04,Dong)")]),_._v(" "),t("p",[_._v("(C03,N0306,72,C03,Wang)")]),_._v(" "),t("p",[_._v("(C03,N0306,72,C02,Sun)")]),_._v(" "),t("p",[_._v("(C03,N0306,72,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C03,N0302,92,C04,Dong)")]),_._v(" "),t("p",[_._v("(C03,N0302,92,C03,Wang)")]),_._v(" "),t("p",[_._v("(C03,N0302,92,C02,Sun)")]),_._v(" "),t("p",[_._v("(C03,N0302,92,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C03,N0301,56,C04,Dong)")]),_._v(" "),t("p",[_._v("(C03,N0301,56,C03,Wang)")]),_._v(" "),t("p",[_._v("(C03,N0301,56,C02,Sun)")]),_._v(" "),t("p",[_._v("(C03,N0301,56,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C02,N0203,79,C04,Dong)")]),_._v(" "),t("p",[_._v("(C02,N0203,79,C03,Wang)")]),_._v(" "),t("p",[_._v("(C02,N0203,79,C02,Sun)")]),_._v(" "),t("p",[_._v("(C02,N0203,79,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C02,N0202,82,C04,Dong)")]),_._v(" "),t("p",[_._v("(C02,N0202,82,C03,Wang)")]),_._v(" "),t("p",[_._v("(C02,N0202,82,C02,Sun)")]),_._v(" "),t("p",[_._v("(C02,N0202,82,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C02,N0201,81,C04,Dong)")]),_._v(" "),t("p",[_._v("(C02,N0201,81,C03,Wang)")]),_._v(" "),t("p",[_._v("(C02,N0201,81,C02,Sun)")]),_._v(" "),t("p",[_._v("(C02,N0201,81,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C01,N0103,65,C04,Dong)")]),_._v(" "),t("p",[_._v("(C01,N0103,65,C03,Wang)")]),_._v(" "),t("p",[_._v("(C01,N0103,65,C02,Sun)")]),_._v(" "),t("p",[_._v("(C01,N0103,65,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C01,N0102,59,C04,Dong)")]),_._v(" "),t("p",[_._v("(C01,N0102,59,C03,Wang)")]),_._v(" "),t("p",[_._v("(C01,N0102,59,C02,Sun)")]),_._v(" "),t("p",[_._v("(C01,N0102,59,C01,Zhang)")]),_._v(" "),t("p",[_._v("(C01,N0101,82,C04,Dong)")]),_._v(" "),t("p",[_._v("(C01,N0101,82,C03,Wang)")]),_._v(" "),t("p",[_._v("(C01,N0101,82,C02,Sun)")]),_._v(" "),t("p",[_._v("(C01,N0101,82,C01,Zhang)")]),_._v(" "),t("p",[_._v("由此可以看出，cross类似于笛卡尔乘积。一般情况下不建议直接使用cross，而应该事前对数据集进行筛选，提高效率。")]),_._v(" "),t("h2",{attrs:{id:"排序-order"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#排序-order"}},[_._v("#")]),_._v(" 排序（Order）")]),_._v(" "),t("p",[_._v("执行以下命令：")]),_._v(" "),t("p",[t("em",[_._v("r = order r_student by score desc, classNo asc;")])]),_._v(" "),t("p",[t("em",[_._v("dump r;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C03,N0302,92)")]),_._v(" "),t("p",[_._v("(C01,N0101,82)")]),_._v(" "),t("p",[_._v("(C02,N0202,82)")]),_._v(" "),t("p",[_._v("(C02,N0201,81)")]),_._v(" "),t("p",[_._v("(C02,N0203,79)")]),_._v(" "),t("p",[_._v("(C03,N0306,72)")]),_._v(" "),t("p",[_._v("(C01,N0103,65)")]),_._v(" "),t("p",[_._v("(C01,N0102,59)")]),_._v(" "),t("p",[_._v("(C03,N0301,56)")]),_._v(" "),t("h2",{attrs:{id:"联合-union"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#联合-union"}},[_._v("#")]),_._v(" 联合（Union）")]),_._v(" "),t("p",[_._v("执行以下语句：")]),_._v(" "),t("p",[t("em",[_._v("r_union = union r_student, r_teacher;")])]),_._v(" "),t("p",[t("em",[_._v("dump r_union;")])]),_._v(" "),t("p",[_._v("结果如下：")]),_._v(" "),t("p",[_._v("(C01,N0101,82)")]),_._v(" "),t("p",[_._v("(C01,N0102,59)")]),_._v(" "),t("p",[_._v("(C01,N0103,65)")]),_._v(" "),t("p",[_._v("(C02,N0201,81)")]),_._v(" "),t("p",[_._v("(C02,N0202,82)")]),_._v(" "),t("p",[_._v("(C02,N0203,79)")]),_._v(" "),t("p",[_._v("(C03,N0301,56)")]),_._v(" "),t("p",[_._v("(C03,N0302,92)")]),_._v(" "),t("p",[_._v("(C03,N0306,72)")]),_._v(" "),t("p",[_._v("(C01,Zhang)")]),_._v(" "),t("p",[_._v("(C02,Sun)")]),_._v(" "),t("p",[_._v("(C03,Wang)")]),_._v(" "),t("p",[_._v("(C04,Dong)")]),_._v(" "),t("p",[_._v("可以看出：")]),_._v(" "),t("p",[_._v("1） union是取两个记录集的并集。")]),_._v(" "),t("p",[_._v("2） 关系r_union的schema为未知（unknown），这是因为被union的两个关系的schema是不一样的。如果两个关系的schema是一致的，则union后的关系将和被union的关系的schema一致。")]),_._v(" "),t("h2",{attrs:{id:"参考文章"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[_._v("#")]),_._v(" 参考文章")]),_._v(" "),t("ul",[t("li",[_._v("https://blog.csdn.net/yz930618/article/details/80701617")]),_._v(" "),t("li",[_._v("https://blog.csdn.net/zythy/article/details/18426347")])])])}),[],!1,null,null,null);v.default=r.exports}}]);