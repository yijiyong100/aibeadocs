(window.webpackJsonp=window.webpackJsonp||[]).push([[503],{1019:function(s,t,a){"use strict";a.r(t);var e=a(53),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("本文主要是介绍 ES-安装和配置 。")])]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#elasticsearch构建全文搜索系统"}},[s._v("Elasticsearch构建全文搜索系统")])]),a("li",[a("a",{attrs:{href:"#前言"}},[s._v("前言")])]),a("li",[a("a",{attrs:{href:"#一、安装"}},[s._v("一、安装")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-安装es"}},[s._v("1.安装es")])]),a("li",[a("a",{attrs:{href:"#_2-启动集群"}},[s._v("2.启动集群")])]),a("li",[a("a",{attrs:{href:"#_3-安装管理界面"}},[s._v("3.安装管理界面")])]),a("li",[a("a",{attrs:{href:"#_4-安装分词插件"}},[s._v("4.安装分词插件")])])])]),a("li",[a("a",{attrs:{href:"#二、使用"}},[s._v("二、使用")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-创建索引"}},[s._v("1.创建索引")])]),a("li",[a("a",{attrs:{href:"#_2-插入数据"}},[s._v("2.插入数据")])]),a("li",[a("a",{attrs:{href:"#_3-批量插入数据"}},[s._v("3.批量插入数据")])]),a("li",[a("a",{attrs:{href:"#_4-查询数据"}},[s._v("4.查询数据")])]),a("li",[a("a",{attrs:{href:"#_5-修改数据"}},[s._v("5.修改数据")])]),a("li",[a("a",{attrs:{href:"#_6-删除数据"}},[s._v("6.删除数据")])]),a("li",[a("a",{attrs:{href:"#_7-索引关闭和开启"}},[s._v("7.索引关闭和开启")])])])]),a("li",[a("a",{attrs:{href:"#总结"}},[s._v("总结")]),a("ul",[a("li",[a("a",{attrs:{href:"#参考文章"}},[s._v("参考文章")])])])])])]),a("p"),s._v(" "),a("h2",{attrs:{id:"elasticsearch构建全文搜索系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch构建全文搜索系统"}},[s._v("#")]),s._v(" Elasticsearch构建全文搜索系统")]),s._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("Elasticsearch 是一个分布式、可扩展、实时的搜索与数据分析引擎，通过它我们可以构建出一个强大的全文搜索系统，解决诸如文章检索慢，商品检索慢、MySQL的like查询慢这样的问题。")]),s._v(" "),a("p",[s._v("Elasticsearch是基于hadoop创始人道哥的另一杰作Lucene实现的，速度非常快，核心是使用了倒排索引这样的结构。关于倒排索引是什么，可以参考"),a("a",{attrs:{href:"https://www.cnblogs.com/chenqionghe/p/12464671.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("搜索引擎中的倒排索引是什么"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("接下来，就以这篇倒排索引中的例子，演示一下ElasticSearch的使用")]),s._v(" "),a("p",[s._v("假设我们有海量文章，如下")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("页码")]),s._v(" "),a("th",[s._v("内容")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("1")]),s._v(" "),a("td",[s._v("生命在于运动")])]),s._v(" "),a("tr",[a("td",[s._v("2")]),s._v(" "),a("td",[s._v("运动是生命的源泉")])]),s._v(" "),a("tr",[a("td",[s._v("3")]),s._v(" "),a("td",[s._v("日复一日地坚持练下去吧,只有活动适量才能保持训练的热情和提高运动的技能.——塞涅卡")])]),s._v(" "),a("tr",[a("td",[s._v("4")]),s._v(" "),a("td",[s._v("活动是生活的基础!——歌德")])]),s._v(" "),a("tr",[a("td",[s._v("5")]),s._v(" "),a("td",[s._v("人的健全,不但靠饮食,尤靠运动")])]),s._v(" "),a("tr",[a("td",[s._v("6")]),s._v(" "),a("td",[s._v("奥林匹克的格言是“更高,更快,更强”")])]),s._v(" "),a("tr",[a("td",[s._v("7")]),s._v(" "),a("td",[s._v("身体的健康因静止不动而破坏,因运动练习而长期保持.——苏格拉底")])]),s._v(" "),a("tr",[a("td",[s._v("8")]),s._v(" "),a("td",[s._v("chenqionghe喜欢运动，绳命是如此的精彩，绳命是如此的辉煌")])])])]),s._v(" "),a("p",[s._v("我们想像这是千万级别的表，最后需要实现传入关键字，返回相应的文章\n例如：搜索"),a("code",[s._v("运动")]),s._v("返回页码"),a("code",[s._v("1,2,3,5,7,8")]),s._v("对应的文章、搜索"),a("code",[s._v("chenqionghe")]),s._v("返回页码为"),a("code",[s._v("8")]),s._v("的文章")]),s._v(" "),a("h2",{attrs:{id:"一、安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装"}},[s._v("#")]),s._v(" 一、安装")]),s._v(" "),a("h3",{attrs:{id:"_1-安装es"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装es"}},[s._v("#")]),s._v(" 1.安装es")]),s._v(" "),a("p",[s._v("查看"),a("a",{attrs:{href:"https://www.elastic.co/cn/downloads/elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网地址"),a("OutboundLink")],1),s._v("，直接下载安装就行了，我用的是mac直接下了mac版本的，另外也可以使用")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("dokcer安装"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("解压后长这样")]),s._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121158088-1387246598.png"),alt:"wxmp"}}),s._v(" "),a("p",[s._v("es依赖java环境，需要指定jdk版本，我们加入一下java相关环境变量")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/Users/chenqionghe/web/elk/elasticsearch-7.6.1/jdk.app/Contents/Home/\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin:"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n")])])]),a("p",[s._v("启动一下看看")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./bin/elasticsearch\n")])])]),a("p",[s._v("看到启动报错")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("uncaught exception "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" thread "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nElasticsearchException"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Failure running machine learning native code. This could be due to running on an unsupported OS or distribution, missing OS libraries, or a problem with the temp directory. To bypass this problem by running Elasticsearch without machine learning functionality "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("xpack.ml.enabled: false"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("p",[s._v("解决办法，修改"),a("code",[s._v("./config/elasticsearch.yml")]),s._v("添加")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" xpack.ml.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])])]),a("p",[s._v("再次启动，成功运行，画风如下\n"),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121208657-929502035.png"),alt:"wxmp"}})]),s._v(" "),a("p",[s._v("默认启动的是9200端口，我们来测试一下")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("➜ ~ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" localhost:9200\n")])])]),a("p",[s._v("可以看到，es可以正常运行起来了\n"),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121216533-1014285671.png"),alt:"wxmp"}})]),s._v(" "),a("h3",{attrs:{id:"_2-启动集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动集群"}},[s._v("#")]),s._v(" 2.启动集群")]),s._v(" "),a("p",[s._v("一般es都是以集群的方式存在，接下我们演示一下启动集群。\n编辑"),a("code",[s._v("./config/elasticsearch.yml")]),s._v("，指定集群名称，集群名称我指定成了chenqionghe")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("cluster.name: chenqionghe\n")])])]),a("p",[s._v("指定节点名称")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ode.name: chenqionghe-1\n")])])]),a("p",[s._v("设置初始化的节点")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("cluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chenqionghe-1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("p",[s._v("设置监听的端口，这里不限定ip，指定为0.0.0.0")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("network.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n")])])]),a("p",[s._v("端口默认9200")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("http.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n")])])]),a("p",[s._v("添加支持elasticsearch-head界面参数")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("http.cors.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nhttp.cors.allow-origin: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\nhttp.cors.allow-methods: OPTIONS, HEAD, GET, POST, PUT, DELETE\nhttp.cors.allow-headers: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Requested-With, Content-Type, Content-Length, X-User"')]),s._v("\n")])])]),a("p",[s._v("再次启动")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./bin/elasticsearch\n")])])]),a("h3",{attrs:{id:"_3-安装管理界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装管理界面"}},[s._v("#")]),s._v(" 3.安装管理界面")]),s._v(" "),a("p",[s._v("elasticsearch-head可以很方便的查看es集群状态，查看官网地址:"),a("a",{attrs:{href:"https://github.com/mobz/elasticsearch-head",target:"_blank",rel:"noopener noreferrer"}},[s._v("elasticsearch-head"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git://github.com/mobz/elasticsearch-head.gitcd elasticsearch-headnpm installnpm run start\n")])])]),a("p",[s._v("打开http://localhost:9100/，如下\n"),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121232262-345797038.png"),alt:"wxmp"}})]),s._v(" "),a("h3",{attrs:{id:"_4-安装分词插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-安装分词插件"}},[s._v("#")]),s._v(" 4.安装分词插件")]),s._v(" "),a("p",[s._v("插件我们使用的是elasticsearch-analysis-ik，参考地址："),a("a",{attrs:{href:"https://github.com/medcl/elasticsearch-analysis-ik/",target:"_blank",rel:"noopener noreferrer"}},[s._v("elasticsearch-analysis-ik/"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./bin/elasticsearch-plugin "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.1/elasticsearch-analysis-ik-7.6.1.zip\n")])])]),a("p",[s._v("验证一下分插件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/_analyze?pretty"')]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{ "analyzer": "ik_smart", "text": "chenqionghe徒手健身" }\'')]),s._v("\n")])])]),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121241769-1518906183.png"),alt:"wxmp"}}),s._v(" "),a("p",[s._v("可以看到，已经可以分词了，oh yeah~")]),s._v(" "),a("h2",{attrs:{id:"二、使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、使用"}},[s._v("#")]),s._v(" 二、使用")]),s._v(" "),a("p",[s._v("ES中有index、document、filed、mapping这样的概念，我们以MySQL的结构为参考对照一下，如下")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("ElasticSearch")]),s._v(" "),a("th",[s._v("MySQL")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("index")]),s._v(" "),a("td",[s._v("表")])]),s._v(" "),a("tr",[a("td",[s._v("document")]),s._v(" "),a("td",[s._v("行")])]),s._v(" "),a("tr",[a("td",[s._v("field")]),s._v(" "),a("td",[s._v("列")])]),s._v(" "),a("tr",[a("td",[s._v("mapping")]),s._v(" "),a("td",[s._v("表结构")])])])]),s._v(" "),a("p",[s._v("Elasticsearch主要还是使用API，具体使用请参考："),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Document APIs"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"_1-创建索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建索引"}},[s._v("#")]),s._v(" 1.创建索引")]),s._v(" "),a("p",[s._v("这里index我取名叫book")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("➜ ~ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X PUT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/book"')]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{        "mappings": {                "properties": {                        "page": {                                "type": "long"                        },                        "content": {                                "type": "text",                                "analyzer": "ik_max_word",                                "search_analyzer": "ik_max_word"                        }                }        }}\'')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"acknowledged"')]),s._v(":true,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shards_acknowledged"')]),s._v(":true,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"book"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("创建成功，但是查看head界面，但是这个黄色不怎么优雅呀，原因是虽然启用了集群，但是还是单节点运行的，群集无法放置副本。\n"),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121250044-1787264960.png"),alt:"wxmp"}})]),s._v(" "),a("p",[s._v("集群的健康状况为 yellow 则表示全部主分片(number_of_shards)都正常运行，但是副本分片没有全部处在正常状态,单节点无论有多少个副本分片（number_of_replicas）都是 unassigned ,它们都没有被分配到任何节点。\n在同一个节点上既保存原始数据又保存副本是没有意义的，因为一旦失去了那个节点，我们也将丢失该节点上的所有副本数据。\n我们需要把这个副本设置为0，因为索引一旦建立，分片数量不能变，我们需要删除再重新建立一下索引")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XDELETE http://localhost:9200/book\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X PUT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/book"')]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n        "settings":{\n            "number_of_shards": "1",\n            "number_of_replicas": "0"\n          },\n        "mappings": {\n                "properties": {\n                        "page": {\n                                "type": "long"\n                        },\n                        "content": {\n                                "type": "text",\n                                "analyzer": "ik_max_word",\n                                "search_analyzer": "ik_max_word"\n                        }\n                }\n        }\n}\'')]),s._v("\n")])])]),a("p",[s._v("再次查看，健康了\n"),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121259943-1586110094.png"),alt:"wxmp"}})]),s._v(" "),a("h3",{attrs:{id:"_2-插入数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-插入数据"}},[s._v("#")]),s._v(" 2.插入数据")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/book/_doc/"')]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n        "page":1,\n        "content": "生命在于运动"\n}\'')]),s._v("\n")])])]),a("p",[s._v("我们可以看到已经成功插入一条数据\n"),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121307920-119753340.png"),alt:"wxmp"}})]),s._v(" "),a("h3",{attrs:{id:"_3-批量插入数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-批量插入数据"}},[s._v("#")]),s._v(" 3.批量插入数据")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/book/_doc/_bulk?pretty"')]),s._v("  -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -d"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{ "index":{} }\n{ "page":2 , "content": "运动是生命的源泉"}\n{ "index":{} }\n{ "page":3 , "content": "日复一日地坚持练下去吧,只有活动适量才能保持训练的热情和提高运动的技能.——塞涅卡"}\n{ "index":{} }\n{ "page":4 , "content": "活动是生活的基础!——歌德"}\n{ "index":{} }\n{ "page":5 , "content": "人的健全,不但靠饮食,尤靠运动"}\n{ "index":{} }\n{ "page":6 , "content": "奥林匹克的格言是“更高,更快,更强”"}\n{ "index":{} }\n{ "page":7 , "content": "身体的健康因静止不动而破坏,因运动练习而长期保持.——苏格拉底"}\n{ "index":{} }\n{ "page":8 , "content": "chenqionghe喜欢运动，绳命是如此的精彩，绳命是如此的辉煌"}\n\'')]),s._v("\n")])])]),a("p",[s._v("可以看到成功批量插入\n"),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121315595-727201784.png"),alt:"wxmp"}})]),s._v(" "),a("h3",{attrs:{id:"_4-查询数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-查询数据"}},[s._v("#")]),s._v(" 4.查询数据")]),s._v(" "),a("ul",[a("li",[s._v("搜索"),a("code",[s._v("chenqionghe")])])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -s -X GET "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/book/_search?pretty'")]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n  "query" : { "match" : { "content" : "chenqionghe" }}\n}\'')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jq\n")])])]),a("p",[s._v("可以看到匹配到了\n"),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121336104-1253296038.png"),alt:"wxmp"}})]),s._v(" "),a("ul",[a("li",[s._v("搜索"),a("code",[s._v("运动")]),s._v("，应该是会返回"),a("code",[s._v("1,2,3,5,7,8")]),s._v("这几条")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -s -XGET "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/book/_search?pretty'")]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n  "query" : { "match" : { "content" : "运动" }}\n}\'')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jq .hits.hits"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jq "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.[]._source'")]),s._v("\n")])])]),a("p",[s._v("可以看到，验证通过\n"),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121343026-1019607932.png"),alt:"wxmp"}})]),s._v(" "),a("h3",{attrs:{id:"_5-修改数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-修改数据"}},[s._v("#")]),s._v(" 5.修改数据")]),s._v(" "),a("p",[s._v("拉下来，我们将chenqionghe这条记录的"),a("code",[s._v("绳命")]),s._v("改为"),a("code",[s._v("生命")]),s._v("，")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/book/_doc/HFn_2XABkofzJYzpQIy4"')]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n    "page":8,\n    "content": "chenqionghe喜欢运动，生命是如此的精彩，生命是如此的辉煌"\n}\'')]),s._v("\n")])])]),a("p",[s._v("可以看到，更新成功\n"),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/es/basic/install/662544-20200315121350113-2124928207.png"),alt:"wxmp"}})]),s._v(" "),a("h3",{attrs:{id:"_6-删除数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-删除数据"}},[s._v("#")]),s._v(" 6.删除数据")]),s._v(" "),a("ul",[a("li",[s._v("根据id删除")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X DELETE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/book/_doc/GFn_2XABkofzJYzpQIy4"')]),s._v("\n")])])]),a("ul",[a("li",[s._v("根据条件删除")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/book/_delete_by_query?pretty"')]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -d"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n  "query": {\n    "match": {\n      "content": "chenqionghe"\n    }\n  }\n}\n\'')]),s._v("\n")])])]),a("h3",{attrs:{id:"_7-索引关闭和开启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-索引关闭和开启"}},[s._v("#")]),s._v(" 7.索引关闭和开启")]),s._v(" "),a("p",[s._v("如果关闭了一个索引，就无法通过ES来读取和写入其中的数据，直到道再次打开它")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XPOST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/book/_close'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 开启")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XPOST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/book/_open'")]),s._v("\n")])])]),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v("通过Elasticsearch，我们可以快速构建出一个强大的全文搜索系统，安装简单，通过API使用也简单。\n倒排索引为搜索而生，先对需要索引的字段进行分词，再通过词直接匹配出文档，速度非常快，这是优点。但是，相比数据库采用的 B 树索引，它的写入和更新性能都比较差，因此倒排索引也只是适合全文搜索，不适合更新频繁的交易类数据。\n总之，安装使用Elasticsearch其实就是这么简单，惊不惊喜，意不意外呀，light weight baby!")]),s._v(" "),a("p",[s._v("更多资料请参考 ：\n"),a("a",{attrs:{href:"https://www.elastic.co/guide/cn/elasticsearch/guide/cn/preface.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Eelasticsearch权威指南"),a("OutboundLink")],1),s._v(" "),a("a",{attrs:{href:"https://www.elastic.co/guide/cn/elasticsearch/php/current/_quickstart.html#_quickstart",target:"_blank",rel:"noopener noreferrer"}},[s._v("Eelasticsearch-PHP"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),a("ul",[a("li",[s._v("https://www.cnblogs.com/chenqionghe/p/12496827.html")])])])}),[],!1,null,null,null);t.default=n.exports}}]);