(window.webpackJsonp=window.webpackJsonp||[]).push([[683],{1199:function(s,t,a){"use strict";a.r(t);var r=a(53),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("本文主要是介绍 MySQL-运维精华操作 。")])]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#mysql运维总结"}},[s._v("MySQL运维总结")])]),a("li",[a("a",{attrs:{href:"#一、本地破解root密码"}},[s._v("一、本地破解root密码")]),a("ul",[a("li",[a("a",{attrs:{href:"#step1-4-停止数据库服务"}},[s._v("Step1/4，停止数据库服务")])]),a("li",[a("a",{attrs:{href:"#step2-4-编辑数据库配置文件"}},[s._v("Step2/4，编辑数据库配置文件")])]),a("li",[a("a",{attrs:{href:"#step3-4-启动数据库服务"}},[s._v("Step3/4，启动数据库服务")])]),a("li",[a("a",{attrs:{href:"#step4-4-root账户登录修改密码"}},[s._v("Step4/4，Root账户登录修改密码")])])])]),a("li",[a("a",{attrs:{href:"#二、常用查看语句"}},[s._v("二、常用查看语句")])]),a("li",[a("a",{attrs:{href:"#三、常用创建及授权语句"}},[s._v("三、常用创建及授权语句")])]),a("li",[a("a",{attrs:{href:"#四、备份还原及执行sql文件等"}},[s._v("四、备份还原及执行SQL文件等")])]),a("li",[a("a",{attrs:{href:"#五、配置文件"}},[s._v("五、配置文件")])]),a("li",[a("a",{attrs:{href:"#参考文章"}},[s._v("参考文章")])])])]),a("p"),s._v(" "),a("h2",{attrs:{id:"mysql运维总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql运维总结"}},[s._v("#")]),s._v(" MySQL运维总结")]),s._v(" "),a("blockquote",[a("p",[s._v("近日支持某项目甲方运维人员做了一些数据整合，项目基于MySQL数据库，部署于客户专用内网的Linux（CentOS 7.6）服务器，这里顺便做一个MySQL常用基础运维命令总结。")])]),s._v(" "),a("h2",{attrs:{id:"一、本地破解root密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、本地破解root密码"}},[s._v("#")]),s._v(" 一、本地破解root密码")]),s._v(" "),a("p",[s._v("由于当前数据库提供给各子项目程序使用的账户仅具有特定库的部分权限，不具备创建新用户，授权、创建或删除库的权限。且原运维人员离职，未交接root账户密码。现运维需创建新用户新库等，以支持数据脱敏工作。总之，需要更高权限，只好本地破解root账户的密码。")]),s._v(" "),a("h3",{attrs:{id:"step1-4-停止数据库服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step1-4-停止数据库服务"}},[s._v("#")]),s._v(" Step1/4，停止数据库服务")]),s._v(" "),a("p",[s._v("killall -TERM mysqld")]),s._v(" "),a("h3",{attrs:{id:"step2-4-编辑数据库配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step2-4-编辑数据库配置文件"}},[s._v("#")]),s._v(" Step2/4，编辑数据库配置文件")]),s._v(" "),a("p",[s._v("vim /etc/my.cnf")]),s._v(" "),a("p",[s._v("在mysqld节添加 skip-grant-tables 。")]),s._v(" "),a("h3",{attrs:{id:"step3-4-启动数据库服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step3-4-启动数据库服务"}},[s._v("#")]),s._v(" Step3/4，启动数据库服务")]),s._v(" "),a("p",[s._v("systemctl restart mysqld.service")]),s._v(" "),a("p",[s._v("这一步遇到一个小问题，数据库启动失败，根据提示查看报错信息，是数据库日志文件没有访问权限，反复确认了日志文件权限配置为 640,mysql,mysql 是没有问题的，最后发现是其所在文件夹权限不对，不知为何被改成了644，修改为755后成功启动数据库服务。")]),s._v(" "),a("h3",{attrs:{id:"step4-4-root账户登录修改密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step4-4-root账户登录修改密码"}},[s._v("#")]),s._v(" Step4/4，Root账户登录修改密码")]),s._v(" "),a("p",[s._v("mysql -uroot -hlocalhost")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" authentication_string"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'newPassword'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" flush "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" quit\n")])])]),a("p",[s._v("如此便完成了root账户的密码修改，然后应关闭数据库服务，将数据库配置还原后再重启数据库服务。需要注意的是，破解操作期间应关闭数据库服务器网络确保安全。")]),s._v(" "),a("h2",{attrs:{id:"二、常用查看语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、常用查看语句"}},[s._v("#")]),s._v(" 二、常用查看语句")]),s._v(" "),a("p",[s._v("查看数据库版本。")]),s._v(" "),a("p",[s._v("select version();")]),s._v(" "),a("p",[s._v("查看某项配置，如连接数设置。")]),s._v(" "),a("p",[s._v("show variables like '%max_connections%';")]),s._v(" "),a("p",[s._v("查看当前连接信息。")]),s._v(" "),a("p",[s._v("show full processlist;")]),s._v(" "),a("p",[s._v("查看当前登录用户。")]),s._v(" "),a("p",[s._v("select user();")]),s._v(" "),a("p",[s._v("查看数据库列表。")]),s._v(" "),a("p",[s._v("show databases;")]),s._v(" "),a("p",[s._v("查看所有库表，需先切换库。")]),s._v(" "),a("p",[s._v("show tables;")]),s._v(" "),a("p",[s._v("查看某个表结构。")]),s._v(" "),a("p",[s._v("desc tablename;")]),s._v(" "),a("p",[s._v("查看数据库用户列表。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("distinct")]),s._v(" concat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'User: '''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'''@'''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''';'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" query "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])])]),a("p",[s._v("查看某用户的权限。")]),s._v(" "),a("p",[s._v("show grants for 'username'@'%';")]),s._v(" "),a("h2",{attrs:{id:"三、常用创建及授权语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、常用创建及授权语句"}},[s._v("#")]),s._v(" 三、常用创建及授权语句")]),s._v(" "),a("p",[s._v("root登录数据库。")]),s._v(" "),a("p",[s._v("mysql -uroot -p -hlocalhost")]),s._v(" "),a("p",[s._v("创建数据库db_test1。")]),s._v(" "),a("p",[s._v("create database db_test1 default charset utf8mb4 collate utf8mb4_general_ci;")]),s._v(" "),a("p",[a("strong",[s._v("创建用户")]),s._v("，命令格式为：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'host'")]),s._v(" identified "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("其中 host 参数指定该用户在哪个主机上可以登陆，可以指定IP，如果是本地用户可用localhost，如果想让该用户可以从任意远程主机登陆，可以使用通配符%。")]),s._v(" "),a("p",[s._v("其中 password 参数为该用户的登陆密码，如果为空则该用户可以不需要密码登陆服务器。")]),s._v(" "),a("p",[s._v("举例，创建数据库新用户db_user1，可远程登录。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db_user1'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" identified "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Abcd@1234'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])])]),a("p",[a("strong",[s._v("为用户授权")]),s._v("，命令格式为：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" databasename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablename "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'host'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("option")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("其中 privileges 参数指定用户的操作权限，如select,insert,update,delete等，如果要授予所有的权限则使用all。")]),s._v(" "),a("p",[s._v("其中 databasename 参数指定数据库名， tablename 参数指定数据库表名，通配符*表示所有。")]),s._v(" "),a("p",[s._v("其中最后的 with grant option 表示此用户可以将权限授权给其它用户。")]),s._v(" "),a("p",[s._v("举例，为db_user1授权全部权限。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" db_user1"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v('@"%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("option")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[a("strong",[s._v("撤销用户权限")]),s._v("，命令格式为：")]),s._v(" "),a("p",[s._v("revoke privilege on databasename.tablename from 'username'@'host';")]),s._v(" "),a("p",[s._v("举例，撤销db_user1对数据库db_test1的删除权限。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("revoke")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" db_test1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db_user1'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("完成权限操作后需执行 flush privileges ; 。")]),s._v(" "),a("p",[a("strong",[s._v("删除用户")]),s._v("，命令格式为：")]),s._v(" "),a("p",[s._v("drop user 'username'@'host';")]),s._v(" "),a("p",[a("strong",[s._v("删除数据库")]),s._v("，命令格式为：")]),s._v(" "),a("p",[s._v("drop database databasename;")]),s._v(" "),a("h2",{attrs:{id:"四、备份还原及执行sql文件等"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、备份还原及执行sql文件等"}},[s._v("#")]),s._v(" 四、备份还原及执行SQL文件等")]),s._v(" "),a("p",[a("strong",[s._v("备份数据库")]),s._v("，命令格式为：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysqldump "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u username "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p databasename "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bak"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("databasebak"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n")])])]),a("p",[s._v("增加 --opt -d，仅备份数据库结构；")]),s._v(" "),a("p",[s._v("增加 -R 参数，可以导出存储过程及自定义函数；")]),s._v(" "),a("p",[s._v("增加 -E 参数，可以导出事件。")]),s._v(" "),a("p",[a("strong",[s._v("还原数据库")]),s._v("，命令格式同执行sql文件：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u username "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p databasename "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bak"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("databasebak"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n")])])]),a("p",[a("strong",[s._v("执行SQL文件")]),s._v("，命令格式为：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u username "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p databasename "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n")])])]),a("p",[s._v("也可以登录并切换至目标库后，使用命令 source /tmp/"),a("strong",[s._v("1")]),s._v(".sql 执行sql文件。")]),s._v(" "),a("p",[s._v("两者的区别是使用source命令执行遇到报错不会中止，而使用<执行遇到报错会中止，所以推荐使用<的方式。")]),s._v(" "),a("p",[a("strong",[s._v("使用pager")]),s._v("将sql执行结果重定向输出到文件，pager是MySQL的一项强大且易用的功能，用法丰富，比如有时需要专网运维在内网帮忙查询生产数据，查询后拍照传递结果，当查询结果数据量稍大时很不方便，这种情况就可以用pager功能将查询结果重定向输出到文件中再发送邮件，避免了Linux系统编码问题、ssh终端编码问题、手机拍照不清晰、多屏内容拍不全等问题。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("pager cat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("log\n")])])]),a("h2",{attrs:{id:"五、配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、配置文件"}},[s._v("#")]),s._v(" 五、配置文件")]),s._v(" "),a("p",[s._v("Centos 7中 MySQL 配置文件位置确认，使用命令：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ps aux|grep mysql|grep 'my.cnf'\n")])])]),a("p",[s._v("如果没有输出内容则是使用默认配置位置。")]),s._v(" "),a("p",[s._v("默认 my.cnf 配置文件的位置，使用命令查看：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--help|grep 'my.cnf' ")]),s._v("\n")])])]),a("p",[s._v("输出结果为：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf、"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf、 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("local")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf、 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf\n")])])]),a("p",[s._v("顺序排前的优先。")]),s._v(" "),a("p",[s._v("下面附一份配置文件 cat /etc/my.cnf ：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndatadir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql\nsocket"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock\n\nsymbolic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("links"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nlog"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\npid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid\n\nsql_mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'")]),s._v("\ncharacter_set_server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("time_zone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'+8:00'")]),s._v("\nlog_timestamps "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SYSTEM\nexplicit_defaults_for_timestamp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("off")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用兼容问题，不能开启")]),s._v("\n\nslow_query_log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nslow_query_log_file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\nlong_query_time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\nserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#只对serverid 配置")]),s._v("\n\nskip"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("resolve\nopen_files_limit"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\ntable_open_cache"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\ntable_open_cache_instances"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# log-bin=/data/mysql-binlog/mysql-bin  # 开启binlog，主库开启，从库不开启。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# relay-log=relay-bin # 从库开启中继日志，主库不开启。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# expire_logs_days = 30   # 过期binlog天数，优化binlog磁盘占用，看情况开启。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# binlog-ignore-db=mysql  # 忽略的数据库，一般不选择。")]),s._v("\n\nbinlog_cache_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("M\nkey_buffer_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("M\nread_buffer_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("M\nmax_connections"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10240")]),s._v("\nmax_allowed_packet"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("M\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#read_only=1 #从库只读开启")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysqlserverip\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test\npassword"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abcd@1234"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqldump"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysqlserverip\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test\npassword"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Abcd@1234"')]),s._v("\n")])])]),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),a("ul",[a("li",[s._v("https://www.cnblogs.com/jiujiduilie/p/14086597.html")])])])}),[],!1,null,null,null);t.default=e.exports}}]);