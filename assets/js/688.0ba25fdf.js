(window.webpackJsonp=window.webpackJsonp||[]).push([[688],{1204:function(s,t,a){"use strict";a.r(t);var r=a(53),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("本文主要是介绍 监控分析-锁问题基础核查 。")])]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#mysql-锁的监控及处理"}},[s._v("MySQL 锁的监控及处理")])]),a("li",[a("a",{attrs:{href:"#故障模拟"}},[s._v("故障模拟")])]),a("li",[a("a",{attrs:{href:"#一-看有没有锁等待"}},[s._v("(一)看有没有锁等待")])]),a("li",[a("a",{attrs:{href:"#二-查看哪个事务在等待-被阻塞了"}},[s._v("(二)查看哪个事务在等待(被阻塞了)")])]),a("li",[a("a",{attrs:{href:"#三-查看锁源-谁锁的我"}},[s._v("(三)查看锁源,谁锁的我")])]),a("li",[a("a",{attrs:{href:"#四-找到锁源的-thread-id"}},[s._v("(四)找到锁源的 thread_id")])]),a("li",[a("a",{attrs:{href:"#五-找到锁源的sql语句"}},[s._v("(五)找到锁源的SQL语句")])]),a("li",[a("a",{attrs:{href:"#快速方法"}},[s._v("快速方法")]),a("ul",[a("li",[a("a",{attrs:{href:"#方法-一"}},[s._v("方法 一")])]),a("li",[a("a",{attrs:{href:"#方法-二"}},[s._v("方法 二")])])])]),a("li",[a("a",{attrs:{href:"#参考文章"}},[s._v("参考文章")])])])]),a("p"),s._v(" "),a("h2",{attrs:{id:"mysql-锁的监控及处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-锁的监控及处理"}},[s._v("#")]),s._v(" MySQL 锁的监控及处理")]),s._v(" "),a("h2",{attrs:{id:"故障模拟"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#故障模拟"}},[s._v("#")]),s._v(" 故障模拟")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加两项配置")]),s._v("\nvi /etc/my.cnf\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[s._v("[mysqld]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("autocommit")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("innodb_lock_wait_timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 3600")]),s._v("\n\nsystemctl restart mysqld\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录数据库")]),s._v("\nuse klvchen;\nUPDATE t1 SET k1"),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("'av' WHERE id=1;")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新开一个窗口，再登录数据库")]),s._v("\nuse klvchen;\nUPDATE t1 SET k1"),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("'az' WHERE id=1;")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时页面卡住")]),s._v("\n")])])]),a("h2",{attrs:{id:"一-看有没有锁等待"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-看有没有锁等待"}},[s._v("#")]),s._v(" (一)看有没有锁等待")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新开一个窗口，登录数据库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'innodb_row_lock%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------+-------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------+-------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Innodb_row_lock_current_waits "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前正在等待锁的数量；")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Innodb_row_lock_time          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从系统启动到现在锁定总时间长度；")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Innodb_row_lock_time_avg      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每次等待所花平均时间；")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Innodb_row_lock_time_max      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从系统启动到现在等待最长的一次所花的时间长度；")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Innodb_row_lock_waits         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 系统启动到现在总共等待的次数；")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------+-------+")]),s._v("\n")])])]),a("h2",{attrs:{id:"二-查看哪个事务在等待-被阻塞了"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-查看哪个事务在等待-被阻塞了"}},[s._v("#")]),s._v(" (二)查看哪个事务在等待(被阻塞了)")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USE")]),s._v(" information_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" information_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("INNODB_TRX "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" trx_state"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'LOCK WAIT'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n                    trx_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14597")]),s._v("                               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 事务ID号")]),s._v("\n                 trx_state: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LOCK")]),s._v(" WAIT                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前事务的状态")]),s._v("\n               trx_started: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n     trx_requested_lock_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14597")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n          trx_wait_started: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n                trx_weight: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n       trx_mysql_thread_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接层的,连接线程ID(SHOW PROCESSLIST ===>Id或trx_id )")]),s._v("\n                 trx_query: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" t1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" k1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'az'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前被阻塞的操作(一般是要丢给开发的)")]),s._v("\n       trx_operation_state: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("starting")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("read")]),s._v("\n         trx_tables_in_use: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n         trx_tables_locked: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n          trx_lock_structs: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n     trx_lock_memory_bytes: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1136")]),s._v("\n           trx_rows_locked: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n         trx_rows_modified: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n   trx_concurrency_tickets: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n       trx_isolation_level: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPEATABLE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("READ")]),s._v("\n         trx_unique_checks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    trx_foreign_key_checks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ntrx_last_foreign_key_error: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n trx_adaptive_hash_latched: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n trx_adaptive_hash_timeout: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n          trx_is_read_only: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ntrx_autocommit_non_locking: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者你可以简单地进行查看")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" trx_state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("trx_started"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("trx_wait_started"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("trx_weight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("trx_rows_locked"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" information_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_trx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 字段说明：")]),s._v("\ntrx_state            事务状态，有以下几种状态：RUNNING、"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LOCK")]),s._v(" WAIT、ROLLING BACK 和 COMMITTING\ntrx_started          事务开始时间\ntrx_wait_started     事务开始等待的时间\ntrx_weight           事务的权重\ntrx_rows_locked      事务锁住的记录数，包含标记为 DELETED，并且已经保存到磁盘但对事务不可见的行\n")])])]),a("h2",{attrs:{id:"三-查看锁源-谁锁的我"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-查看锁源-谁锁的我"}},[s._v("#")]),s._v(" (三)查看锁源,谁锁的我")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_lock_waits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 被锁的和锁定它的之间关系")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n                wait_started: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n                    wait_age: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n               wait_age_secs: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("\n                locked_table: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("klvchen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 哪张表出现的等待 ")]),s._v("\n                locked_index: GEN_CLUST_INDEX\n                 locked_type: RECORD\n              waiting_trx_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14597")]),s._v("                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等待的事务(与上个视图trx_id 对应)")]),s._v("\n         waiting_trx_started: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n             waiting_trx_age: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n     waiting_trx_rows_locked: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n   waiting_trx_rows_modified: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                 waiting_pid: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等待的线程号(与上个视图trx_mysql_thread_id)")]),s._v("\n               waiting_query: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" t1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" k1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'az'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n             waiting_lock_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14597")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n           waiting_lock_mode: X\n             blocking_trx_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14596")]),s._v("                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 锁源的事务ID ")]),s._v("\n                blocking_pid: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("                                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 锁源的线程号")]),s._v("\n              blocking_query: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n            blocking_lock_id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14596")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n          blocking_lock_mode: X\n        blocking_trx_started: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n            blocking_trx_age: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v("\n    blocking_trx_rows_locked: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  blocking_trx_rows_modified: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     sql_kill_blocking_query: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KILL")]),s._v(" QUERY "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nsql_kill_blocking_connection: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KILL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])])]),a("h2",{attrs:{id:"四-找到锁源的-thread-id"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-找到锁源的-thread-id"}},[s._v("#")]),s._v(" (四)找到锁源的 thread_id")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("threads "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" processlist_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n          THREAD_ID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("\n               NAME: thread"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("one_connection\n               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),s._v(": FOREGROUND\n     PROCESSLIST_ID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n   PROCESSLIST_USER: root\n   PROCESSLIST_HOST: localhost\n     PROCESSLIST_DB: klvchen\nPROCESSLIST_COMMAND: Sleep\n   PROCESSLIST_TIME: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("261")]),s._v("\n  PROCESSLIST_STATE: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n   PROCESSLIST_INFO: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" t1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" k1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'av'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n   PARENT_THREAD_ID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n               ROLE: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n       INSTRUMENTED: YES\n            HISTORY: YES\n    CONNECTION_TYPE: Socket\n       THREAD_OS_ID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2557")]),s._v("\n")])])]),a("h2",{attrs:{id:"五-找到锁源的sql语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五-找到锁源的sql语句"}},[s._v("#")]),s._v(" (五)找到锁源的SQL语句")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 当前在执行的语句")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("events_statements_current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" thread_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n              THREAD_ID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("\n               EVENT_ID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n           END_EVENT_ID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n             EVENT_NAME: statement"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v("\n                 SOURCE: \n            TIMER_START: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16785505578000")]),s._v("\n              TIMER_END: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16785741560000")]),s._v("\n             TIMER_WAIT: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("235982000")]),s._v("\n              LOCK_TIME: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("126000000")]),s._v("\n               SQL_TEXT: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" t1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" k1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'av'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n                 DIGEST: c75120019b1993cf2423bd9add827987\n            DIGEST_TEXT: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("t1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("k1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ? "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ? \n         CURRENT_SCHEMA: klvchen\n            OBJECT_TYPE: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n          OBJECT_SCHEMA: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n            OBJECT_NAME: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n  OBJECT_INSTANCE_BEGIN: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n            MYSQL_ERRNO: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n      RETURNED_SQLSTATE: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000")]),s._v("\n           MESSAGE_TEXT: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("matched")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  Changed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Warnings")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ERRORS")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WARNINGS")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n          ROWS_AFFECTED: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n              ROWS_SENT: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n          ROWS_EXAMINED: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nCREATED_TMP_DISK_TABLES: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     CREATED_TMP_TABLES: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n       SELECT_FULL_JOIN: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n SELECT_FULL_RANGE_JOIN: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n           SELECT_RANGE: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     SELECT_RANGE_CHECK: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n            SELECT_SCAN: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n      SORT_MERGE_PASSES: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n             SORT_RANGE: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n              SORT_ROWS: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n              SORT_SCAN: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n          NO_INDEX_USED: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     NO_GOOD_INDEX_USED: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n       NESTING_EVENT_ID: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n     NESTING_EVENT_TYPE: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n    NESTING_EVENT_LEVEL: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 执行语句的历史")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("events_statements_history"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" thread_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("得出结果,丢给开发")]),s._v(" "),a("p",[s._v("表信息")]),s._v(" "),a("p",[s._v("被阻塞的")]),s._v(" "),a("p",[s._v("锁源SQL")]),s._v(" "),a("h2",{attrs:{id:"快速方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速方法"}},[s._v("#")]),s._v(" 快速方法")]),s._v(" "),a("h3",{attrs:{id:"方法-一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法-一"}},[s._v("#")]),s._v(" 方法 一")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看有没有锁表")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'innodb_row_lock%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取正在等待的语句，kill 锁源语句，锁源ID，锁源线程ID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("waiting_query  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'被锁住的SQL语句'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql_kill_blocking_connection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("blocking_pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("THREAD_ID "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'锁源线程ID'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" waiting_query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sql_kill_blocking_connection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" blocking_pid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_lock_waits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" THREAD_ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" PROCESSLIST_ID "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("threads "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" processlist_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" blocking_pid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_lock_waits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" b \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("blocking_pid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("PROCESSLIST_ID "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("THREAD_ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查出锁源 SQL 语句")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" THREAD_ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SQL_TEXT "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'锁源当前执行的SQL语句'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("CURRENT_SCHEMA "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'数据库'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("events_statements_current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" thread_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" THREAD_ID "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("threads pt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" processlist_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" blocking_pid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_lock_waits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"方法-二"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法-二"}},[s._v("#")]),s._v(" 方法 二")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看有没有锁表")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'innodb_row_lock%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取正在等待的语句，kill 锁源语句，锁源ID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" waiting_query "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'被锁住的SQL语句'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("sql_kill_blocking_connection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("blocking_pid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_lock_waits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查找对应关系")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" THREAD_ID "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'锁源线程ID'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" PROCESSLIST_ID "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("threads "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" processlist_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" blocking_pid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_lock_waits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查出锁源 SQL 语句")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" THREAD_ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SQL_TEXT "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'锁源当前执行的SQL语句'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("CURRENT_SCHEMA "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'数据库'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("events_statements_current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" thread_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" THREAD_ID "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("threads pt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" processlist_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" blocking_pid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_lock_waits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),a("ul",[a("li",[s._v("https://www.cnblogs.com/klvchen/p/12076019.html")])])])}),[],!1,null,null,null);t.default=e.exports}}]);