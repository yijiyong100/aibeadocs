(window.webpackJsonp=window.webpackJsonp||[]).push([[694],{1210:function(s,t,a){"use strict";a.r(t);var e=a(53),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("本文主要是介绍 监控分析-慢SQL辅助工具 。")])]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#mysql慢日志查询分析方法与工具"}},[s._v("MySQL慢日志查询分析方法与工具")])]),a("li",[a("a",{attrs:{href:"#mysql日志介绍"}},[s._v("MySQL日志介绍")])]),a("li",[a("a",{attrs:{href:"#启用-slow-log"}},[s._v("启用 slow log")]),a("ul",[a("li",[a("a",{attrs:{href:"#比较的五款常用工具"}},[s._v("比较的五款常用工具")])])])]),a("li",[a("a",{attrs:{href:"#慢sql日志查看"}},[s._v("慢SQL日志查看")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-1-简介"}},[s._v("1.1 简介")])]),a("li",[a("a",{attrs:{href:"#_1-2-登录数据库查看"}},[s._v("1.2 登录数据库查看")])]),a("li",[a("a",{attrs:{href:"#_1-2-1-进入mysql-查询是否开了慢查询"}},[s._v("1.2.1 进入MySql 查询是否开了慢查询")])]),a("li",[a("a",{attrs:{href:"#_1-2-2-查看慢查询超时时间"}},[s._v("1.2.2 查看慢查询超时时间")])]),a("li",[a("a",{attrs:{href:"#_1-3-修改方法1-不推荐"}},[s._v("1.3 修改方法1：（不推荐）")])]),a("li",[a("a",{attrs:{href:"#_1-3-1-查看是否开启慢查询"}},[s._v("1.3.1 查看是否开启慢查询")])]),a("li",[a("a",{attrs:{href:"#_1-3-2-再次查看"}},[s._v("1.3.2 再次查看")])]),a("li",[a("a",{attrs:{href:"#_1-4-修改方法2-推荐"}},[s._v("1.4 修改方法2：（推荐）")])]),a("li",[a("a",{attrs:{href:"#_1-4-1-1-修改"}},[s._v("1.4.1.1 修改")])]),a("li",[a("a",{attrs:{href:"#_1-5-查看、测试"}},[s._v("1.5 查看、测试")])]),a("li",[a("a",{attrs:{href:"#_1-5-1-1-插入一条测试慢查询"}},[s._v("1.5.1.1 插入一条测试慢查询")])]),a("li",[a("a",{attrs:{href:"#_1-5-1-2-查看慢查询日志"}},[s._v("1.5.1.2 查看慢查询日志")])]),a("li",[a("a",{attrs:{href:"#_1-5-1-3-通过mysql命令查看有多少慢查询"}},[s._v("1.5.1.3 通过MySQL命令查看有多少慢查询")])]),a("li",[a("a",{attrs:{href:"#_1-6-日志分析工具mysqldumpslow"}},[s._v("1.6 日志分析工具mysqldumpslow")])])])]),a("li",[a("a",{attrs:{href:"#慢sql日志分析工具比较"}},[s._v("慢SQL日志分析工具比较")]),a("ul",[a("li",[a("a",{attrs:{href:"#mysqldumpslow"}},[s._v("mysqldumpslow")])]),a("li",[a("a",{attrs:{href:"#mysqlsla"}},[s._v("mysqlsla")])]),a("li",[a("a",{attrs:{href:"#mysql-explain-slow-log"}},[s._v("mysql-explain-slow-log")])]),a("li",[a("a",{attrs:{href:"#mysql-log-filter"}},[s._v("mysql-log-filter")])]),a("li",[a("a",{attrs:{href:"#myprofi"}},[s._v("myprofi")])]),a("li",[a("a",{attrs:{href:"#工具推荐比较总结"}},[s._v("工具推荐比较总结")])])])]),a("li",[a("a",{attrs:{href:"#参考文章"}},[s._v("参考文章")])])])]),a("p"),s._v(" "),a("h2",{attrs:{id:"mysql慢日志查询分析方法与工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql慢日志查询分析方法与工具"}},[s._v("#")]),s._v(" MySQL慢日志查询分析方法与工具")]),s._v(" "),a("h2",{attrs:{id:"mysql日志介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql日志介绍"}},[s._v("#")]),s._v(" MySQL日志介绍")]),s._v(" "),a("p",[s._v("MySQL中的日志包括：错误日志、二进制日志、通用查询日志、慢查询日志等等。这里主要介绍下比较常用的两个功能：通用查询日志和慢查询日志。")]),s._v(" "),a("p",[s._v("1）通用查询日志：记录建立的客户端连接和执行的语句。")]),s._v(" "),a("p",[s._v("2）慢查询日志：记录所有执行时间超过long_query_time秒的所有查询或者不使用索引的查询")]),s._v(" "),a("p",[s._v("MySQL日志文件系统的组成")]),s._v(" "),a("ul",[a("li",[s._v("a、"),a("a",{attrs:{href:"http://blog.csdn.net/leshami/article/details/39759849",target:"_blank",rel:"noopener noreferrer"}},[s._v("错误日志"),a("OutboundLink")],1),s._v("：记录启动、运行或停止mysqld时出现的问题。")]),s._v(" "),a("li",[s._v("b、"),a("a",{attrs:{href:"http://blog.csdn.net/leshami/article/details/39779225",target:"_blank",rel:"noopener noreferrer"}},[s._v("通用日志"),a("OutboundLink")],1),s._v("：记录建立的客户端连接和执行的语句。")]),s._v(" "),a("li",[s._v("c、更新日志：记录更改数据的语句。该日志在MySQL 5.1中已不再使用。")]),s._v(" "),a("li",[s._v("d、"),a("a",{attrs:{href:"http://blog.csdn.net/leshami/article/details/39801867",target:"_blank",rel:"noopener noreferrer"}},[s._v("二进制日志"),a("OutboundLink")],1),s._v("：记录所有更改数据的语句。还用于复制。")]),s._v(" "),a("li",[s._v("e、"),a("a",{attrs:{href:"http://write.blog.csdn.net/postedit/39829605",target:"_blank",rel:"noopener noreferrer"}},[s._v("慢查询日志"),a("OutboundLink")],1),s._v("：记录所有执行时间超过long_query_time秒的所有查询或不使用索引的查询。")]),s._v(" "),a("li",[s._v("f、Innodb日志：innodb redo log")])]),s._v(" "),a("p",[s._v("缺省情况下，所有日志创建于mysqld数据目录中。")]),s._v(" "),a("ul",[a("li",[s._v("可以通过刷新日志，来强制mysqld来关闭和重新打开日志文件（或者在某些情况下切换到一个新的日志）。")]),s._v(" "),a("li",[s._v("当你执行一个FLUSH LOGS语句或执行mysqladmin flush-logs或mysqladmin refresh时，则日志被老化。")]),s._v(" "),a("li",[s._v("对于存在MySQL复制的情形下，从复制服务器将维护更多日志文件，被称为接替日志。")])]),s._v(" "),a("p",[s._v("同大多数关系型数据库一样，日志文件是MySQL数据库的重要组成部分。MySQL有几种不同的日志文件，通常包括错误日志文件，二进制日志，通用日志，慢查询日志，等等。这些日志可以帮助我们定位mysqld内部发生的事件，数据库性能故障，记录数据的变更历史，用户恢复数据库等等。今天我们要讲的是如何分析和查询mysql慢日志（主要影响程序调用和前端数据呈现）。")]),s._v(" "),a("p",[s._v("mysql slow log 是用来记录执行时间较长(超过long_query_time秒)的sql的一种日志工具")]),s._v(" "),a("h2",{attrs:{id:"启用-slow-log"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启用-slow-log"}},[s._v("#")]),s._v(" 启用 slow log")]),s._v(" "),a("p",[s._v("有两种启用方式:")]),s._v(" "),a("p",[s._v("1, 在my.cnf 里 通过 log-slow-queries[=file_name]")]),s._v(" "),a("p",[s._v("2, 在mysqld进程启动时,指定--log-slow-queries[=file_name]选项")]),s._v(" "),a("h3",{attrs:{id:"比较的五款常用工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#比较的五款常用工具"}},[s._v("#")]),s._v(" 比较的五款常用工具")]),s._v(" "),a("p",[s._v("mysqldumpslow, mysqlsla, myprofi, mysql-explain-slow-log, mysqllogfilter")]),s._v(" "),a("p",[s._v("开源的MySQL慢日志查询监控工")]),s._v(" "),a("p",[s._v("pmm server、Navicat、mysqltop（天兔Lepus）、Box Anemometer、explain、pt-query-digest")]),s._v(" "),a("p",[s._v("慢查询日志")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("慢查询日志是将mysql服务器中影响数据库性能的相关SQL语句记录到日志文件，通过对这些特殊的SQL语句分析，改进以达到提高数据库性能的目的。")])]),s._v(" "),a("li",[a("p",[s._v("通过使用--slow_query_log[={0|1}]选项来启用慢查询日志。所有执行时间超过long_query_time秒的SQL语句都会被记录到慢查询日志。")])]),s._v(" "),a("li",[a("p",[s._v("缺省情况下hostname-slow.log为慢查询日志文件安名，存放到数据目录，同时缺省情况下未开启慢查询日志。")])]),s._v(" "),a("li",[a("p",[s._v("缺省情况下数据库相关管理型SQL(比如OPTIMIZE TABLE、ANALYZE TABLE和ALTER TABLE)不会被记录到日志。")])]),s._v(" "),a("li",[a("p",[s._v("对于管理型SQL可以通过--log-slow-admin-statements开启记录管理型慢SQL。")])]),s._v(" "),a("li",[a("p",[s._v("mysqld在语句执行完并且所有锁释放后记入慢查询日志。记录顺序可以与执行顺序不相同。获得初使表锁定的时间不算作执行时间。")])]),s._v(" "),a("li",[a("p",[s._v("可以使用mysqldumpslow命令获得日志中显示的查询摘要来处理慢查询日志。")])]),s._v(" "),a("li",[a("p",[s._v("用查询缓存处理的查询不加到慢查询日志中，表有零行或一行而不能从索引中受益的查询也不写入慢查询日志。")])]),s._v(" "),a("li",[a("p",[s._v("MySQL服务器按以下顺序记录SQL是否写入到慢查询日志\na. The query must either not be an administrative statement, or --log-slow-adminstatements must have been specified.\nb. The query must have taken at least long_query_time seconds, or log_queries_not_using_indexes must be enabled and the query used no indexes for row lookups.\nc. The query must have examined at least min_examined_row_limit rows.\nd. The query must not be suppressed according to the log_throttle_queries_not_using_indexes setting.## dumpslow 慢查询的工具")])])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.2cto.com/database/MySQL/",target:"_blank",rel:"noopener noreferrer"}},[s._v("mysql"),a("OutboundLink")],1),s._v("dumpslow是mysql自带的用来分析慢查询的工具，当然不止这一种工具，还有percona-toolkit是percona公司出的一组命令行工具的集合，用来执行各种通过手工执行非常复杂和麻烦的mysql相关任务，包含以下内容：")]),s._v(" "),a("p",[s._v("检查master和slave数据一致性/记录有效的归档/服务器信息汇总/分析和统计日志,为了省事这块使用mysqldumpslow命令做分析。")]),s._v(" "),a("p",[s._v("需要开启mysql的慢查询日志，否则无法进行统计分析，开启mysql慢查询日志需要在mysql的配置文件中进行如下配置：")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("slow_query_log")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("1#定义超过1秒的查询计数到变量Slow_queries")]),s._v("\n        \n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("slow-query-log-file")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("mysql-slow.log")]),s._v("\n        \n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("long_query_time")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("1")]),s._v("\n")])])]),a("h2",{attrs:{id:"慢sql日志查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#慢sql日志查看"}},[s._v("#")]),s._v(" 慢SQL日志查看")]),s._v(" "),a("h3",{attrs:{id:"_1-1-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-简介"}},[s._v("#")]),s._v(" 1.1 简介")]),s._v(" "),a("p",[s._v("开启慢查询日志，可以让MySQL记录下查询超过指定时间的语句，通过定位分析性能的瓶颈，才能更好的优化数据库系统的性能。")]),s._v(" "),a("h3",{attrs:{id:"_1-2-登录数据库查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-登录数据库查看"}},[s._v("#")]),s._v(" 1.2 登录数据库查看")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost lib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql –uroot")]),s._v("\n")])])]),a("p",[s._v("因为没有设置设置密码，有密码的在 mysql –uroot –p 接密码")]),s._v(" "),a("h3",{attrs:{id:"_1-2-1-进入mysql-查询是否开了慢查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-进入mysql-查询是否开了慢查询"}},[s._v("#")]),s._v(" 1.2.1 进入MySql 查询是否开了慢查询")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slow_query%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------+--------------------------------------------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------+--------------------------------------------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("application"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------+--------------------------------------------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("参数说明：")]),s._v(" "),a("ol",[a("li",[s._v("slow_query_log 慢查询开启状态 OFF 未开启 ON 为开启")]),s._v(" "),a("li",[s._v("slow_query_log_file 慢查询日志存放的位置（这个目录需要MySQL的运行帐号的可写权限，一般设置为MySQL的数据存放目录）")])]),s._v(" "),a("h3",{attrs:{id:"_1-2-2-查看慢查询超时时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-查看慢查询超时时间"}},[s._v("#")]),s._v(" 1.2.2 查看慢查询超时时间")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'long%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+-----------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+-----------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" long_query_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.000000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+-----------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("long_query_time 查询超过多少秒才记录  默认10秒 修改为1秒")]),s._v(" "),a("h3",{attrs:{id:"_1-3-修改方法1-不推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-修改方法1-不推荐"}},[s._v("#")]),s._v(" 1.3 修改方法1：（不推荐）")]),s._v(" "),a("p",[s._v("方法一：优点临时开启慢查询，不需要重启数据库 缺点：MySql 重启慢查询失效")]),s._v(" "),a("p",[s._v("推荐：根据业务需求，建议使用第二种，临时可以用第一种")]),s._v(" "),a("p",[s._v("默认情况下slow_query_log的值为OFF，表示慢查询日志是禁用的，可以通过设置slow_query_log的值来开启，如下所示：：是否开启慢查询日志，1表示开启，0表示关闭。")]),s._v(" "),a("h3",{attrs:{id:"_1-3-1-查看是否开启慢查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-查看是否开启慢查询"}},[s._v("#")]),s._v(" 1.3.1 查看是否开启慢查询")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%slow_query_log%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------+--------------------------------------------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------+--------------------------------------------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("application"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------+--------------------------------------------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("输入 语句修改（重启后失效，建议在/etc/my.cnf中修改永久生效）")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" slow_query_log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \nQuery OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.11")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h3",{attrs:{id:"_1-3-2-再次查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-再次查看"}},[s._v("#")]),s._v(" 1.3.2 再次查看")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%slow_query_log%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------+--------------------------------------------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------+--------------------------------------------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("application"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------+--------------------------------------------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h3",{attrs:{id:"_1-4-修改方法2-推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-修改方法2-推荐"}},[s._v("#")]),s._v(" 1.4 修改方法2：（推荐）")]),s._v(" "),a("p",[s._v("修改 MySql 慢查询，好多人不知道my.cnf 路径，可以用 find 查找")]),s._v(" "),a("p",[s._v("备注：我的MySQL 是编译的 路径为 /etc/my.cnf （一般都是这里）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# find / -type f -name "my.cnf"')]),s._v("\n\n/application/mysql-5.5.51/mysql-test/suite/rpl/my.cnf\n\n/application/mysql-5.5.51/mysql-test/suite/federated/my.cnf\n\n/application/mysql-5.5.51/mysql-5.5.51-linux2.6-x86_64/mysql-test/suite/rpl/my.cnf\n\n/application/mysql-5.5.51/mysql-5.5.51-linux2.6-x86_64/mysql-test/suite/federated/my.cnf\n\n/etc/my.cnf  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###（一般都是这里）")]),s._v("\n")])])]),a("h3",{attrs:{id:"_1-4-1-1-修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-1-1-修改"}},[s._v("#")]),s._v(" 1.4.1.1 修改")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/my.cnf")]),s._v("\n")])])]),a("p",[s._v("找到 [mysqld] 下面添加")]),s._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("slow_query_log")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("slow_query_log_file")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("/application/mysql/data/localhost-slow.log")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("long_query_time")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 1")]),s._v("\n")])])]),a("p",[s._v("参数说明：")]),s._v(" "),a("ol",[a("li",[s._v("slow_query_log 慢查询开启状态 1 为开启")]),s._v(" "),a("li",[s._v("slow_query_log_file 慢查询日志存放的位置")]),s._v(" "),a("li",[s._v("long_query_time 查询超过多少秒才记录  默认10秒 修改为1秒")])]),s._v(" "),a("p",[s._v("修改完重启MySQL")]),s._v(" "),a("h3",{attrs:{id:"_1-5-查看、测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-查看、测试"}},[s._v("#")]),s._v(" 1.5 查看、测试")]),s._v(" "),a("h3",{attrs:{id:"_1-5-1-1-插入一条测试慢查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-1-1-插入一条测试慢查询"}},[s._v("#")]),s._v(" 1.5.1.1 插入一条测试慢查询")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h3",{attrs:{id:"_1-5-1-2-查看慢查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-1-2-查看慢查询日志"}},[s._v("#")]),s._v(" 1.5.1.2 查看慢查询日志")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /application/mysql/data/localhost-slow.log")]),s._v("\n\n/application/mysql/bin/mysqld, Version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.5")]),s._v(".51-log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MySQL Community Server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GPL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(". started with:\n\nTcp port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" Unix socket: /tmp/mysql.sock\n\nTime         Id Command  Argument\n\n/application/mysql/bin/mysqld, Version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.5")]),s._v(".51-log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MySQL Community Server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GPL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(". started with:\n\nTcp port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" Unix socket: /tmp/mysql.sock\n\nTime         Id Command  Argument\n\n/application/mysql/bin/mysqld, Version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.5")]),s._v(".51-log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MySQL Community Server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GPL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(". started with:\n\nTcp port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" Unix socket: /tmp/mysql.sock\n\nTime         Id Command  Argument\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Time: 170605 6:37:00")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# User@Host: root[root] @ localhost []")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Query_time: 2.000835 Lock_time: 0.000000 Rows_sent: 1 Rows_examined: 0")]),s._v("\n\nSET "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("timestamp")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1496615820")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_1-5-1-3-通过mysql命令查看有多少慢查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-1-3-通过mysql命令查看有多少慢查询"}},[s._v("#")]),s._v(" 1.5.1.3 通过MySQL命令查看有多少慢查询")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%Slow_queries%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Slow_queries "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-------+")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n")])])]),a("h3",{attrs:{id:"_1-6-日志分析工具mysqldumpslow"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-日志分析工具mysqldumpslow"}},[s._v("#")]),s._v(" 1.6 日志分析工具mysqldumpslow")]),s._v(" "),a("p",[s._v("在生产环境中，如果要手工分析日志，查找、分析SQL，显然是个体力活，MySQL提供了日志分析工具mysqldumpslow")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%slow%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+---------------------+-------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------+-------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" log_slow_queries  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ON            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_launch_time  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ON             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" D:/log/slow.txt    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------+-------------------------+\n\n其中,各参数说明如下:\n\nslow_launch_time: 慢查询超过的执行时间值\n\nslow_query_log: 是否打开慢查询日志功能\n\nshow_query_log_file:慢查询日志目录 \n\n开启慢查询日志功能:\n\nmysql配置文件"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("win mysql.ini linux mysql.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("下,\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nlog-slow-queries "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:/xampp/mysql/long.txt"')]),s._v("\nlong_query_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\nlog-slow-queries"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql/slowquery.log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("指定日志文件存放位置，可以为空，系统会给一个缺省的文件host_name-slow.log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("long_query_time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("记录超过的时间，默认为10s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlog-queries-not-using-indexes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("log下来没有使用索引的query,可以根据情况决定是否开启"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlog-long-format "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("如果设置了，所有没有使用索引的查询也将被记录"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 不同的慢查询日志分析工具比对 ")]),s._v("\n")])])]),a("h2",{attrs:{id:"慢sql日志分析工具比较"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#慢sql日志分析工具比较"}},[s._v("#")]),s._v(" 慢SQL日志分析工具比较")]),s._v(" "),a("h3",{attrs:{id:"mysqldumpslow"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysqldumpslow"}},[s._v("#")]),s._v(" mysqldumpslow")]),s._v(" "),a("p",[s._v("mysql官方提供的慢查询日志分析工具. 输出图表如下:")]),s._v(" "),a("p",[s._v("主要功能是, 统计不同慢sql的")]),s._v(" "),a("p",[s._v("出现次数(Count),")]),s._v(" "),a("p",[s._v("执行最长时间(Time),")]),s._v(" "),a("p",[s._v("累计总耗费时间(Time),")]),s._v(" "),a("p",[s._v("等待锁的时间(Lock),")]),s._v(" "),a("p",[s._v("发送给客户端的行总数(Rows),")]),s._v(" "),a("p",[s._v("扫描的行总数(Rows),")]),s._v(" "),a("p",[s._v("用户以及sql语句本身(抽象了一下格式, 比如 limit 1, 20 用 limit N,N 表示).")]),s._v(" "),a("h3",{attrs:{id:"mysqlsla"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysqlsla"}},[s._v("#")]),s._v(" mysqlsla")]),s._v(" "),a("p",[s._v("hackmysql.com推出的一款日志分析工具(该网站还维护了 mysqlreport, mysqlidxchk 等比较实用的mysql工具)")]),s._v(" "),a("p",[s._v("整体来说, 功能非常强大. 数据报表,非常有利于分析慢查询的原因, 包括执行频率, 数据量, 查询消耗等.")]),s._v(" "),a("p",[s._v("格式说明如下:")]),s._v(" "),a("p",[s._v("总查询次数 (queries total), 去重后的sql数量 (unique)")]),s._v(" "),a("p",[s._v("输出报表的内容排序(sorted by)")]),s._v(" "),a("p",[s._v("最重大的慢sql统计信息, 包括 平均执行时间, 等待锁时间, 结果行的总数, 扫描的行总数.")]),s._v(" "),a("p",[s._v("Count, sql的执行次数及占总的slow log数量的百分比.")]),s._v(" "),a("p",[s._v("Time, 执行时间, 包括总时间, 平均时间, 最小, 最大时间, 时间占到总慢sql时间的百分比.")]),s._v(" "),a("p",[s._v("95% of Time, 去除最快和最慢的sql, 覆盖率占95%的sql的执行时间.")]),s._v(" "),a("p",[s._v("Lock Time, 等待锁的时间.")]),s._v(" "),a("p",[s._v("95% of Lock , 95%的慢sql等待锁时间.")]),s._v(" "),a("p",[s._v("Rows sent, 结果行统计数量, 包括平均, 最小, 最大数量.\nRows examined, 扫描的行数量.")]),s._v(" "),a("p",[s._v("Database, 属于哪个数据库")]),s._v(" "),a("p",[s._v("Users, 哪个用户,IP, 占到所有用户执行的sql百分比")]),s._v(" "),a("p",[s._v("Query abstract, 抽象后的sql语句")]),s._v(" "),a("p",[s._v("Query sample, sql语句")]),s._v(" "),a("p",[s._v("除了以上的输出, 官方还提供了很多定制化参数, 是一款不可多得的好工具.")]),s._v(" "),a("h3",{attrs:{id:"mysql-explain-slow-log"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-explain-slow-log"}},[s._v("#")]),s._v(" mysql-explain-slow-log")]),s._v(" "),a("p",[s._v("德国人写的一个perl脚本.\nhttp://www.willamowius.de/mysql-tools.html")]),s._v(" "),a("p",[s._v("功能上有点瑕疵, 不仅把所有的 slow log 打印到屏幕上, 而且统计也只有数量而已. 不推荐使用.")]),s._v(" "),a("h3",{attrs:{id:"mysql-log-filter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-log-filter"}},[s._v("#")]),s._v(" mysql-log-filter")]),s._v(" "),a("p",[s._v("google code上找到的一个分析工具.提供了 python 和 php 两种可执行的脚本.\nhttp://code.google.com/p/mysql-log-filter/")]),s._v(" "),a("p",[s._v("功能上比官方的mysqldumpslow, 多了查询时间的统计信息(平均,最大, 累计), 其他功能都与 mysqldumpslow类似.\n特色功能除了统计信息外, 还针对输出内容做了排版和格式化, 保证整体输出的简洁. 喜欢简洁报表的朋友, 推荐使用一下.")]),s._v(" "),a("h3",{attrs:{id:"myprofi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#myprofi"}},[s._v("#")]),s._v(" myprofi")]),s._v(" "),a("p",[s._v("纯php写的一个开源分析工具.项目在 sourceforge 上.\nhttp://myprofi.sourceforge.net/")]),s._v(" "),a("p",[s._v("功能上, 列出了总的慢查询次数和类型, 去重后的sql语句, 执行次数及其占总的slow log数量的百分比.\n从整体输出样式来看, 比mysql-log-filter还要简洁. 省去了很多不必要的内容. 对于只想看sql语句及执行次数的用户来说, 比较推荐.")]),s._v(" "),a("h3",{attrs:{id:"工具推荐比较总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工具推荐比较总结"}},[s._v("#")]),s._v(" 工具推荐比较总结")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("工具/功能")]),s._v(" "),a("th",[s._v("一般统计信息")]),s._v(" "),a("th",[s._v("高级统计信息")]),s._v(" "),a("th",[s._v("脚本")]),s._v(" "),a("th",[s._v("优势")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("mysqldumpslow")]),s._v(" "),a("td",[s._v("支持")]),s._v(" "),a("td",[s._v("不支持")]),s._v(" "),a("td",[s._v("perl")]),s._v(" "),a("td",[s._v("mysql官方自带")])]),s._v(" "),a("tr",[a("td",[s._v("mysqlsla")]),s._v(" "),a("td",[s._v("支持")]),s._v(" "),a("td",[s._v("支持")]),s._v(" "),a("td",[s._v("perl")]),s._v(" "),a("td",[s._v("功能强大,数据报表齐全,定制化能力强.")])]),s._v(" "),a("tr",[a("td",[s._v("mysql-explain-slow-log")]),s._v(" "),a("td",[s._v("支持")]),s._v(" "),a("td",[s._v("不支持")]),s._v(" "),a("td",[s._v("perl")]),s._v(" "),a("td",[s._v("无")])]),s._v(" "),a("tr",[a("td",[s._v("mysql-log-filter")]),s._v(" "),a("td",[s._v("支持")]),s._v(" "),a("td",[s._v("部分支持")]),s._v(" "),a("td",[s._v("python or php")]),s._v(" "),a("td",[s._v("不失功能的前提下,保持输出简洁")])]),s._v(" "),a("tr",[a("td",[s._v("myprofi")]),s._v(" "),a("td",[s._v("支持")]),s._v(" "),a("td",[s._v("不支持")]),s._v(" "),a("td",[s._v("php")]),s._v(" "),a("td",[s._v("非常精简")])])])]),s._v(" "),a("p",[s._v("【参考资料】")]),s._v(" "),a("p",[s._v("1、MySQL 慢查询日志分析及可视化结果 – 运维生存时间 http://www.ttlsa.com/mysql/mysql-slow-query-log-analysis-and-visualization-of-results/")]),s._v(" "),a("p",[s._v("2、Mysql 慢日志分析系统搭建 —— Box Anemometer_SleePerSir_新浪博客 http://blog.sina.com.cn/s/blog_c2839d2a0102wkuv.html")]),s._v(" "),a("p",[s._v("3、mysql性能监控软件 慢日志分析利器 - pmm server https://blog.csdn.net/john1337/article/details/70855293")]),s._v(" "),a("p",[s._v("4、MySQL 慢查询日志(Slow Query Log) - CSDN博客 https://blog.csdn.net/leshami/article/details/39829605")]),s._v(" "),a("p",[s._v("5、关于MySQL 通用查询日志和慢查询日志分析 - CSDN博客 https://blog.csdn.net/timchen525/article/details/75268151")]),s._v(" "),a("p",[s._v("6、mysql 慢日志分析工具pt-query-digest - CSDN博客 https://blog.csdn.net/stevendbaguo/article/details/47612359")]),s._v(" "),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),a("ul",[a("li",[s._v("https://blog.csdn.net/enweitech/article/details/80239189")])])])}),[],!1,null,null,null);t.default=r.exports}}]);