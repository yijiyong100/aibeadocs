(window.webpackJsonp=window.webpackJsonp||[]).push([[698],{1214:function(s,t,a){"use strict";a.r(t);var e=a(53),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("本文主要是介绍 主从复制-Centos操作案例 。")])]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#mysql数据库的主从同步"}},[s._v("mysql数据库的主从同步")])]),a("li",[a("a",{attrs:{href:"#前言"}},[s._v("前言")])]),a("li",[a("a",{attrs:{href:"#_1-分别在两台centos-7系统上安装mysql-5-7"}},[s._v("1 分别在两台centos 7系统上安装mysql 5.7")])]),a("li",[a("a",{attrs:{href:"#_2-master主服务器的配置"}},[s._v("2 master主服务器的配置")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-1-配置文件my-cnf的修改"}},[s._v("2.1 配置文件my.cnf的修改")])]),a("li",[a("a",{attrs:{href:"#_2-2-创建从服务器的用户和权限"}},[s._v("2.2 创建从服务器的用户和权限")])]),a("li",[a("a",{attrs:{href:"#_2-3-重启mysql服务"}},[s._v("2.3 重启mysql服务")])]),a("li",[a("a",{attrs:{href:"#_2-4-查看主服务器状态"}},[s._v("2.4 查看主服务器状态")])])])]),a("li",[a("a",{attrs:{href:"#_3-slave从服务器的配置"}},[s._v("3 slave从服务器的配置")]),a("ul",[a("li",[a("a",{attrs:{href:"#_3-1-配置文件my-cnf的修改"}},[s._v("3.1 配置文件my.cnf的修改")])]),a("li",[a("a",{attrs:{href:"#_3-2-重启mysql服务"}},[s._v("3.2 重启mysql服务")])]),a("li",[a("a",{attrs:{href:"#_3-3-连接master主服务器"}},[s._v("3.3 连接master主服务器")])]),a("li",[a("a",{attrs:{href:"#_3-4-启动slave数据同步"}},[s._v("3.4 启动slave数据同步")])]),a("li",[a("a",{attrs:{href:"#_3-5-查看slave信息"}},[s._v("3.5 查看slave信息")])])])]),a("li",[a("a",{attrs:{href:"#_4-测试"}},[s._v("4 测试")])]),a("li",[a("a",{attrs:{href:"#_5-解决错误"}},[s._v("5 解决错误")])]),a("li",[a("a",{attrs:{href:"#_6-总结"}},[s._v("6 总结")]),a("ul",[a("li",[a("a",{attrs:{href:"#参考文章"}},[s._v("参考文章")])])])])])]),a("p"),s._v(" "),a("h2",{attrs:{id:"mysql数据库的主从同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql数据库的主从同步"}},[s._v("#")]),s._v(" mysql数据库的主从同步")]),s._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("大型网站为了软解大量的并发访问，除了在网站实现分布式负载均衡，远远不够。到了数据业务层、数据访问层，如果还是传统的数据结构，或者只是单单靠一台服务器来处理如此多的数据库连接操作，数据库必然会崩溃，特别是数据丢失的话，后果更是不堪设想。这时候，我们会考虑如何减少数据库的连接，下面就进入我们今天的主题。")]),s._v(" "),a("p",[s._v("利用主从数据库来实现读写分离，从而分担主数据库的压力。在多个服务器上部署mysql，将其中一台认为主数据库，而其他为从数据库，实现主从同步。其中主数据库负责主动写的操作，而从数据库则只负责主动读的操作（slave从数据库仍然会被动的进行写操作，为了保持数据一致性），这样就可以很大程度上的避免数据丢失的问题，同时也可减少数据库的连接，减轻主数据库的负载。")]),s._v(" "),a("p",[s._v("下面让我们来看下一个图：")]),s._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/mysqlop/replication/centoscase-1.png"),alt:"wxmp"}}),s._v(" "),a("blockquote",[a("p",[s._v("在上面的模型中，Mysql-A就是主服务器，即master，Mysql-B就是从服务器，即slave。")]),s._v(" "),a("p",[s._v("在Mysql-A的数据库事件（例如修改数据库的sql操作语句），都会存储到日志系统A中，在相应的端口（默认3306）通过网络发送给Mysql-B。Mysql-B收到后，写入本地日志系统B，然后一条条的将数据库事件在数据库Mysql-B中完成。")]),s._v(" "),a("p",[s._v("日志系统A，是MYSQL的日志类型中的二进制日志，也就是专门用来保存修改数据库表的所有动作，即bin log，注意MYSQL会在执行语句之后，释放锁之前，写入二进制日志，确保事务安全。")]),s._v(" "),a("p",[s._v("日志系统B，不是二进制日志，由于它是从MYSQL-A的二进制日志复制过来的，并不是自己的数据库变化产生的，有点接力的感觉，称为中继日志，即relay log。")]),s._v(" "),a("p",[s._v("通过上面的机制，可以保证Mysql-A和Mysql-B的数据库数据一致，但是时间上肯定有延迟，即Mysql-B的数据是滞后的。因此，会出现这样的问题，Mysql-A的数据库操作是可以并发的执行的，但是Mysql-B只能从relay log中一条一条的读取执行。若Mysql-A的写操作很频繁，Mysql-B很可能就跟不上了。")])]),s._v(" "),a("p",[s._v("主从同步复制有以下几种方式：")]),s._v(" "),a("p",[s._v("（1）同步复制，master的变化，必须等待slave-1,slave-2,...,slave-n完成后才能返回。")]),s._v(" "),a("p",[s._v("（2）异步复制，master只需要完成自己的数据库操作即可，至于slaves是否收到二进制日志，是否完成操作，不用关心。MYSQL的默认设置。")]),s._v(" "),a("p",[s._v("（3）半同步复制，master只保证slaves中的一个操作成功，就返回，其他slave不管。这个功能，是由google为MYSQL引入的。")]),s._v(" "),a("p",[s._v("本文说的是在centos 7系统上，实现的mysql5.7数据库的主从同步配置，从而实现读写分离操作。")]),s._v(" "),a("h2",{attrs:{id:"_1-分别在两台centos-7系统上安装mysql-5-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-分别在两台centos-7系统上安装mysql-5-7"}},[s._v("#")]),s._v(" 1 分别在两台centos 7系统上安装mysql 5.7")]),s._v(" "),a("p",[s._v("具体的安装步骤可以见此链接，https://blog.csdn.net/qq_15092079/article/details/81629238。")]),s._v(" "),a("p",[s._v("本文中的两台服务器的IP地址分别为主服务器（192.168.17.130）和从服务器（192.168.17.132）。")]),s._v(" "),a("p",[s._v("分别在这两个服务器上创建test数据库，以备后面测试。")]),s._v(" "),a("h2",{attrs:{id:"_2-master主服务器的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-master主服务器的配置"}},[s._v("#")]),s._v(" 2 master主服务器的配置")]),s._v(" "),a("h3",{attrs:{id:"_2-1-配置文件my-cnf的修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-配置文件my-cnf的修改"}},[s._v("#")]),s._v(" 2.1 配置文件my.cnf的修改")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据上一篇文章，编辑my.cnf文件")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@localhost")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## vim /etc/my.cnf")]),s._v("\n\n \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在[mysqld]中添加：")]),s._v("\n\nserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\nlog_bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin\n\nlog_bin_index"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("\n\nbinlog_do_db"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#备注：")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server-id 服务器唯一标识。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log_bin 启动MySQL二进制日志，即数据同步语句，从数据库会一条一条的执行这些语句。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#binlog_do_db 指定记录二进制日志的数据库，即需要复制的数据库名，如果复制多个数据库，重复设置这个选项即可。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#binlog_ignore_db 指定不记录二进制日志的数据库，即不需要复制的数据库名，如果有多个数据库，重复设置这个选项即可。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#其中需要注意的是，binlog_do_db和binlog_ignore_db为互斥选项，一般只需要一个即可。")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-2-创建从服务器的用户和权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-创建从服务器的用户和权限"}},[s._v("#")]),s._v(" 2.2 创建从服务器的用户和权限")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入mysql数据库")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@localhost")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## mysql -uroot -p")]),s._v("\n\nEnter password:\n\n \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建从数据库的masterbackup用户和权限")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("replication")]),s._v(" slave "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" masterbackup"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'192.168.17.%'")]),s._v(" identified "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#备注")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#192.168.17.%通配符，表示0-255的IP都可访问主服务器，正式环境请配置指定从服务器IP")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#若将 192.168.17.% 改为 %，则任何ip均可作为其从数据库来访问主服务器")]),s._v("\n\n \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#退出mysql")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-3-重启mysql服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-重启mysql服务"}},[s._v("#")]),s._v(" 2.3 重启mysql服务")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@localhost")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## service mysql restart")]),s._v("\n\nShutting down MySQL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" SUCCESS"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Starting")]),s._v(" MySQL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" SUCCESS"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" \n")])])]),a("h3",{attrs:{id:"_2-4-查看主服务器状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-查看主服务器状态"}},[s._v("#")]),s._v(" 2.4 查看主服务器状态")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入mysql数据库")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@localhost")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## mysql -uroot -p")]),s._v("\n\nEnter password:\n\n \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看主服务器状态")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------+----------+--------------+------------------+-------------------+")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("File")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Position "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Do_DB "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Ignore_DB "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Executed_Gtid_Set "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------+----------+--------------+------------------+-------------------+")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" master"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("000001")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("154")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------+----------+--------------+------------------+-------------------+")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h2",{attrs:{id:"_3-slave从服务器的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-slave从服务器的配置"}},[s._v("#")]),s._v(" 3 slave从服务器的配置")]),s._v(" "),a("h3",{attrs:{id:"_3-1-配置文件my-cnf的修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-配置文件my-cnf的修改"}},[s._v("#")]),s._v(" 3.1 配置文件my.cnf的修改")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据上一篇文章，编辑my.cnf文件")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@localhost")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## vim /etc/my.cnf")]),s._v("\n\n \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在[mysqld]中添加：")]),s._v("\n\nserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\nrelay"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("slave"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("relay"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin\n\nrelay"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("slave"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("relay"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#replicate-do-db=test")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#备注：")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server-id 服务器唯一标识，如果有多个从服务器，每个服务器的server-id不能重复，跟IP一样是唯一标识，如果你没设置server-id或者设置为0，则从服务器不会连接到主服务器。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#relay-log 启动MySQL二进制日志，可以用来做数据备份和崩溃恢复，或主服务器挂掉了，将此从服务器作为其他从服务器的主服务器。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#replicate-do-db 指定同步的数据库，如果复制多个数据库，重复设置这个选项即可。若在master端不指定binlog-do-db，则在slave端可用replication-do-db来过滤。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#replicate-ignore-db 不需要同步的数据库，如果有多个数据库，重复设置这个选项即可。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#其中需要注意的是，replicate-do-db和replicate-ignore-db为互斥选项，一般只需要一个即可。")]),s._v("\n")])])]),a("h3",{attrs:{id:"_3-2-重启mysql服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-重启mysql服务"}},[s._v("#")]),s._v(" 3.2 重启mysql服务")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@localhost")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## service mysql restart")]),s._v("\n\nShutting down MySQL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" SUCCESS"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Starting")]),s._v(" MySQL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" SUCCESS"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" \n")])])]),a("h3",{attrs:{id:"_3-3-连接master主服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-连接master主服务器"}},[s._v("#")]),s._v(" 3.3 连接master主服务器")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入mysql数据库")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@localhost")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## mysql -uroot -p")]),s._v("\n\nEnter password:\n\n \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接master主服务器")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" change master "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" master_host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.17.130'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'masterbackup'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'master-bin.000001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_pos"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("154")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#备注：")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#master_host对应主服务器的IP地址。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#master_port对应主服务器的端口。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#master_log_file对应show master status显示的File列：master-bin.000001。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#master_log_pos对应show master status显示的Position列：154。")]),s._v("\n")])])]),a("h3",{attrs:{id:"_3-4-启动slave数据同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-启动slave数据同步"}},[s._v("#")]),s._v(" 3.4 启动slave数据同步")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动slave数据同步")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止slave数据同步（若有需要）")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" stop slave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_3-5-查看slave信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-查看slave信息"}},[s._v("#")]),s._v(" 3.5 查看slave信息")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" slave "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/mysqlop/replication/centoscase-2.png"),alt:"wxmp"}}),s._v(" "),a("p",[s._v("Slave_IO_Running和Slave_SQL_Running都为yes，则表示同步成功。")]),s._v(" "),a("h2",{attrs:{id:"_4-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-测试"}},[s._v("#")]),s._v(" 4 测试")]),s._v(" "),a("p",[s._v("（1）在主服务器上登陆mysql，且进入test数据库，创建test表，且插入一条数据")]),s._v(" "),a("p",[s._v("提示：这里最好用数据库管理工具（如nacicat）来操作。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建tb_test表")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tb_test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ID "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'主键ID'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MEMO "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'信息'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#插入一条数据")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" tb_test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MEMO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'one test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#提交")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("（2）在从服务器上登陆mysql，且进入test数据库")]),s._v(" "),a("p",[s._v("你会发现从数据库中，也出现了tb_test表，且表中还有one test数据存在，证明同步数据成功。")]),s._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/mysqlop/replication/centoscase-3.png"),alt:"wxmp"}}),s._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s.$withBase("/assets/img/mysqlop/replication/centoscase-4.png"),alt:"wxmp"}}),s._v(" "),a("h2",{attrs:{id:"_5-解决错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-解决错误"}},[s._v("#")]),s._v(" 5 解决错误")]),s._v(" "),a("p",[s._v("若在主从同步的过程中，出现其中一条语句同步失败报错了，则后面的语句也肯定不能同步成功了。例如，主库有一条数据，而从库并没有这一条数据，然而，在主库执行了删除这一条数据的操作，那么从库没有这么一条数据就肯定删除不了，从而报错了。在此时的从数据库的数据同步就失败了，因此后面的同步语句就无法继续执行。")]),s._v(" "),a("p",[s._v("这里提供的解决方法有两种：")]),s._v(" "),a("p",[s._v("（1）在从数据库中，使用SET全局sql_slave_skip_counter来跳过事件，跳过这一个错误，然后执行从下一个事件组开始。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在从数据库上操作")]),s._v("\n\nmysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" stop slave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" sql_slave_skip_counter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("（2）在从数据库中，重新连上主数据库。这种操作会直接跳过中间的那些同步语句，可能会导致一些数据未同步过去的问题，但这种操作也是最后的绝招。最好就是令从数据库与主数据库的数据结构和数据都一致了之后，再来恢复主从同步的操作。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在从数据库上操作")]),s._v("\n\nmysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" stop slave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" change master "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" master_host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.17.130'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'masterbackup'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'master-bin.000001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_pos"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2050")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#备注")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#master_log_file和master_log_pos可能会不同，需要在主数据库中show master status来查看")]),s._v("\n")])])]),a("h2",{attrs:{id:"_6-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-总结"}},[s._v("#")]),s._v(" 6 总结")]),s._v(" "),a("p",[s._v("至此，mysql数据库的主从同步就完成了，至于读写分离，我们可以通过程序来实现，这里简单讲解一下实现思想。")]),s._v(" "),a("p",[s._v("我们可以在主服务器创建一个数据库用户（出于安全，根据需求给予相应的权限）主要用于写操作，在程序中通过这一用户连接主数据库的只用于写操作而不用读操作。")]),s._v(" "),a("p",[s._v("在从服务器上创建一个数据库用户（出于安全，只给予读select的权限）主要用于读操作，在程序中通过这一用户连接从数据库即可。")]),s._v(" "),a("p",[s._v("当然，也可以找一个组件来完成MYSQL的代理，实现SQL语句的路由，这样就不需要我们在程序上关注哪个数据库是写，哪个数据库是读的了。")]),s._v(" "),a("h3",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),a("ul",[a("li",[s._v("https://blog.csdn.net/qq_15092079/article/details/81672920")])])])}),[],!1,null,null,null);t.default=n.exports}}]);