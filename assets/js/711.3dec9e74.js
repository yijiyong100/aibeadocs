(window.webpackJsonp=window.webpackJsonp||[]).push([[711],{1227:function(a,t,s){"use strict";s.r(t);var e=s(53),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("本文主要是介绍 读写分离-Amoeba案例说明 。")])]),a._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#【实战】amoeba-代理-mysql-主从复制-读写分离-【提供源码包】"}},[a._v("【实战】Amoeba 代理 MySQL 主从复制 + 读写分离 【提供源码包】")])]),s("li",[s("a",{attrs:{href:"#amoeba-的介绍"}},[a._v("Amoeba 的介绍")]),s("ul",[s("li",[s("a",{attrs:{href:"#_1-amoeba-是什么"}},[a._v("1）Amoeba 是什么：")])]),s("li",[s("a",{attrs:{href:"#_2-amoeba-的不足之处"}},[a._v("2）Amoeba 的不足之处：")])]),s("li",[s("a",{attrs:{href:"#_3-amoeba-的优势之处"}},[a._v("3）Amoeba 的优势之处：")])])])]),s("li",[s("a",{attrs:{href:"#mysql-主从复制原理"}},[a._v("MySQL 主从复制原理")])]),s("li",[s("a",{attrs:{href:"#mysql-读写分离原理"}},[a._v("MySQL 读写分离原理")]),s("ul",[s("li",[s("a",{attrs:{href:"#_2·以下是读写分离过程图解"}},[a._v("2·以下是读写分离过程图解：")])])])]),s("li",[s("a",{attrs:{href:"#实战部署之案例环境"}},[a._v("实战部署之案例环境")]),s("ul",[s("li",[s("a",{attrs:{href:"#案例实施"}},[a._v("案例实施：")])])])]),s("li",[s("a",{attrs:{href:"#一-主从复制搭建"}},[a._v("一：主从复制搭建")]),s("ul",[s("li",[s("a",{attrs:{href:"#_1-在主服务器上安装-ntp"}},[a._v("1）在主服务器上安装 NTP")])]),s("li",[s("a",{attrs:{href:"#_2-配置-ntp-时间同步源"}},[a._v("2）配置 NTP 时间同步源")])]),s("li",[s("a",{attrs:{href:"#_3-关闭防火墙、启动时间源服务"}},[a._v("3）关闭防火墙、启动时间源服务")])]),s("li",[s("a",{attrs:{href:"#_4-时间源配置好了之后可以在从服务器上进行时间同步了"}},[a._v("4）时间源配置好了之后可以在从服务器上进行时间同步了")])]),s("li",[s("a",{attrs:{href:"#_5-配置-mysql-master-主服务器-因为主从复制的原理就是根据二进制日志来同步的-所以这里需要开启二进制日志文件-和允许-slave-从服务器同步数据"}},[a._v("5）配置 MySQL Master 主服务器，因为主从复制的原理就是根据二进制日志来同步的，所以这里需要开启二进制日志文件，和允许 Slave 从服务器同步数据")])]),s("li",[s("a",{attrs:{href:"#_6-修改完成后重启-mysql-主服务器-并且登陆-mysql-给从服务器授权-允许从服务器以什么身份、什么主机登陆并且可以拥有复制的权限"}},[a._v("6）修改完成后重启 MySQL 主服务器，并且登陆 MySQL 给从服务器授权，允许从服务器以什么身份、什么主机登陆并且可以拥有复制的权限！")])]),s("li",[s("a",{attrs:{href:"#_7-主服务器上的配置完成后-现在可以做从服务器上的配置-修改主配置文件"}},[a._v("7）主服务器上的配置完成后，现在可以做从服务器上的配置，修改主配置文件")])]),s("li",[s("a",{attrs:{href:"#_8-配置文件修改完成-登陆-mysql-配置同步-指定主服务器各种参数"}},[a._v("8）配置文件修改完成，登陆 MySQL ，配置同步，指定主服务器各种参数")])]),s("li",[s("a",{attrs:{href:"#_9-启动同步-查看-slave-状态-确保-以下两个值为-yes"}},[a._v("9）启动同步，查看 Slave 状态，确保 以下两个值为 YES")])]),s("li",[s("a",{attrs:{href:"#_10-验证主从同步效果-在主服务器上创建一个数据库-school-查看从服务器上是否也有。"}},[a._v("10）验证主从同步效果，在主服务器上创建一个数据库 school ，查看从服务器上是否也有。")])])])]),s("li",[s("a",{attrs:{href:"#二-mysql-读写分离搭建"}},[a._v("二：MySQL 读写分离搭建：")]),s("ul",[s("li",[s("a",{attrs:{href:"#_1-在主机-amoeba-上安装-java-环境"}},[a._v("1）在主机 Amoeba 上安装 Java 环境")])]),s("li",[s("a",{attrs:{href:"#_2-增加如下配置"}},[a._v("2）增加如下配置：")])]),s("li",[s("a",{attrs:{href:"#_3-现在-java-环境配置成功-可以开始配置-amoeba-软件"}},[a._v("3）现在 Java 环境配置成功，可以开始配置 Amoeba 软件")])]),s("li",[s("a",{attrs:{href:"#_4-在master-主-、slave1-从1-、slave-从2-三台mysql服务器中开放权限给-amoeba-访问"}},[a._v("4）在Master （主）、Slave1（从1）、Slave（从2）三台MySQL服务器中开放权限给 Amoeba 访问")])]),s("li",[s("a",{attrs:{href:"#_5-编辑-amoeba-xml-配置文件"}},[a._v("5）编辑 amoeba.xml 配置文件")])]),s("li",[s("a",{attrs:{href:"#_6-编辑-dbservers-xml-配置文件"}},[a._v("6）编辑 dbServers.xml 配置文件")])]),s("li",[s("a",{attrs:{href:"#配置完成后-启动-amoeba-软件-默认端口是-8066"}},[a._v("）配置完成后，启动 Amoeba 软件 默认端口是 8066")])])])]),s("li",[s("a",{attrs:{href:"#测试"}},[a._v("测试")]),s("ul",[s("li",[s("a",{attrs:{href:"#_1-在打开一台客户端-通过用amoeba-账户远程连接。"}},[a._v("1）在打开一台客户端，通过用amoeba 账户远程连接。")])]),s("li",[s("a",{attrs:{href:"#_2-在-master-上创建一个表-同步到各个从服务器上-然后关闭从服务器的-slave-同步功能-再插入区别语句。"}},[a._v("2）在 Master 上创建一个表，同步到各个从服务器上，然后关闭从服务器的 Slave 同步功能，再插入区别语句。")])]),s("li",[s("a",{attrs:{href:"#_3-在从服务器上关闭-同步功能"}},[a._v("3）在从服务器上关闭 同步功能")])]),s("li",[s("a",{attrs:{href:"#_4-在主服务器上插入一条数据"}},[a._v("4）在主服务器上插入一条数据")])]),s("li",[s("a",{attrs:{href:"#_5-在从服务器分别插入一条能够区别的数据-2-3"}},[a._v("5）在从服务器分别插入一条能够区别的数据 ‘2’ ‘3’")])]),s("li",[s("a",{attrs:{href:"#_6-在客户机上测试几次读取表中的数据"}},[a._v("6）在客户机上测试几次读取表中的数据")])]),s("li",[s("a",{attrs:{href:"#_7-由以上图得出结论-客户端读取数据只会读取从服务器的数据。"}},[a._v("7）由以上图得出结论：客户端读取数据只会读取从服务器的数据。")])]),s("li",[s("a",{attrs:{href:"#_8-在客户端上写入一条能够区别的数据-分别在-三台服务器上查询结果。从服务器因为之前需要验证读取效果-已经-stop-slave-所以在客户端上插入的数据不会同步到从服务器。"}},[a._v("8）在客户端上写入一条能够区别的数据，分别在 三台服务器上查询结果。从服务器因为之前需要验证读取效果 已经 stop slave ；所以在客户端上插入的数据不会同步到从服务器。")])]),s("li",[s("a",{attrs:{href:"#_9-查询主服务器的数据会不会由-4-这条数据。如下图"}},[a._v("9）查询主服务器的数据会不会由 ‘4’ 这条数据。如下图：")])])])]),s("li",[s("a",{attrs:{href:"#结论"}},[a._v("结论：")])]),s("li",[s("a",{attrs:{href:"#参考文章"}},[a._v("参考文章")])])])]),s("p"),a._v(" "),s("h2",{attrs:{id:"【实战】amoeba-代理-mysql-主从复制-读写分离-【提供源码包】"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#【实战】amoeba-代理-mysql-主从复制-读写分离-【提供源码包】"}},[a._v("#")]),a._v(" 【实战】Amoeba 代理 MySQL 主从复制 + 读写分离 【提供源码包】")]),a._v(" "),s("h2",{attrs:{id:"amoeba-的介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#amoeba-的介绍"}},[a._v("#")]),a._v(" Amoeba 的介绍")]),a._v(" "),s("h3",{attrs:{id:"_1-amoeba-是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-amoeba-是什么"}},[a._v("#")]),a._v(" 1）Amoeba 是什么：")]),a._v(" "),s("blockquote",[s("p",[a._v("1·Amoeba 的中文名是：变形虫。它是一个以MySQL为底层数据存储，并对应用提供MySQL协议接口的proxy。它集中地响应应用的请求，依据用户事先设置的规则，将SQL请求发送到特定的数据库上执行。基于此可以实现负载均衡、读写分离、高可用性等需求。")])]),a._v(" "),s("blockquote",[s("p",[a._v("2·Amoeba相当于一个SQL请求的路由器，目的是为负载均衡、读写分离、高可用性提供机制，而不是完全实现它们")])]),a._v(" "),s("blockquote",[s("p",[a._v("3·Amoeba 由陈思儒开发，曾经就职阿里巴巴！该程序由 Java 程序开发。")])]),a._v(" "),s("h3",{attrs:{id:"_2-amoeba-的不足之处"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-amoeba-的不足之处"}},[a._v("#")]),a._v(" 2）Amoeba 的不足之处：")]),a._v(" "),s("blockquote",[s("p",[a._v("a)、目前还不支持事务")]),a._v(" "),s("p",[a._v("b)、暂时不支持存储过程（近期会支持）")]),a._v(" "),s("p",[a._v("c)、不适合从amoeba导数据的场景或者对大数据量查询的query并不合适（比如一次请求返回10w以上甚至更多数据的场合）")]),a._v(" "),s("p",[a._v("d)、暂时不支持分库分表，amoeba目前只做到分数据库实例，每个被切分的节点需要保持库表结构一致")])]),a._v(" "),s("h3",{attrs:{id:"_3-amoeba-的优势之处"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-amoeba-的优势之处"}},[a._v("#")]),a._v(" 3）Amoeba 的优势之处：")]),a._v(" "),s("blockquote",[s("p",[a._v("Amoeba主要解决以下问题：")]),a._v(" "),s("p",[a._v("a). 数据切分后复杂数据源整合")]),a._v(" "),s("p",[a._v("b). 提供数据切分规则并降低数据切分规则给数据库带来的影响")]),a._v(" "),s("p",[a._v("c). 降低数据库与客户端连接")]),a._v(" "),s("p",[a._v("d). 读写分离路由")])]),a._v(" "),s("h2",{attrs:{id:"mysql-主从复制原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql-主从复制原理"}},[a._v("#")]),a._v(" MySQL 主从复制原理")]),a._v(" "),s("blockquote",[s("p",[a._v("1·MySQL 主从复制和MySQL 的读写分离有着紧密的联系，只有主从复制完成，才能在此基础上完成数据的读写分离。")])]),a._v(" "),s("blockquote",[s("p",[a._v("2·下图是MySQL主从复制的过程图：")])]),a._v(" "),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/mysqlop/rwseperateprin/amoebacase/724109eba8aa28a059b2de3309655ee3.png"),alt:"wxmp"}}),a._v(" "),s("blockquote",[s("p",[a._v("3·工作过程解读：")]),a._v(" "),s("p",[a._v("MySQL 主服务器开始写入数据，就会记录在二进制日志文件中。从服务器有两个线程，分别是 I/o线程 与 SQL 线程。这时从服务器就会让 I / O 线程在 主服务器上打开一个口，这时会读取二进制日志文件写入中继日志中，SQL 线程就会读取中继日志，并重放日志中的事件，从服务器就会通过日志来同步主服务器。")])]),a._v(" "),s("h2",{attrs:{id:"mysql-读写分离原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql-读写分离原理"}},[a._v("#")]),a._v(" MySQL 读写分离原理")]),a._v(" "),s("blockquote",[s("p",[a._v("1·读写分离简单来说就是在主服务器上进行写入，在从服务器上进行读取，这个中间就需要基于中间代理层Amoeba来实现，Amoeba 接收到请求后会判断这个是什么请求，它就会分别转发到后端的数据库。")])]),a._v(" "),s("h3",{attrs:{id:"_2·以下是读写分离过程图解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2·以下是读写分离过程图解"}},[a._v("#")]),a._v(" 2·以下是读写分离过程图解：")]),a._v(" "),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/mysqlop/rwseperateprin/amoebacase/04d9e415b869a5a0e0c3fe6381894ac4.png"),alt:"wxmp"}}),a._v(" "),s("h2",{attrs:{id:"实战部署之案例环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实战部署之案例环境"}},[a._v("#")]),a._v(" 实战部署之案例环境")]),a._v(" "),s("p",[a._v("拓扑图如上图，案例环境表如下表：")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("主机")]),a._v(" "),s("th",[a._v("操作系统")]),a._v(" "),s("th",[a._v("IP地址")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("Master主服务器")]),a._v(" "),s("td",[a._v("CentOS 7.4")]),a._v(" "),s("td",[a._v("192.168.106.154")])]),a._v(" "),s("tr",[s("td",[a._v("Slave 1 服务器")]),a._v(" "),s("td",[a._v("CentOS 7.4")]),a._v(" "),s("td",[a._v("192.168.106.156")])]),a._v(" "),s("tr",[s("td",[a._v("Slave 2 服务器")]),a._v(" "),s("td",[a._v("CentOS 7.4")]),a._v(" "),s("td",[a._v("192.168.106.157")])]),a._v(" "),s("tr",[s("td",[a._v("Amoeba 代理")]),a._v(" "),s("td",[a._v("CentOS 7.4")]),a._v(" "),s("td",[a._v("192.168.106.129")])])])]),a._v(" "),s("blockquote",[s("p",[a._v("MySQL 主从复制+读写分离所需要的源码包都在我的"),s("a",{attrs:{href:"https://pan.baidu.com/s/11zJmmREeych3Kg8zRnV-SA",target:"_blank",rel:"noopener noreferrer"}},[a._v(" 百度网盘"),s("OutboundLink")],1),a._v(" 密码：l23r 需要的请点击下载。")])]),a._v(" "),s("h3",{attrs:{id:"案例实施"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#案例实施"}},[a._v("#")]),a._v(" 案例实施：")]),a._v(" "),s("blockquote",[s("p",[a._v("这里主、从服务器都需要事先安装好 MySQL ，这里就不再演示MySQL的安装，有兴趣的朋友可以看看之前的文章 "),s("a",{attrs:{href:"https://blog.51cto.com/13746824/2163787",target:"_blank",rel:"noopener noreferrer"}},[a._v(" MySQL5.7版本安装"),s("OutboundLink")],1)])]),a._v(" "),s("blockquote",[s("p",[a._v("1·如果是在实战环境中，而已是在时间差异较大的地区，建议首先需要建立时间同步的环境。")])]),a._v(" "),s("h2",{attrs:{id:"一-主从复制搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一-主从复制搭建"}},[a._v("#")]),a._v(" 一：主从复制搭建")]),a._v(" "),s("h3",{attrs:{id:"_1-在主服务器上安装-ntp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-在主服务器上安装-ntp"}},[a._v("#")]),a._v(" 1）在主服务器上安装 NTP")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# yum install ntp -y")])]),a._v(" "),s("h3",{attrs:{id:"_2-配置-ntp-时间同步源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置-ntp-时间同步源"}},[a._v("#")]),a._v(" 2）配置 NTP 时间同步源")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# vim /etc/ntp.conf -（加入如下两行）")]),a._v(" "),s("p",[a._v("server 127.127.106.0 ---（本地时间源）")]),a._v(" "),s("p",[a._v("fudge 127.127.106.0 stratum 8 ---（设置时间层级为8）")])]),a._v(" "),s("h3",{attrs:{id:"_3-关闭防火墙、启动时间源服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-关闭防火墙、启动时间源服务"}},[a._v("#")]),a._v(" 3）关闭防火墙、启动时间源服务")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# systemctl stop firewalld.service")]),a._v(" "),s("p",[a._v("[root@localhost ~]# setenforce 0")]),a._v(" "),s("p",[a._v("[root@localhost ~]# systemctl start ntpd")])]),a._v(" "),s("h3",{attrs:{id:"_4-时间源配置好了之后可以在从服务器上进行时间同步了"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-时间源配置好了之后可以在从服务器上进行时间同步了"}},[a._v("#")]),a._v(" 4）时间源配置好了之后可以在从服务器上进行时间同步了")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# yum install ntp ntpdate -y")]),a._v(" "),s("p",[a._v("[root@localhost ~]# systemctl stop firewalld.service")]),a._v(" "),s("p",[a._v("[root@localhost ~]# setenforce 0")]),a._v(" "),s("p",[a._v("[root@localhost ~]# systemctl start ntpd -（启动服务）")]),a._v(" "),s("p",[a._v("[root@localhost ~]# /usr/sbin/ntpdate 192.168.106.154 -（开始时间同步）")])]),a._v(" "),s("h3",{attrs:{id:"_5-配置-mysql-master-主服务器-因为主从复制的原理就是根据二进制日志来同步的-所以这里需要开启二进制日志文件-和允许-slave-从服务器同步数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置-mysql-master-主服务器-因为主从复制的原理就是根据二进制日志来同步的-所以这里需要开启二进制日志文件-和允许-slave-从服务器同步数据"}},[a._v("#")]),a._v(" 5）配置 MySQL Master 主服务器，因为主从复制的原理就是根据二进制日志来同步的，所以这里需要开启二进制日志文件，和允许 Slave 从服务器同步数据")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# vim /etc/my.cnf -----（进入主服务器配置文件，添加如下）")]),a._v(" "),s("p",[a._v("[mysqld]")]),a._v(" "),s("p",[a._v("server-id = 11 （修改，这里的 id 不允许和从服务器一样）")]),a._v(" "),s("p",[a._v("log-bin=master-bin （有则修改，无则添加，master-bin只是为了容易识别）")]),a._v(" "),s("p",[a._v("log-slave-updates=true -（添加，允许从服务器来同步）")])]),a._v(" "),s("h3",{attrs:{id:"_6-修改完成后重启-mysql-主服务器-并且登陆-mysql-给从服务器授权-允许从服务器以什么身份、什么主机登陆并且可以拥有复制的权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-修改完成后重启-mysql-主服务器-并且登陆-mysql-给从服务器授权-允许从服务器以什么身份、什么主机登陆并且可以拥有复制的权限"}},[a._v("#")]),a._v(" 6）修改完成后重启 MySQL 主服务器，并且登陆 MySQL 给从服务器授权，允许从服务器以什么身份、什么主机登陆并且可以拥有复制的权限！")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# systemctl restart mysqld.service -----（重启服务器）")]),a._v(" "),s("p",[a._v("[root@localhost ~]# mysql -u root -p -----（登陆主服务器MySQL）")]),a._v(" "),s("p",[a._v("mysql> GRANT REPLICATION SLAVE ON  TO ‘myslave’@‘192.168.106.%’ IDENTIFIED BY ‘123456’;")]),a._v(" "),s("p",[a._v("mysql> flush privileges;")]),a._v(" "),s("p",[a._v("mysql> show master status;")]),a._v(" "),s("p",[a._v("±±---±-±-----±+\n| File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n±±---±-±-----±+\n| master-bin.000001 | 604 | | | |\n±±---±-±-----±+\n1 row in set (0.00 sec)")])]),a._v(" "),s("blockquote",[s("p",[a._v("对上面的表格做一个说明：File 列显示的是日志名字，我们在配置文件中修改的名字，Position 列显示偏移量，这两个值在后面配置从服务器的时候会用到。")])]),a._v(" "),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/mysqlop/rwseperateprin/amoebacase/43fd1765c6cd7a8c6ab5f462ee0f0bcd.png"),alt:"wxmp"}}),a._v(" "),s("h3",{attrs:{id:"_7-主服务器上的配置完成后-现在可以做从服务器上的配置-修改主配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-主服务器上的配置完成后-现在可以做从服务器上的配置-修改主配置文件"}},[a._v("#")]),a._v(" 7）主服务器上的配置完成后，现在可以做从服务器上的配置，修改主配置文件")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# vim /etc/my.cnf -----（进入从服务器配置文件，添加如下）")]),a._v(" "),s("p",[a._v("[mysqld] ----（在此模块下添加如下内容）")]),a._v(" "),s("p",[a._v("server-id = 22 （修改 ID ，注意不能与主服务器 ID 相同）")]),a._v(" "),s("p",[a._v("relay-log=relay-log-bin ----（从主服务器上同步日志文件记录到本地）")]),a._v(" "),s("p",[a._v("relay-log-index=slave-relay-bin.index -----（定义relay-log的位置和名称）")])]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# systemctl restart mysqld.service ----（修改完毕，重启服务）")])]),a._v(" "),s("h3",{attrs:{id:"_8-配置文件修改完成-登陆-mysql-配置同步-指定主服务器各种参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-配置文件修改完成-登陆-mysql-配置同步-指定主服务器各种参数"}},[a._v("#")]),a._v(" 8）配置文件修改完成，登陆 MySQL ，配置同步，指定主服务器各种参数")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# mysql -uroot -p ----（登陆MySQL，开始配置同步）\nmysql> change master to master_host=‘192.168.106.154’,master_user=‘myslave’,master_password=‘123456’,masterr_log_file=‘master-bin.000001’,master_log_pos=604;")])]),a._v(" "),s("blockquote",[s("p",[a._v("这里需要说明两个参数：masterr_log_file ，master_log_pos 必须按主服务器 show master status 的结果给值")])]),a._v(" "),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/mysqlop/rwseperateprin/amoebacase/14b66921a71c3e2ec8091e364005e423.png"),alt:"wxmp"}}),a._v(" "),s("h3",{attrs:{id:"_9-启动同步-查看-slave-状态-确保-以下两个值为-yes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-启动同步-查看-slave-状态-确保-以下两个值为-yes"}},[a._v("#")]),a._v(" 9）启动同步，查看 Slave 状态，确保 以下两个值为 YES")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[a._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("start")]),a._v(" slave"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("----（启动同步）")]),a._v("\nmysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("show")]),a._v(" slave "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("status")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" （查看 Slave 状态 确保以下两个值为 YES）\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("row")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v("\nSlave_IO_State: Waiting "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" master "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" send event\nMaster_Host: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".106")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".154")]),a._v("\nMaster_User: myslave\nMaster_Port: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),a._v("\nConnect_Retry: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("60")]),a._v("\nMaster_Log_File: master"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("000002")]),a._v("\nRead_Master_Log_Pos: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("150")]),a._v("\nRelay_Log_File: relay"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("log"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("000002")]),a._v("\nRelay_Log_Pos: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("270")]),a._v("\nRelay_Master_Log_File: master"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("000002")]),a._v("\nSlave_IO_Running: Yes （确保这里的值为 YES）\nSlave_SQL_Running: Yes （确保这里的值为 YES）\n")])])]),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/mysqlop/rwseperateprin/amoebacase/7f8137e9adb86b03902c1a7add05448f.png"),alt:"wxmp"}}),a._v(" "),s("h3",{attrs:{id:"_10-验证主从同步效果-在主服务器上创建一个数据库-school-查看从服务器上是否也有。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-验证主从同步效果-在主服务器上创建一个数据库-school-查看从服务器上是否也有。"}},[a._v("#")]),a._v(" 10）验证主从同步效果，在主服务器上创建一个数据库 school ，查看从服务器上是否也有。")]),a._v(" "),s("blockquote",[s("p",[a._v("mysql> create database school4; -（主服务器创建库school4）\nQuery OK, 1 row affected (0.00 sec)")])]),a._v(" "),s("blockquote",[s("p",[a._v("mysql> show databases; -----（在从服务器上查看是否同步过来school4）")])]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("Database")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n±"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" information_schema "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#mysql50#.mozilla |")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" bbs "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" performance_schema "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" school4 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" （同步成功）\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" test "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n±"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("rows")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("in")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.00")]),a._v(" sec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("h2",{attrs:{id:"二-mysql-读写分离搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二-mysql-读写分离搭建"}},[a._v("#")]),a._v(" 二：MySQL 读写分离搭建：")]),a._v(" "),s("h3",{attrs:{id:"_1-在主机-amoeba-上安装-java-环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-在主机-amoeba-上安装-java-环境"}},[a._v("#")]),a._v(" 1）在主机 Amoeba 上安装 Java 环境")]),a._v(" "),s("blockquote",[s("p",[a._v("在之前介绍了 Amoeba 是由 Java 程序所开发，所以这搭建 Amoeba 需要用到 jdk 。")]),a._v(" "),s("p",[a._v("[root@localhost ~]# cp jdk-6u14-linux-x64.bin /usr/local （把它移动到这个目录下）")]),a._v(" "),s("p",[a._v("[root@localhost local]# chmod +x /usr/local/jdk-6u14-linux-x64.bin --(给执行权限)")]),a._v(" "),s("p",[a._v("[root@localhost local]# ./jdk-6u14-linux-x64.bin —(根据提示按Enter就好,最后输入YES)")]),a._v(" "),s("p",[a._v("[root@localhost local]# mv jdk1.6.0_14/ /usr/local/jdk1.6 —（重命名，方便后面操作）")])]),a._v(" "),s("h3",{attrs:{id:"_2-增加如下配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-增加如下配置"}},[a._v("#")]),a._v(" 2）增加如下配置：")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost local]# vim /etc/profile -----（增加如下的一些变量）")]),a._v(" "),s("p",[a._v("export JAVA_HOME=/usr/local/jdk1.6")]),a._v(" "),s("p",[a._v("export CLASSPATH=CLASSPATH:"),s("em",[a._v("CLASSPATH")]),a._v(":JAVA_HOME/lib:JAVA_HOME/jre/lib export PATH="),s("em",[a._v("JAVAH")]),a._v("​"),s("em",[a._v("OME")]),a._v("/"),s("em",[a._v("jre")]),a._v("/"),s("em",[a._v("libexportPATH")]),a._v("=JAVA_HOME/lib:JAVA_HOME/jre/bin/:"),s("em",[a._v("JAVAH")]),a._v("​"),s("em",[a._v("OME")]),a._v("/"),s("em",[a._v("jre")]),a._v("/"),s("em",[a._v("bin")]),a._v("/:PATH:HOME/bin export AMOEBA_HOME=/usr/local/amoeba export PATH="),s("em",[a._v("HOME")]),a._v("/"),s("em",[a._v("binexportAMOEBAH")]),a._v("​"),s("em",[a._v("OME")]),a._v("=/"),s("em",[a._v("usr")]),a._v("/"),s("em",[a._v("local")]),a._v("/\n"),s("em",[a._v("amoebaexportPATH")]),a._v("=PATH:$AMOEBA_HOME/bin")])]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost local]# source /etc/profile ----（刷新一下，使其生效）")]),a._v(" "),s("p",[a._v("[root@localhost local]# systemctl stop firewalld.service ----（关闭防火墙）")]),a._v(" "),s("p",[a._v("[root@localhost local]# setenforce 0")])]),a._v(" "),s("h3",{attrs:{id:"_3-现在-java-环境配置成功-可以开始配置-amoeba-软件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-现在-java-环境配置成功-可以开始配置-amoeba-软件"}},[a._v("#")]),a._v(" 3）现在 Java 环境配置成功，可以开始配置 Amoeba 软件")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# mkdir /usr/local/amoeba")]),a._v(" "),s("p",[a._v("[root@localhost ~]# tar zxvf amoeba-mysql-binary-2.2.0.tar.gz -C /usr/local/amoeba/ -----（解压 Amoeba 压缩包）")])]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# chmod -R 755 /usr/local/amoeba/")]),a._v(" "),s("p",[a._v("[root@localhost ~]# /usr/local/amoeba/bin/amoeba")]),a._v(" "),s("p",[a._v("amoeba start|stop -----（显示此内容，说明 Amoeba安装成功）")])]),a._v(" "),s("h3",{attrs:{id:"_4-在master-主-、slave1-从1-、slave-从2-三台mysql服务器中开放权限给-amoeba-访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-在master-主-、slave1-从1-、slave-从2-三台mysql服务器中开放权限给-amoeba-访问"}},[a._v("#")]),a._v(" 4）在Master （主）、Slave1（从1）、Slave（从2）三台MySQL服务器中开放权限给 Amoeba 访问")]),a._v(" "),s("blockquote",[s("p",[a._v("mysql> grant all on "),s("em",[a._v(".")]),a._v(" to test@‘192.168.106.%’ identified by ‘123.com’;")]),a._v(" "),s("p",[a._v("Query OK, 0 rows affected (0.00 sec)")])]),a._v(" "),s("h3",{attrs:{id:"_5-编辑-amoeba-xml-配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-编辑-amoeba-xml-配置文件"}},[a._v("#")]),a._v(" 5）编辑 amoeba.xml 配置文件")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# vim /usr/local/amoeba/conf/amoeba.xml —（修改内容如下）")])]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[a._v("\n—30行–\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("amoeba"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" 客户机访问amoeba使用amoeba这个账号\n----32行---\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("123456"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("访问密码\n\n—117行-去掉注释-\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("defaultPool"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("master"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" 默认权限给master\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("writePool"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("master"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" 写入池为master\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("readPool"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("slaves"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" 读取池为slaves，注意这里要加上s\n\n")])])]),s("h3",{attrs:{id:"_6-编辑-dbservers-xml-配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-编辑-dbservers-xml-配置文件"}},[a._v("#")]),a._v(" 6）编辑 dbServers.xml 配置文件")]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[a._v("[root@localhost ~]# vim /usr/local/amoeba/conf/dbServers.xml —（如下内容）\n\n–26-29–去掉注释–\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("test"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" //用test身份访问mysql\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("123.com"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n-----42-主服务器地址—\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dbServer")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("parent")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("abstractServer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" —（主服务器名字）\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("ipAddress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("192.168.106.154"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" ----（主服务器地址）\n\n–52-从服务器主机名-\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dbServer")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("slave1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("parent")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("abstractServer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" --（从服务器名字）\n\n–55-从服务器地址-\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("ipAddress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("192.168.106.156"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" --（从服务器1地址）\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("ipAddress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("192.168.106.157"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" --（从服务器2地址）\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dbServer")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("slaves"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("virtual")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("true"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("poolConfig")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("com.meidusa.amoeba.server.MultipleServerPool"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n")])])]),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/mysqlop/rwseperateprin/amoebacase/3b21f6b2d01b464b9b804ac368b701a7.png"),alt:"wxmp"}}),a._v(" "),s("h3",{attrs:{id:"配置完成后-启动-amoeba-软件-默认端口是-8066"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置完成后-启动-amoeba-软件-默认端口是-8066"}},[a._v("#")]),a._v(" ）配置完成后，启动 Amoeba 软件 默认端口是 8066")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# /usr/local/amoeba/bin/amoeba start&")])]),a._v(" "),s("h2",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),s("h3",{attrs:{id:"_1-在打开一台客户端-通过用amoeba-账户远程连接。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-在打开一台客户端-通过用amoeba-账户远程连接。"}},[a._v("#")]),a._v(" 1）在打开一台客户端，通过用amoeba 账户远程连接。")]),a._v(" "),s("blockquote",[s("p",[a._v("[root@localhost ~]# mysql -u amoeba -p123456 -h 192.168.106.129 -P8066")]),a._v(" "),s("p",[a._v("连接上了说明授权没问题，客户端能访问amoeba")])]),a._v(" "),s("h3",{attrs:{id:"_2-在-master-上创建一个表-同步到各个从服务器上-然后关闭从服务器的-slave-同步功能-再插入区别语句。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-在-master-上创建一个表-同步到各个从服务器上-然后关闭从服务器的-slave-同步功能-再插入区别语句。"}},[a._v("#")]),a._v(" 2）在 Master 上创建一个表，同步到各个从服务器上，然后关闭从服务器的 Slave 同步功能，再插入区别语句。")]),a._v(" "),s("blockquote",[s("p",[a._v("mysql> use school4;")]),a._v(" "),s("p",[a._v("Database changed")]),a._v(" "),s("p",[a._v("mysql> create table zang (id int(10),name varchar(10),address varchar(20));")]),a._v(" "),s("p",[a._v("Query OK, 0 rows affected (0.03 sec)")])]),a._v(" "),s("h3",{attrs:{id:"_3-在从服务器上关闭-同步功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-在从服务器上关闭-同步功能"}},[a._v("#")]),a._v(" 3）在从服务器上关闭 同步功能")]),a._v(" "),s("blockquote",[s("p",[a._v("mysql> stop slave;")]),a._v(" "),s("p",[a._v("Query OK, 0 rows affected (0.00 sec)")])]),a._v(" "),s("h3",{attrs:{id:"_4-在主服务器上插入一条数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-在主服务器上插入一条数据"}},[a._v("#")]),a._v(" 4）在主服务器上插入一条数据")]),a._v(" "),s("blockquote",[s("p",[a._v("mysql> insert into zang values(‘1’,‘zhang’,‘this_is_master’);")]),a._v(" "),s("p",[a._v("Query OK, 1 row affected (0.01 sec)")])]),a._v(" "),s("h3",{attrs:{id:"_5-在从服务器分别插入一条能够区别的数据-2-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-在从服务器分别插入一条能够区别的数据-2-3"}},[a._v("#")]),a._v(" 5）在从服务器分别插入一条能够区别的数据 ‘2’ ‘3’")]),a._v(" "),s("blockquote",[s("p",[a._v("mysql> insert into zang values(‘2’,‘zhang’,‘this_is_slave1’);")]),a._v(" "),s("p",[a._v("Query OK, 1 row affected (0.00 sec)")])]),a._v(" "),s("h3",{attrs:{id:"_6-在客户机上测试几次读取表中的数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-在客户机上测试几次读取表中的数据"}},[a._v("#")]),a._v(" 6）在客户机上测试几次读取表中的数据")]),a._v(" "),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/mysqlop/rwseperateprin/amoebacase/a9d4230735cf34040adbbb32821e6ec3.png"),alt:"wxmp"}}),a._v(" "),s("h3",{attrs:{id:"_7-由以上图得出结论-客户端读取数据只会读取从服务器的数据。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-由以上图得出结论-客户端读取数据只会读取从服务器的数据。"}},[a._v("#")]),a._v(" 7）由以上图得出结论：客户端读取数据只会读取从服务器的数据。")]),a._v(" "),s("h3",{attrs:{id:"_8-在客户端上写入一条能够区别的数据-分别在-三台服务器上查询结果。从服务器因为之前需要验证读取效果-已经-stop-slave-所以在客户端上插入的数据不会同步到从服务器。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-在客户端上写入一条能够区别的数据-分别在-三台服务器上查询结果。从服务器因为之前需要验证读取效果-已经-stop-slave-所以在客户端上插入的数据不会同步到从服务器。"}},[a._v("#")]),a._v(" 8）在客户端上写入一条能够区别的数据，分别在 三台服务器上查询结果。从服务器因为之前需要验证读取效果 已经 stop slave ；所以在客户端上插入的数据不会同步到从服务器。")]),a._v(" "),s("blockquote",[s("p",[a._v("mysql> insert into zang values(‘4’,‘zhang’,‘this_is_slave2’);\nQuery OK, 1 row affected (0.02 sec)")])]),a._v(" "),s("h3",{attrs:{id:"_9-查询主服务器的数据会不会由-4-这条数据。如下图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-查询主服务器的数据会不会由-4-这条数据。如下图"}},[a._v("#")]),a._v(" 9）查询主服务器的数据会不会由 ‘4’ 这条数据。如下图：")]),a._v(" "),s("blockquote",[s("p",[a._v("mysql> select * from zang;\n±-----±±---+\n| id | name | address |\n±-----±±---+\n| 1 | zhang | this_is_master |\n| 4 | zhang | this_is_slave2 | -（主服务器上有在客户端插入的数据）\n±-----±±---+\n2 rows in set (0.00 sec)")])]),a._v(" "),s("img",{staticClass:"zoom-custom-imgs",attrs:{src:a.$withBase("/assets/img/mysqlop/rwseperateprin/amoebacase/c108f94458b1e6ca0f424d6231b1491a.png"),alt:"wxmp"}}),a._v(" "),s("h2",{attrs:{id:"结论"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[a._v("#")]),a._v(" 结论：")]),a._v(" "),s("blockquote",[s("p",[a._v("1·因为需要验证 读 和 写 的分离，所以必须在从服务器上关闭同步，这样才能验证。")]),a._v(" "),s("p",[a._v("2·根据以上信息得出，客户端访问 Amoeba 代理服务器能够成功实现读写分离。")]),a._v(" "),s("p",[a._v("3.读写分离是建立在主从复制之上。")]),a._v(" "),s("p",[a._v("4·读写分离的最大作用就是为了减轻服务器的压力")]),a._v(" "),s("p",[a._v("5·读写分离其次还有的作用是可以在备份的时候起到了作用，因为备份的时候，不管是什么方式吗，可能会锁定表，或者行！")])]),a._v(" "),s("h2",{attrs:{id:"参考文章"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[a._v("#")]),a._v(" 参考文章")]),a._v(" "),s("ul",[s("li",[a._v("https://blog.51cto.com/u_13746824/2172139")])])])}),[],!1,null,null,null);t.default=r.exports}}]);